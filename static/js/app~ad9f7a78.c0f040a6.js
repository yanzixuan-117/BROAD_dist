"use strict";(self["webpackChunkhard_diancan_front"]=self["webpackChunkhard_diancan_front"]||[]).push([[641],{17021:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},[e("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}}),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.search()}}},[t._v("查询")]),e("el-button",{attrs:{type:"info",plain:""},on:{click:function(e){return t.research()}}},[t._v("重置")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.add()}}},[t._v("新增")])],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{prop:"id",label:"序号",width:"70",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"name",label:"名称"}}),e("el-table-column",{attrs:{prop:"rightreply",label:"答案"}}),e("el-table-column",{attrs:{prop:"tikuname",label:"所属题库"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)]),e("el-dialog",{attrs:{title:"题库信息",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"名称",prop:"gname"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"类型",prop:"score"}},[e("el-select",{staticStyle:{width:"100%","margin-right":"10px"},attrs:{placeholder:"请选择"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[e("el-option",{attrs:{value:"选择题",label:"选择题"}}),e("el-option",{attrs:{value:"判断题",label:"判断题"}})],1)],1),"选择题"==t.form.type?e("el-form-item",{attrs:{label:"A",prop:"optiona"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.optiona,callback:function(e){t.$set(t.form,"optiona",e)},expression:"form.optiona"}})],1):t._e(),"选择题"==t.form.type?e("el-form-item",{attrs:{label:"B",prop:"optionb"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.optionb,callback:function(e){t.$set(t.form,"optionb",e)},expression:"form.optionb"}})],1):t._e(),"选择题"==t.form.type?e("el-form-item",{attrs:{label:"C",prop:"optionc"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.optionc,callback:function(e){t.$set(t.form,"optionc",e)},expression:"form.optionc"}})],1):t._e(),e("el-form-item",{attrs:{label:"正确答案",prop:"rightreply"}},[e("el-input",{attrs:{placeholder:"正确答案"},model:{value:t.form.rightreply,callback:function(e){t.$set(t.form,"rightreply",e)},expression:"form.rightreply"}})],1),e("el-form-item",{attrs:{label:"所属题库",prop:"score"}},[e("el-select",{staticStyle:{width:"100%","margin-right":"10px"},attrs:{placeholder:"请选择"},model:{value:t.form.tikuid,callback:function(e){t.$set(t.form,"tikuid",e)},expression:"form.tikuid"}},t._l(t.tikulist,(function(t){return e("el-option",{attrs:{value:t.id,label:t.name}})})),1)],1),e("el-form-item",{attrs:{label:"是否重点题目",prop:"score"}},[e("el-select",{staticStyle:{width:"100%","margin-right":"10px"},attrs:{placeholder:"请选择"},model:{value:t.form.isim,callback:function(e){t.$set(t.form,"isim",e)},expression:"form.isim"}},[e("el-option",{attrs:{value:"是",label:"是"}}),e("el-option",{attrs:{value:"否",label:"否"}})],1)],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=a(18962),r={data(){return{fileList:[],teacherlist:[],tikulist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist(),this.getall()},methods:{shenhe(t){},async selectca(t){console.log(t);const e=await o.A.get("/hotal/typeByhotel?id="+t);console.log(e),this.categoryList=e.data},selectcaf(t){this.$forceUpdate()},handleFileSuccess(t){this.form.img=t.data},async getall(){const t=await o.A.get("/tiku/all");console.log(t),this.tikulist=t.data},del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/tiku/delete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.form=t,this.avatar=t.avatar,this.form.teacherid=t.teacherid,"ADMIN"==this.user.role&&this.getall(),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const t=await o.A.get("/tiku/qlist",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){const t=await o.A.post("/tiku/savequestion",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"600277f2",null),d=c.exports},27677:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg"},[e("div",{staticClass:"register-container"},[e("el-form",{ref:"loginForm",staticClass:"register-form",attrs:{model:t.loginForm,rules:t.rules,"label-position":"left","label-width":"0px"}},[e("div",{staticClass:"title"},[e("i",{staticClass:"el-icon-s-platform"}),e("span",[t._v(t._s(t.$t("auth.forumRegister")))])]),e("el-form-item",{attrs:{prop:"userName"}},[e("el-input",{staticClass:"register-input",attrs:{type:"text",autocomplete:"off","prefix-icon":"el-icon-user",placeholder:t.$t("auth.usernamePlaceholder")},model:{value:t.loginForm.userName,callback:function(e){t.$set(t.loginForm,"userName",e)},expression:"loginForm.userName"}})],1),e("el-form-item",{attrs:{prop:"password"}},[e("el-input",{staticClass:"register-input",attrs:{type:"password",autocomplete:"off","prefix-icon":"el-icon-lock",placeholder:t.$t("auth.passwordPlaceholder")},model:{value:t.loginForm.password,callback:function(e){t.$set(t.loginForm,"password",e)},expression:"loginForm.password"}})],1),e("el-form-item",{attrs:{prop:"repassword"}},[e("el-input",{staticClass:"register-input",attrs:{type:"password",autocomplete:"off","prefix-icon":"el-icon-lock",placeholder:t.$t("auth.confirmPasswordPlaceholder")},model:{value:t.repassword,callback:function(e){t.repassword=e},expression:"repassword"}})],1),e("el-form-item",{attrs:{prop:"role"}},[e("el-select",{staticClass:"register-input role-select",attrs:{placeholder:t.$t("auth.rolePlaceholder")},model:{value:t.loginForm.role,callback:function(e){t.$set(t.loginForm,"role",e)},expression:"loginForm.role"}},[e("el-option",{attrs:{label:t.$t("auth.user"),value:1}},[e("i",{staticClass:"el-icon-user"}),t._v(" "+t._s(t.$t("auth.user"))+" ")])],1)],1),e("el-form-item",[e("el-button",{staticClass:"register-button",attrs:{type:"primary"},on:{click:t.handleLogin}},[e("i",{staticClass:"el-icon-upload2"}),t._v(" "+t._s(t.$t("auth.registerTitle"))+" ")])],1),e("div",{staticClass:"tip"},[e("span",[t._v(t._s(t.$t("auth.alreadyHaveAccount")))]),e("span",{staticClass:"login-link",on:{click:function(e){return t.sjzhuce()}}},[t._v(t._s(t.$t("auth.immediateLogin")))])])],1)],1)])},i=[],o=(a(44114),a(18962)),r={data(){return{loginForm:{userName:"",password:"",role:1,inviterId:""},repassword:"",rules:{userName:[{required:!0,message:this.$t("validation.required"),trigger:"blur"}],password:[{required:!0,message:this.$t("validation.required"),trigger:"blur"}],role:[{required:!0,message:this.$t("validation.required"),trigger:"change"}]}}},mounted(){const t=this.$route.query.inviterId;console.log("注册页面 - 完整URL:",window.location.href),console.log("注册页面 - 从route.query获取的inviterId:",t),t?(this.loginForm.inviterId=t,console.log("✅ 检测到邀请码并已保存到表单:",t),this.$message.success(this.$t("auth.inviteCodeFilled",{code:t}))):console.log("❌ 未检测到邀请码")},methods:{sjzhuce(){this.$router.push({path:"/login"})},handleLogin(){this.$refs.loginForm.validate((async t=>{if(!t)return console.log(this.$t("auth.formValidationFailed")),!1;if(this.repassword==this.loginForm.password){console.log(this.loginForm);const t=await o.A.post("/register",this.loginForm);1==t.code||200==t.code?(this.$message.success(this.$t("auth.registerSuccess")),this.$router.push({path:"/login"})):this.$message.warning(t.msg)}else this.$message.warning(this.$t("auth.passwordMismatch"))}))}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"96555af8",null),d=c.exports},52743:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},["ADMIN"==t.user.role?e("el-select",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请选择酒店"},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}},t._l(t.hotellist,(function(t){return e("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1):t._e(),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.search()}}},[t._v("查询")]),e("el-button",{attrs:{type:"info",plain:""},on:{click:function(e){return t.research()}}},[t._v("重置")]),"HOTEL"==t.user.role?e("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.add()}}},[t._v("新增")]):t._e()],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e("el-table-column",{attrs:{prop:"id",label:"序号",width:"70",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"name",label:"房间编号"}}),e("el-table-column",{attrs:{prop:"status",label:"房间状态"}}),e("el-table-column",{attrs:{prop:"typeName",label:"所属分类"}}),e("el-table-column",{attrs:{prop:"hotelName",label:"所属酒店"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"180"},scopedSlots:t._u([{key:"default",fn:function(a){return["HOTEL"==t.user.role?e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]):t._e(),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)]),e("el-dialog",{attrs:{title:"房间信息",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"名称",prop:"gname"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"房间状态状态",prop:"status"}},[e("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[e("el-radio",{attrs:{label:"空闲"}}),e("el-radio",{attrs:{label:"占用"}})],1)],1),e("el-form-item",{attrs:{label:"分类",prop:"categoryId"}},[e("el-select",{staticStyle:{width:"100%"},on:{change:t.selectcaf},model:{value:t.form.typeId,callback:function(e){t.$set(t.form,"typeId",e)},expression:"form.typeId"}},t._l(t.categoryList,(function(t){return e("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1)],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=a(18962),r={data(){return{fileList:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getall(),this.getlist(),"HOTEL"==this.user.role&&this.selectca(this.user.id)},methods:{async selectca(t){console.log(t);const e=await o.A.get("/hotal/typeByhotel?id="+t);console.log(e),this.categoryList=e.data},selectcaf(t){this.$forceUpdate()},handleFileSuccess(t){this.form.img=t.data},async getall(){const t=await o.A.get("/hotal/all");console.log(t),this.hotellist=t.data},del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/hotal/roomdelete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.form=t,this.form.hotelId=t.hotelId,this.selectca(this.form.hotelId),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){"HOTEL"==this.user.role&&(this.queryform.keyword=this.user.id);const t=await o.A.get("/hotal/roomlist",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){"HOTEL"==this.user.role&&(this.form.hotelId=this.user.id);const t=await o.A.post("/hotal/roomsave",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"4a720e22",null),d=c.exports},79881:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},[e("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.add()}}},[t._v("新增")])],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e("el-table-column",{attrs:{type:"index",label:"序号",width:"70",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"id",label:"订单编号"}}),e("el-table-column",{attrs:{prop:"username",label:"用户"}}),e("el-table-column",{attrs:{prop:"hotelname",label:"酒店"}}),e("el-table-column",{attrs:{prop:"typename",label:"客房"}}),e("el-table-column",{attrs:{prop:"roomname",label:"房间号"}}),e("el-table-column",{attrs:{prop:"intime",label:"入住时间"}}),e("el-table-column",{attrs:{prop:"outtime",label:"退房时间"}}),e("el-table-column",{attrs:{prop:"status",label:"状态"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"180"},scopedSlots:t._u([{key:"default",fn:function(a){return["已退房"!==a.row.status?e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("退房")]):t._e(),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)]),e("el-dialog",{attrs:{title:"入住信息",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"订单编号",prop:"categoryId"}},[e("el-select",{staticStyle:{width:"100%"},on:{change:t.selectcaf},model:{value:t.form.orderid,callback:function(e){t.$set(t.form,"orderid",e)},expression:"form.orderid"}},t._l(t.categoryList,(function(t){return e("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1)],1),e("el-form-item",{attrs:{label:"房间号",prop:"categoryId"}},[e("el-select",{staticStyle:{width:"100%"},model:{value:t.form.roomid,callback:function(e){t.$set(t.form,"roomid",e)},expression:"form.roomid"}},t._l(t.roomlist,(function(t){return e("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1)],1),e("el-form-item",{attrs:{label:"入住日期",prop:"intime"}},[e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"入住时间"},model:{value:t.form.intime,callback:function(e){t.$set(t.form,"intime",e)},expression:"form.intime"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=(a(98992),a(3949),a(18962)),r={data(){return{fileList:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],roomlist:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getall(),this.getlist(),this.selectca(this.user.id)},methods:{async selectca(t){console.log(t);const e=await o.A.get("/hotal/orderall");console.log(e),this.categoryList=e.data},async selectcaf(t){this.categoryList.forEach((async(e,a)=>{if(e.id==t){this.form.outtime=this.categoryList[a].outtime,this.form.userid=this.categoryList[a].userid,this.form.hotelid=this.categoryList[a].hotelid,this.form.typeid=this.categoryList[a].typeid,console.log(this.categoryList[a]);const t=await o.A.get(`/hotal/roomByhotalId?hotelId=${this.categoryList[a].hotelid}&&typeId=${this.categoryList[a].typeid}`);console.log(t),this.roomlist=t.data,this.$forceUpdate()}}))},handleFileSuccess(t){this.form.img=t.data},async getall(){const t=await o.A.get("/hotal/all");console.log(t),this.hotellist=t.data},del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/hotal/checkdelete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.$confirm("是否确认退房?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/hotal/checklogout?id="+t.orderid);console.log(e),1==e.code&&(this.$message({type:"success",message:"退房成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){"HOTEL"==this.user.role&&(this.queryform.keyword=this.user.id);const t=await o.A.get("/hotal/checkinlist",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){const t=await o.A.post("/hotal/addcheckin",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"783117c8",null),d=c.exports},2621:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},[e("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}}),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.search()}}},[t._v("查询")]),e("el-button",{attrs:{type:"info",plain:""},on:{click:function(e){return t.research()}}},[t._v("重置")])],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"70",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"name",label:"名称"}}),e("el-table-column",{attrs:{prop:"username",label:"提交人"}}),e("el-table-column",{attrs:{prop:"score",label:"分数"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:t._u([{key:"default",fn:function(a){return[0==a.row.score?e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.pf(a.row)}}},[t._v("评分")]):t._e()]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)])],1)},i=[],o=(a(98992),a(3949),a(18962)),r={data(){return{fileList:[],teacherlist:[],tikulist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist(),this.getall()},methods:{async pf(t){const e=JSON.parse(t.biaozhundaan),a=JSON.parse(t.xueshengdaan);let s=0;e.forEach((t=>{a.forEach((e=>{t==e&&(s+=20)}))})),console.log(s);const i=await o.A.post("/tiku/addsj",{id:t.id,score:s});console.log(i),1==i.code&&this.getlist()},shenhe(t){},async selectca(t){console.log(t);const e=await o.A.get("/hotal/typeByhotel?id="+t);console.log(e),this.categoryList=e.data},selectcaf(t){this.$forceUpdate()},handleFileSuccess(t){this.form.img=t.data},async getall(){const t=await o.A.get("/tiku/all");console.log(t),this.tikulist=t.data},del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/tiku/delete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.form=t,this.avatar=t.avatar,this.form.teacherid=t.teacherid,"ADMIN"==this.user.role&&this.getall(),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const t=await o.A.get("/tiku/shijuanlist",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){const t=await o.A.post("/tiku/savequestion",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"281b99d1",null),d=c.exports},15863:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},[e("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}}),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.search()}}},[t._v("查询")]),e("el-button",{attrs:{type:"info",plain:""},on:{click:function(e){return t.research()}}},[t._v("重置")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.add()}}},[t._v("新增")])],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"70",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"name",label:"资源名称"}}),e("el-table-column",{attrs:{prop:"url",label:"资源路径",width:"200"}}),e("el-table-column",{attrs:{prop:"type",label:"所属分类"}}),e("el-table-column",{attrs:{prop:"createtime",label:"上传时间"}}),e("el-table-column",{attrs:{prop:"teachername",label:"上传人"}}),e("el-table-column",{attrs:{prop:"info",label:"简介"}}),e("el-table-column",{attrs:{prop:"downloadnum",label:"下载量"},scopedSlots:t._u([{key:"default",fn:function(a){return[null==a.row.downloadnum?e("div",[t._v("0")]):e("div",[t._v(t._s(a.row.downloadnum))])]}}])}),e("el-table-column",{attrs:{prop:"watchnum",label:"浏览量"},scopedSlots:t._u([{key:"default",fn:function(a){return[null==a.row.watchnum?e("div",[t._v("0")]):e("div",[t._v(t._s(a.row.watchnum))])]}}])}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)]),e("el-dialog",{attrs:{title:"资源信息",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"名称",prop:"gname"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"分类",prop:"type"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}})],1),e("el-form-item",{attrs:{label:"视频",prop:"avatar"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/files/upload","show-file-list":!1,"on-success":t.handleAvatarSuccess}},[""!==t.avatar?e("video",{staticClass:"avatar",attrs:{src:t.avatar}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e("el-form-item",{attrs:{label:"简介",prop:"info"}},[e("el-input",{attrs:{type:"textarea",placeholder:"简介"},model:{value:t.form.info,callback:function(e){t.$set(t.form,"info",e)},expression:"form.info"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=a(18962),r={data(){return{fileList:[],teacherlist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,tid:0,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist(),"ADMIN"==this.user.role&&this.getall()},methods:{shenhe(t){},async selectca(t){console.log(t);const e=await o.A.get("/hotal/typeByhotel?id="+t);console.log(e),this.categoryList=e.data},selectcaf(t){this.$forceUpdate()},handleFileSuccess(t){this.form.img=t.data},async getall(){const t=await o.A.get("/teacher/all");console.log(t),this.teacherlist=t.data},guidang(t){this.$confirm("是否确认归档？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/subject/guidang?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"归档成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/source/delete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.form=t,this.avatar=t.url,this.form.teacherid=t.teacherid,"ADMIN"==this.user.role&&this.getall(),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){"TEACHER"==this.user.role&&(this.queryform.tid=this.user.id);const t=await o.A.get("/source/list",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){this.form.url=this.avatar,this.form.teacherid=this.user.id,this.form.createtime=(new Date).toLocaleString(),this.form.watchnum=0,this.form.downloadnum=0;const t=await o.A.post("/source/add",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"042b8d64",null),d=c.exports},64262:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},[e("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}}),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.search()}}},[t._v("查询")]),e("el-button",{attrs:{type:"info",plain:""},on:{click:function(e){return t.research()}}},[t._v("重置")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.add()}}},[t._v("新增")])],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{prop:"id",label:"序号",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"username",label:"账号"}}),e("el-table-column",{attrs:{prop:"name",label:"名称"}}),e("el-table-column",{attrs:{label:"头像"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[a.row.avatar?e("el-image",{staticStyle:{width:"40px",height:"40px","border-radius":"50%"},attrs:{src:a.row.avatar,"preview-src-list":[a.row.avatar]}}):t._e()],1)]}}])}),e("el-table-column",{attrs:{prop:"role",label:"角色"}}),e("el-table-column",{attrs:{prop:"phone",label:"电话"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"180",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)]),e("el-dialog",{attrs:{title:"酒店",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"账号",prop:"username"}},[e("el-input",{attrs:{placeholder:"账号"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),e("el-form-item",{attrs:{label:"密码",prop:"password"}},[e("el-input",{attrs:{placeholder:"密码","show-password":""},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),e("el-form-item",{attrs:{label:"名称",prop:"name"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"电话",prop:"phone"}},[e("el-input",{attrs:{placeholder:"电话"},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),e("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[e("el-input",{attrs:{placeholder:"电话"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),e("el-form-item",{attrs:{label:"头像"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/files/upload","show-file-list":!1,"on-success":t.handleAvatarSuccess}},[""!==t.avatar?e("img",{staticClass:"avatar",attrs:{src:t.avatar}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=a(18962),r={data(){return{tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:JSON.parse(localStorage.getItem("xm-user")||"{}"),rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],type:[{required:!0,message:"请选择商家类型",trigger:"blur"}]},ids:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.getlist()},methods:{del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/teacher/delete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.form=t,this.avatar=t.avatar,this.license=t.license,this.form.timeRange=t.time_range,this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const t=await o.A.get("/teacher/list",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){this.form.avatar=this.avatar,this.form.role="TEACHER";const t=await o.A.post("/teacher/addandupdate",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"b01eac40",null),d=c.exports},48604:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},[e("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}}),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.search()}}},[t._v("查询")]),e("el-button",{attrs:{type:"info",plain:""},on:{click:function(e){return t.research()}}},[t._v("重置")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.add()}}},[t._v("新增")])],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{prop:"id",label:"序号",width:"70",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"name",label:"名称"}}),e("el-table-column",{attrs:{prop:"avatar",label:"题库图片"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.avatar?e("el-image",{staticStyle:{width:"40px",height:"40px"},attrs:{src:a.row.avatar,"preview-src-list":[a.row.avatar]}}):t._e()]}}])}),e("el-table-column",{attrs:{prop:"score",label:"分数"}}),e("el-table-column",{attrs:{prop:"num",label:"题目数"}}),e("el-table-column",{attrs:{prop:"teachername",label:"教课教师"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)]),e("el-dialog",{attrs:{title:"题库信息",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"名称",prop:"gname"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"图片",prop:"avatar"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/files/upload","show-file-list":!1,"on-success":t.handleAvatarSuccess}},[""!==t.avatar?e("img",{staticClass:"avatar",attrs:{src:t.avatar}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e("el-form-item",{attrs:{label:"分数",prop:"score"}},[e("el-input",{attrs:{placeholder:"分数"},model:{value:t.form.score,callback:function(e){t.$set(t.form,"score",e)},expression:"form.score"}})],1),e("el-form-item",{attrs:{label:"数量",prop:"num"}},[e("el-input",{attrs:{placeholder:"数量"},model:{value:t.form.num,callback:function(e){t.$set(t.form,"num",e)},expression:"form.num"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=a(18962),r={data(){return{fileList:[],teacherlist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,tid:0,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist(),"ADMIN"==this.user.role&&this.getall()},methods:{shenhe(t){},async selectca(t){console.log(t);const e=await o.A.get("/hotal/typeByhotel?id="+t);console.log(e),this.categoryList=e.data},selectcaf(t){this.$forceUpdate()},handleFileSuccess(t){this.form.img=t.data},async getall(){const t=await o.A.get("/teacher/all");console.log(t),this.teacherlist=t.data},del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/tiku/delete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.form=t,this.avatar=t.avatar,this.form.teacherid=t.teacherid,"ADMIN"==this.user.role&&this.getall(),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){"TEACHER"==this.user.role&&(this.queryform.tid=this.user.id);const t=await o.A.get("/tiku/list",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){this.form.avatar=this.avatar,"TEACHER"==this.user.role&&(this.form.teacherid=this.user.id);const t=await o.A.post("/tiku/add",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"1eff4078",null),d=c.exports},84052:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},[e("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.add()}}},[t._v("新增")])],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"}}},[e("el-table-column",{attrs:{prop:"id",label:"id"}}),e("el-table-column",{attrs:{prop:"name",label:"名称"}}),e("el-table-column",{attrs:{prop:"desc",label:"描述"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1)],1)]),e("el-dialog",{attrs:{title:"板块信息",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"名称",prop:"name"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"父id",prop:"pid"}},[e("el-input",{attrs:{placeholder:"请输入父id默认0"},model:{value:t.form.pid,callback:function(e){t.$set(t.form,"pid",e)},expression:"form.pid"}})],1),e("el-form-item",{attrs:{label:"描述",prop:"desc"}},[e("el-input",{attrs:{placeholder:"描述"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=a(18962),r={data(){return{fileList:[],teacherlist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist()},methods:{shenhe(t){},async selectca(t){console.log(t);const e=await o.A.get("/hotal/typeByhotel?id="+t);console.log(e),this.categoryList=e.data},selectcaf(t){this.$forceUpdate()},handleFileSuccess(t){this.form.img=t.data},async getall(){const t=await o.A.get("/teacher/all");console.log(t),this.teacherlist=t.data},guidang(t){this.$confirm("是否确认归档？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/subject/guidang?id="+t);console.log(e),200!=e.code&&1!=e.code||(this.$message({type:"success",message:"归档成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.post("/board/delete",{id:t});console.log(e),200!=e.code&&1!=e.code||(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.form=t,this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const t=await o.A.get("/board/list",{params:this.queryform});console.log(t),200!=t.code&&1!=t.code||(this.tableData=t.data)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){const t=await o.A.post("/board/add",this.form);200!=t.code&&1!=t.code||(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"002d8e54",null),d=c.exports},57695:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"mb"},[e("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}}),e("el-button",{attrs:{type:"primary",plain:""},on:{click:function(e){return t.search()}}},[t._v("查询")]),e("el-button",{attrs:{type:"info",plain:""},on:{click:function(e){return t.research()}}},[t._v("重置")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(e){return t.add()}}},[t._v("新增")])],1),e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{prop:"id",label:"序号",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"username",label:"账号"}}),e("el-table-column",{attrs:{label:"头像"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[a.row.avatar?e("el-image",{staticStyle:{width:"40px",height:"40px","border-radius":"50%"},attrs:{src:a.row.avatar,"preview-src-list":[a.row.avatar]}}):t._e()],1)]}}])}),e("el-table-column",{attrs:{prop:"name",label:"姓名"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"180",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)]),e("el-dialog",{attrs:{title:"用户信息",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"账号",prop:"username"}},[e("el-input",{attrs:{placeholder:"账号"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),e("el-form-item",{attrs:{label:"名称",prop:"name"}},[e("el-input",{attrs:{placeholder:"名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-form-item",{attrs:{label:"头像"}},[e("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/admin/common/upload","show-file-list":!1,"on-success":t.handleAvatarSuccess}},[""!==t.avatar?e("img",{staticClass:"avatar",attrs:{src:t.avatar}}):e("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=a(18962),r={data(){return{tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:JSON.parse(localStorage.getItem("userinfo")||"{}"),rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],type:[{required:!0,message:"请选择商家类型",trigger:"blur"}]},ids:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.getlist()},methods:{del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/user/delete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.form=t,this.avatar=t.avatar,this.license=t.license,this.form.timeRange=t.time_range,this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const t=await o.A.get("/user/list",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){this.form.avatar=this.avatar,this.form.role="ADMIN";const t=await o.A.post("/user/useraddandupdate",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"405b1a13",null),d=c.exports},53911:function(t,e,a){a.d(e,{A:function(){return d}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",[e("div",{staticClass:"table"},[e("el-table",{attrs:{data:t.tableData,strip:""}},[e("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e("el-table-column",{attrs:{type:"index",label:"序号",width:"70",align:"center",sortable:""}}),e("el-table-column",{attrs:{prop:"id",label:"订单编号"}}),e("el-table-column",{attrs:{prop:"username",label:"用户"}}),e("el-table-column",{attrs:{prop:"hotelname",label:"酒店"}}),e("el-table-column",{attrs:{prop:"typename",label:"客房"}}),e("el-table-column",{attrs:{prop:"roomname",label:"房间号"}}),e("el-table-column",{attrs:{prop:"intime",label:"入住时间"}}),e("el-table-column",{attrs:{prop:"outtime",label:"退房时间"}}),e("el-table-column",{attrs:{prop:"status",label:"状态"}}),e("el-table-column",{attrs:{label:"操作",align:"center",width:"180"},scopedSlots:t._u([{key:"default",fn:function(a){return["已退房"!==a.row.status?e("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("退房")]):t._e(),e("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[t._v("删除")])]}}])})],1),e("div",{staticClass:"pagination"},[e("el-pagination",{attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)]),e("el-dialog",{attrs:{title:"入住信息",visible:t.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:"订单编号",prop:"categoryId"}},[e("el-select",{staticStyle:{width:"100%"},on:{change:t.selectcaf},model:{value:t.form.orderid,callback:function(e){t.$set(t.form,"orderid",e)},expression:"form.orderid"}},t._l(t.categoryList,(function(t){return e("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1)],1),e("el-form-item",{attrs:{label:"房间号",prop:"categoryId"}},[e("el-select",{staticStyle:{width:"100%"},model:{value:t.form.roomid,callback:function(e){t.$set(t.form,"roomid",e)},expression:"form.roomid"}},t._l(t.roomlist,(function(t){return e("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})})),1)],1),e("el-form-item",{attrs:{label:"入住日期",prop:"intime"}},[e("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"入住时间"},model:{value:t.form.intime,callback:function(e){t.$set(t.form,"intime",e)},expression:"form.intime"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},i=[],o=(a(98992),a(3949),a(18962)),r={data(){return{fileList:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{uid:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],roomlist:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist()},methods:{async selectca(t){console.log(t);const e=await o.A.get("/hotal/orderall");console.log(e),this.categoryList=e.data},async selectcaf(t){this.categoryList.forEach((async(e,a)=>{if(e.id==t){this.form.outtime=this.categoryList[a].outtime,this.form.userid=this.categoryList[a].userid,this.form.hotelid=this.categoryList[a].hotelid,this.form.typeid=this.categoryList[a].typeid,console.log(this.categoryList[a]);const t=await o.A.get(`/hotal/roomByhotalId?hotelId=${this.categoryList[a].hotelid}&&typeId=${this.categoryList[a].typeid}`);console.log(t),this.roomlist=t.data,this.$forceUpdate()}}))},handleFileSuccess(t){this.form.img=t.data},async getall(){const t=await o.A.get("/hotal/all");console.log(t),this.hotellist=t.data},del(t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/hotal/checkdelete?id="+t);console.log(e),1==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(t){this.form.timeRange=t,this.$forceUpdate()},handleEdit(t){this.$confirm("是否确认退房?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await o.A.get("/hotal/checklogout?id="+t.orderid);console.log(e),1==e.code&&(this.$message({type:"success",message:"退房成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){this.queryform.uid=this.user.id;const t=await o.A.get("/hotal/percheckinlist",{params:this.queryform});console.log(t),1==t.code&&(this.tableData=t.data.records,this.total=t.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(t){},async save(){const t=await o.A.post("/hotal/addcheckin",this.form);1==t.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(t){},handleAvatarSuccess(t){console.log(t),this.avatar=t.data,console.log(this.form.avatar)},handleAvatarSuccess1(t){this.license=t.data}}},l=r,n=a(81656),c=(0,n.A)(l,s,i,!1,null,"09c6b4b9",null),d=c.exports},59186:function(t,e,a){a.d(e,{A:function(){return h}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"personal-container"},[e("div",{staticClass:"action-card"},[e("div",{staticClass:"search-section"},[t.isMobile?t._e():e("div",{staticClass:"search-input"},[e("el-input",{staticClass:"search-box",attrs:{placeholder:t.$t("article.searchPlaceholder"),clearable:""},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}},[e("template",{slot:"prefix"},[e("i",{staticClass:"el-icon-search"})])],2)],1),t.isMobile?t._e():e("div",{staticClass:"action-buttons"},[e("el-button",{staticClass:"btn-primary",attrs:{type:"primary"},on:{click:function(e){return t.search()}}},[e("i",{staticClass:"el-icon-search"}),t._v(t._s(t.$t("article.query"))+" ")]),e("el-button",{staticClass:"btn-reset",on:{click:function(e){return t.research()}}},[e("i",{staticClass:"el-icon-refresh"}),t._v(t._s(t.$t("article.reset"))+" ")]),e("el-button",{staticClass:"btn-add",attrs:{type:"warning"},on:{click:function(e){return t.add()}}},[e("i",{staticClass:"el-icon-plus"}),t._v(t._s(t.$t("forum.publishArticle"))+" ")])],1),t.isMobile?e("div",{staticClass:"mobile-search-section"},[e("div",{staticClass:"search-input-mobile"},[e("el-input",{staticClass:"search-box-mobile",attrs:{placeholder:t.$t("article.searchPlaceholderShort"),clearable:""},model:{value:t.queryform.keyword,callback:function(e){t.$set(t.queryform,"keyword",e)},expression:"queryform.keyword"}})],1),e("div",{staticClass:"mobile-action-buttons"},[e("el-button",{staticClass:"mobile-btn-search",attrs:{type:"primary",size:"small"},on:{click:function(e){return t.search()}}},[e("i",{staticClass:"el-icon-search"})]),e("el-button",{staticClass:"mobile-btn-reset",attrs:{size:"small"},on:{click:function(e){return t.research()}}},[e("i",{staticClass:"el-icon-refresh"})]),e("el-button",{staticClass:"mobile-btn-add",attrs:{type:"warning",size:"small"},on:{click:function(e){return t.add()}}},[e("i",{staticClass:"el-icon-plus"})])],1)]):t._e()])]),e("div",{staticClass:"content-card"},[e("div",{staticClass:"table-wrapper"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"article-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-style":{background:"#f8fafc",color:"#2c3e50",fontWeight:"600",fontSize:"14px"},"element-loading-text":t.$t("article.loadingData"),"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[e("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center",sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"article-id"},[t._v("#"+t._s(a.row.id))])]}}])}),e("el-table-column",{attrs:{prop:"title",label:t.$t("article.articleTitle"),width:"250"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"article-title-cell"},[e("div",{staticClass:"title-text",attrs:{title:a.row.title}},[t._v(" "+t._s(a.row.title)+" ")]),a.row.summary?e("div",{staticClass:"title-summary"},[t._v(" "+t._s(a.row.summary)+" ")]):t._e()])]}}])}),e("el-table-column",{attrs:{prop:"cover",label:t.$t("article.coverLabel"),width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"cover-container"},[a.row.cover?e("el-image",{staticClass:"cover-image",attrs:{src:t.$getImageUrl(a.row.cover),"preview-src-list":[t.$getImageUrl(a.row.cover)],fit:"cover"}},[e("div",{staticClass:"image-error",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture"})])]):e("div",{staticClass:"no-cover"},[e("i",{staticClass:"el-icon-picture-outline"})])],1)]}}])}),e("el-table-column",{attrs:{prop:"boardName",label:t.$t("article.categoryLabel"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{staticClass:"category-tag",attrs:{size:"small",type:"info"}},[t._v(" "+t._s(a.row.boardName||t.$t("article.uncategorized"))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"pboardName",label:t.$t("article.tagLabel"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{staticClass:"tag-item",attrs:{size:"small",type:t.getTagType(a.row.pboardName)}},[t._v(" "+t._s(a.row.pboardName||t.$t("article.noTag"))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"nickName",label:t.$t("article.author"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"author-info"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v(t._s(a.row.nickName))])])]}}])}),e("el-table-column",{attrs:{prop:"postTime",label:t.$t("article.publishDate"),width:"140",sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"date-cell"},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v(t._s(t.formatDate(a.row.postTime)))])])]}}])}),e("el-table-column",{attrs:{prop:"readCount",label:t.$t("article.viewCount"),width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"stat-item"},[e("i",{staticClass:"el-icon-view"}),e("span",{staticClass:"stat-value"},[t._v(t._s(a.row.readCount||0))])])]}}])}),e("el-table-column",{attrs:{prop:"content",label:t.$t("article.contentPreview"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{staticClass:"preview-btn",attrs:{type:"info",size:"mini"},on:{click:function(e){return t.chakan(a.row.content)}}},[e("i",{staticClass:"el-icon-document"}),t._v(t._s(t.$t("article.view"))+" ")])]}}])}),e("el-table-column",{attrs:{label:t.$t("article.actions"),width:"200",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"action-buttons-cell"},[e("el-button",{staticClass:"edit-btn",attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){return t.handleEdit(a.row)}}},[e("i",{staticClass:"el-icon-edit"}),t._v(t._s(t.$t("common.edit"))+" ")]),e("el-button",{staticClass:"delete-btn",attrs:{size:"mini",type:"danger",plain:""},on:{click:function(e){return t.del(a.row.id)}}},[e("i",{staticClass:"el-icon-delete"}),t._v(t._s(t.$t("common.delete"))+" ")])],1)]}}])})],1),0!==t.tableData.length||t.loading?t._e():e("div",{staticClass:"empty-state"},[e("i",{staticClass:"el-icon-document-delete"}),e("p",[t._v("暂无文章数据")]),e("p",{staticClass:"empty-tip"},[t._v(t._s(t.$t("article.firstArticleTip")))])])],1),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"mobile-card-list",attrs:{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[t._l(t.tableData,(function(a){return e("div",{key:a.id,staticClass:"article-card"},[e("div",{staticClass:"card-header",on:{click:function(e){return t.chakan(a.content)}}},[a.cover?e("div",{staticClass:"card-cover"},[e("el-image",{staticClass:"card-cover-image",attrs:{src:t.$getImageUrl(a.cover),"preview-src-list":[t.$getImageUrl(a.cover)],fit:"cover"}},[e("div",{staticClass:"image-error",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture"})])])],1):e("div",{staticClass:"card-cover no-cover-card"},[e("i",{staticClass:"el-icon-picture-outline"})]),e("div",{staticClass:"card-title-section"},[e("h3",{staticClass:"card-title"},[t._v(t._s(a.title))]),a.summary?e("p",{staticClass:"card-summary"},[t._v(t._s(a.summary))]):t._e()])]),e("div",{staticClass:"card-meta"},[e("div",{staticClass:"meta-tags"},[e("el-tag",{staticClass:"meta-tag",attrs:{size:"small",type:"info"}},[t._v(" "+t._s(a.boardName||t.$t("article.uncategorized"))+" ")]),e("el-tag",{staticClass:"meta-tag",attrs:{size:"small",type:t.getTagType(a.pboardName)}},[t._v(" "+t._s(a.pboardName||t.$t("article.noTag"))+" ")])],1),e("div",{staticClass:"meta-info"},[e("div",{staticClass:"meta-item"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v(t._s(a.nickName))])]),e("div",{staticClass:"meta-item"},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v(t._s(t.formatDate(a.postTime)))])]),e("div",{staticClass:"meta-item"},[e("i",{staticClass:"el-icon-view"}),e("span",[t._v(t._s(a.readCount||0))])])])]),e("div",{staticClass:"card-actions"},[e("el-button",{staticClass:"card-action-btn preview",attrs:{type:"info",size:"small",plain:""},on:{click:function(e){return t.chakan(a.content)}}},[e("i",{staticClass:"el-icon-document"}),e("span",[t._v("查看内容")])]),e("el-button",{staticClass:"card-action-btn edit",attrs:{type:"primary",size:"small",plain:""},on:{click:function(e){return t.handleEdit(a)}}},[e("i",{staticClass:"el-icon-edit"}),e("span",[t._v("编辑")])]),e("el-button",{staticClass:"card-action-btn delete",attrs:{type:"danger",size:"small",plain:""},on:{click:function(e){return t.del(a.id)}}},[e("i",{staticClass:"el-icon-delete"}),e("span",[t._v("删除")])])],1)])})),0!==t.tableData.length||t.loading?t._e():e("div",{staticClass:"empty-state-mobile"},[t._m(0),e("p",{staticClass:"empty-text"},[t._v("暂无文章数据")]),e("p",{staticClass:"empty-tip-mobile"},[t._v(t._s(t.$t("article.firstArticleTip")))])])],2),e("div",{staticClass:"pagination-wrapper"},[e("el-pagination",{staticClass:"custom-pagination",attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)]),e("el-dialog",{attrs:{title:t.$t("article.contentPreviewTitle"),visible:t.fromVisible1,width:"60%","close-on-click-modal":!1,"custom-class":"content-preview-dialog"},on:{"update:visible":function(e){t.fromVisible1=e}}},[e("div",{staticClass:"content-preview",domProps:{innerHTML:t._s(t.content)}}),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible1=!1}}},[t._v("关闭")])],1)]),t.isMobile?e("el-drawer",{attrs:{title:t.form.id?t.$t("article.editArticle"):t.$t("forum.publishArticle"),visible:t.fromVisible,direction:"btt",size:"95%","custom-class":"article-edit-drawer","append-to-body":!0},on:{"update:visible":function(e){t.fromVisible=e},close:t.handleDialogClose}},[e("div",{staticClass:"drawer-content-mobile"},[e("div",{staticClass:"form-card-mobile"},[e("div",{staticClass:"card-label-mobile"},[e("span",{staticClass:"required-mark"},[t._v("*")]),t._v(" 文章标题 ")]),e("el-input",{staticClass:"title-input-mobile",attrs:{placeholder:"请输入文章标题",maxlength:"100","show-word-limit":"",type:"textarea",rows:2,autosize:{minRows:2,maxRows:4}},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("div",{staticClass:"form-card-mobile"},[e("div",{staticClass:"card-label-mobile"},[e("span",{staticClass:"required-mark"},[t._v("*")]),t._v(" 文章分类 ")]),e("el-cascader",{staticClass:"cascader-mobile",staticStyle:{width:"100%"},attrs:{options:t.typelist,props:t.props,"show-all-levels":!1,placeholder:"请选择文章分类",clearable:""},on:{change:t.handleChange},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),e("div",{staticClass:"form-card-mobile"},[e("div",{staticClass:"card-label-mobile"},[t._v("文章摘要")]),e("el-input",{staticClass:"summary-input-mobile",attrs:{placeholder:"简单描述文章内容（选填）",type:"textarea",rows:3,maxlength:"200","show-word-limit":""},model:{value:t.form.summary,callback:function(e){t.$set(t.form,"summary",e)},expression:"form.summary"}})],1),e("div",{staticClass:"form-card-mobile"},[e("div",{staticClass:"card-label-mobile"},[t._v("封面图片")]),e("div",{staticClass:"cover-upload-wrapper-mobile"},[e("oss-image-upload",{attrs:{"upload-type":"cover","max-size":1,tip:"上传封面","size-tip":"建议尺寸：1200×600px，大小不超过1MB","upload-class":"cover-uploader-mobile"},scopedSlots:t._u([{key:"default",fn:function(){return[t.form.cover?e("div",{staticClass:"upload-area-mobile"},[e("img",{staticClass:"cover-image-preview-mobile",attrs:{src:t.$getImageUrl(t.form.cover)}}),e("div",{staticClass:"upload-mask-mobile"},[e("i",{staticClass:"el-icon-upload2"}),e("span",[t._v("点击更换")])])]):e("div",{staticClass:"upload-area-mobile empty"},[e("i",{staticClass:"el-icon-picture-outline"}),e("div",{staticClass:"upload-text"},[t._v("点击上传封面")]),e("div",{staticClass:"upload-hint"},[t._v("建议尺寸 1200×600")])])]},proxy:!0}]),model:{value:t.form.cover,callback:function(e){t.$set(t.form,"cover",e)},expression:"form.cover"}}),t.form.cover?e("div",{staticClass:"cover-actions-mobile"},[e("el-button",{staticClass:"remove-cover-btn",attrs:{type:"text",size:"small"},on:{click:function(e){t.form.cover=""}}},[e("i",{staticClass:"el-icon-delete"}),t._v("移除封面 ")])],1):t._e()],1)]),e("div",{staticClass:"form-card-mobile content-card"},[e("div",{staticClass:"card-label-mobile"},[e("span",{staticClass:"required-mark"},[t._v("*")]),t._v(" 文章内容 ")]),e("div",{staticClass:"editor-wrapper-mobile"},[e("div",{staticClass:"ai-polish-bar-mobile"},[e("el-select",{staticClass:"polish-select-mobile",attrs:{size:"small",placeholder:"润色类型",disabled:t.isPolishing},model:{value:t.polishTarget,callback:function(e){t.polishTarget=e},expression:"polishTarget"}},t._l(t.targetOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("el-button",{staticClass:"polish-btn-mobile",attrs:{type:"warning",size:"small",loading:t.isPolishing,disabled:!t.form.content||t.isPolishing,icon:"el-icon-magic-stick"},on:{click:t.handleAIPolish}},[t._v(" "+t._s(t.isPolishing?t.$t("article.polishing"):t.$t("article.aiPolish"))+" ")])],1),e("wang-editor",{attrs:{placeholder:"开始写作...",height:"350px","z-index":2e3,"is-mobile":!0},on:{ready:t.handleEditorReady},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1)]),e("div",{staticClass:"bottom-spacer"})]),e("div",{staticClass:"drawer-footer-mobile"},[e("el-button",{staticClass:"cancel-btn-mobile",attrs:{size:"medium"},on:{click:function(e){t.fromVisible=!1}}},[t._v(" 取消 ")]),e("el-button",{staticClass:"submit-btn-mobile",attrs:{type:"primary",loading:t.saving,size:"medium"},on:{click:t.save}},[t._v(" "+t._s(t.saving?t.$t("article.saving"):t.$t("article.publishArticle"))+" ")])],1)]):e("el-dialog",{attrs:{title:t.form.id?t.$t("article.editArticle"):t.$t("forum.publishArticle"),visible:t.fromVisible,width:"800px","close-on-click-modal":!1,"custom-class":"article-edit-dialog"},on:{"update:visible":function(e){t.fromVisible=e},close:t.handleDialogClose}},[e("el-form",{ref:"formRef",staticClass:"article-form",attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[e("el-form-item",{attrs:{label:t.$t("article.articleTitle"),prop:"title",required:""}},[e("el-input",{staticClass:"title-input",attrs:{placeholder:t.$t("article.enterTitle"),maxlength:"100","show-word-limit":""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),e("el-form-item",{attrs:{label:t.$t("article.articleCategory"),prop:"typeid",required:""}},[e("el-cascader",{staticClass:"cascader-selector",staticStyle:{width:"100%"},attrs:{options:t.typelist,props:t.props,"show-all-levels":!1,placeholder:t.$t("article.selectCategory"),clearable:""},on:{change:t.handleChange},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1),e("el-form-item",{attrs:{label:t.$t("article.articleSummary"),prop:"summary"}},[e("el-input",{attrs:{placeholder:t.$t("article.enterSummary"),type:"textarea",rows:3,maxlength:"200","show-word-limit":""},model:{value:t.form.summary,callback:function(e){t.$set(t.form,"summary",e)},expression:"form.summary"}})],1),e("el-form-item",{attrs:{label:t.$t("article.coverImage")}},[e("oss-image-upload",{attrs:{"upload-type":"cover","max-size":1,tip:t.$t("article.uploadCoverTip"),"size-tip":t.$t("article.suggestedSize")+"，"+t.$t("article.maxSizeTip"),"upload-class":"cover-uploader"},scopedSlots:t._u([{key:"default",fn:function(){return[t.form.cover?e("div",{staticClass:"upload-area"},[e("img",{staticClass:"cover-image-preview",attrs:{src:t.$getImageUrl(t.form.cover)}}),e("div",{staticClass:"upload-mask"},[e("i",{staticClass:"el-icon-upload2"}),e("span",[t._v("更换封面")])])]):e("div",{staticClass:"upload-area empty"},[e("i",{staticClass:"el-icon-plus"}),e("div",{staticClass:"upload-text"},[t._v("上传封面图片")]),e("div",{staticClass:"upload-tip"},[t._v("建议尺寸：1200×600px")])])]},proxy:!0}],null,!1,1471520155),model:{value:t.form.cover,callback:function(e){t.$set(t.form,"cover",e)},expression:"form.cover"}}),t.form.cover?e("div",{staticClass:"cover-tip"},[e("el-button",{staticClass:"remove-cover",attrs:{type:"text"},on:{click:function(e){t.form.cover=""}}},[e("i",{staticClass:"el-icon-delete"}),t._v("移除封面 ")])],1):t._e()],1),e("el-form-item",{attrs:{label:t.$t("article.articleContent"),prop:"content",required:""}},[e("div",{staticClass:"editor-wrapper"},[e("div",{staticClass:"ai-polish-toolbar"},[e("el-select",{staticClass:"polish-target-select",attrs:{size:"small",placeholder:t.$t("article.selectPolishType"),disabled:t.isPolishing},model:{value:t.polishTarget,callback:function(e){t.polishTarget=e},expression:"polishTarget"}},t._l(t.targetOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("el-button",{staticClass:"ai-polish-btn",attrs:{type:"warning",size:"small",icon:"el-icon-magic-stick",loading:t.isPolishing,disabled:!t.form.content||t.isPolishing},on:{click:t.handleAIPolish}},[t.isPolishing?t._e():e("i",{staticClass:"el-icon-magic-stick"}),e("span",[t._v(t._s(t.isPolishing?t.$t("article.polishing"):t.$t("article.aiPolish")))])]),t.form.content?e("span",{staticClass:"toolbar-tip"},[t._v("让 AI 帮你优化文章内容")]):t._e()],1),e("wang-editor",{attrs:{placeholder:"请输入文章内容...",height:"400px","z-index":100,"is-mobile":!1},on:{ready:t.handleEditorReady},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}),e("div",{staticClass:"editor-tip"},[t._v("文章内容不能为空")])],1)])],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",loading:t.saving},on:{click:t.save}},[t._v(" "+t._s(t.saving?t.$t("article.saving"):t.$t("article.confirmSave"))+" ")])],1)],1)],1)},i=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"empty-icon"},[e("i",{staticClass:"el-icon-document-delete"})])}],o=(a(44114),a(81454),a(18962)),r=a(8723),l=a(89132),n={components:{OssImageUpload:r.A,WangEditor:l.A},data(){return{tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,fromVisible1:!1,avatar:"",content:"",loading:!1,saving:!1,isMobile:window.innerWidth<=768,isPolishing:!1,polishTarget:"readability",targetOptions:[],queryform:{keyword:"",pageNum:1,pageSize:10},license:"",value:[],form:{avatar:"",license:"",cover:""},user:{},props:{value:"id",label:"name",checkStrictly:!0,expandTrigger:"hover"},rules:{title:[{required:!0,message:this.$t("article.titleRequired"),trigger:"blur"},{min:2,max:100,message:this.$t("article.titleLengthError"),trigger:"blur"}]},ids:[],typelist:[],sjlist:[],editor:null}},mounted(){this.targetOptions=[{value:"readability",label:this.$t("article.readability")},{value:"conciseness",label:this.$t("article.conciseness")},{value:"expansion",label:this.$t("article.expansion")},{value:"correction",label:this.$t("article.correction")}],this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),this.checkMobile(),window.addEventListener("resize",this.checkMobile),this.getall(),this.getlist(),this.$nextTick((()=>{this.initCascaderClickHandler()}))},methods:{initCascaderClickHandler(){document.addEventListener("click",this.handleCascaderGlobalClick,!0)},handleCascaderGlobalClick(t){const e=t.target;if(e.classList.contains("el-cascader-node__label")){const a=e.closest(".el-cascader-node");if(a){const e=a.querySelector(".el-radio__input");e&&(e.click(),t.stopPropagation(),t.preventDefault())}}},goBack(){this.$router.push("/userhome")},handleChange(t){t&&t.length>1?(this.form.pBoardId=t[0],this.form.boardId=t[1]):t&&1==t.length&&(this.form.pBoardId=t[0])},add(){this.value=[],this.form={cover:""},this.fromVisible=!0},handleEditorReady(t){this.editor=t},chakan(t){this.content=t,this.fromVisible1=!0},cleanCategoryData(t){return t&&Array.isArray(t)?t.map((t=>{const e={...t};return e.children&&Array.isArray(e.children)&&(0===e.children.length?delete e.children:e.children=this.cleanCategoryData(e.children)),e})):[]},async getall(){try{const t=await o.A.get("/board/list");200==t.code&&(this.typelist=this.cleanCategoryData(t.data))}catch(t){console.error(t)}},del(t){this.$confirm(this.$t("article.deleteArticleConfirm"),this.$t("article.deleteConfirmTitle"),{confirmButtonText:this.$t("article.confirmDelete"),cancelButtonText:this.$t("common.cancel"),type:"warning",customClass:"delete-confirm-dialog"}).then((async()=>{try{const e=await o.A.post("/article/delete",{id:t});200==e.code&&(this.$message.success(this.$t("article.deleteSuccess")),this.getlist())}catch(e){console.error(e)}})).catch((()=>{}))},handleEdit(t){this.form={...t},this.value=[],t.pboardId&&t.boardId?this.value=[t.pboardId,t.boardId]:t.pboardId&&(this.value=[t.pboardId]),this.fromVisible=!0,this.$nextTick((()=>{setTimeout((()=>{this.initWangEditor(t.content||"")}),300)}))},search(){this.queryform.pageNum=1,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.getlist()},async getlist(){this.loading=!0;try{const t=await o.A.post("/article/myarticle",this.queryform);200==t.code&&(this.tableData=t.data.records||[],this.total=t.data.total||0)}catch(t){console.error(t),this.$message.error("加载失败，请稍后重试")}finally{this.loading=!1}},async save(){if(this.form.title&&this.form.title.trim())if(this.editor&&this.editor.txt.html()&&""!==this.editor.txt.text().trim()){this.form.content=this.editor.txt.html(),this.saving=!0;try{let t;t=this.form.id?await o.A.post("/article/update",this.form):await o.A.post("/article/post",this.form),200==t.code&&(this.fromVisible=!1,this.$message.success(this.$t("article.operationSuccess")),this.getlist())}catch(t){console.error(t),this.$message.error("保存失败，请稍后重试")}finally{this.saving=!1}}else this.$message.warning(this.$t("article.contentRequired"));else this.$message.warning(this.$t("article.titleRequired"))},handleCurrentChange(t){this.queryform.pageNum=t,this.getlist()},handleAvatarSuccess(t){200==t.code?(this.form.cover=t.data,this.$message.success(this.$t("article.coverUploadSuccess"))):this.$message.error(this.$t("article.imageUploadFailed"))},getTagType(t){const e={"前端":"success","后端":"warning","设计":"danger","测试":"info","热门":"danger","精华":"success","推荐":"warning"};return e[t]||"info"},formatDate(t){if(!t)return"-";const e=new Date(t);return e.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},async handleAIPolish(){if(!this.editor)return void this.$message.warning(this.$t("article.enterContentFirst"));const t=this.editor.txt.html();if(!t||""===t.trim()||"<p><br></p>"===t)return void this.$message.warning(this.$t("article.enterContentFirst"));const e=this.editor.txt.text();if(e&&e.trim()){this.isPolishing=!0,this.$message.info(this.$t("article.aiPolishing"));try{const t=await fetch("https://orkj406039jmw6me.top/api/article/polishContent",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+window.localStorage.getItem("token")},body:JSON.stringify({originalContent:e,target:this.polishTarget})});if(!t.ok)throw new Error(this.$t("article.polishRequestFailed"));const s=t.body.getReader(),i=new TextDecoder;let o="",r="";while(1){const{done:t,value:e}=await s.read();if(t)break;r+=i.decode(e,{stream:!0});const l=r.split("\n");r=l.pop()||"";for(const s of l)if(s.trim())try{const t=s.replace(/^data:\s*/,"").trim();if(!t)continue;const e=JSON.parse(t);if("end"===e.type)break;"content"===e.type&&e.data&&(o+=e.data,this.editor.txt.html(o))}catch(a){console.error("解析 SSE 数据失败:",a,s)}}this.editor.txt.html(o),this.form.content=o,this.$message.success(this.$t("article.polishComplete"))}catch(s){console.error("AI 润色失败:",s),this.$message.error(this.$t("article.polishFailed"))}finally{this.isPolishing=!1}}else this.$message.warning(this.$t("article.enterContentFirst"))},checkMobile(){this.isMobile=window.innerWidth<=768},handleDialogClose(){this.resetForm()},resetForm(){this.form={avatar:"",license:"",cover:"",id:"",title:"",summary:"",content:"",pBoardId:"",boardId:""},this.value=[],this.editor&&this.editor.txt.clear()}},beforeDestroy(){document.removeEventListener("click",this.handleCascaderGlobalClick,!0),this.editor&&(this.editor.destroy(),this.editor=null),window.removeEventListener("resize",this.checkMobile)}},c=n,d=a(81656),u=(0,d.A)(c,s,i,!1,null,"dd1cf786",null),h=u.exports},79420:function(t,e,a){a.d(e,{A:function(){return y}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"forum-container"},[e("ForumSidebar",{attrs:{"tree-data":t.treedata,"expanded-keys":t.expandedKeys,"current-node-key":t.currentNodeKey,"active-board-id":t.queryform.boardId,"is-mobile":t.isMobile,"is-sidebar-collapsed":t.isSidebarCollapsed,"is-sidebar-open":t.isSidebarOpen,query:t.$route.query},on:{"node-click":t.handleNodeClick,close:t.closeSidebar,navigate:t.handleNavigate,"select-community":t.handleCommunitySelect}}),t.isMobile?e("div",{staticClass:"sidebar-overlay",class:{"overlay-active":t.isSidebarOpen&&t.isMobile},on:{click:t.closeSidebar}}):t._e(),e("div",{staticClass:"main-content"},[e("div",{staticClass:"filter-bar"},[e("div",{staticClass:"filter-left"},[t.isMobile?e("div",{staticClass:"mobile-top-row"},[e("div",{staticClass:"layout-toggle"},[e("div",{staticClass:"layout-toggle-btn",class:{active:"list"===t.postsLayoutMode},attrs:{title:"列表视图"},on:{click:function(e){return t.handleLayoutChange("list")}}},[e("i",{staticClass:"el-icon-s-order"})]),e("div",{staticClass:"layout-toggle-btn",class:{active:"grid"===t.postsLayoutMode},attrs:{title:"网格视图"},on:{click:function(e){return t.handleLayoutChange("grid")}}},[e("i",{staticClass:"el-icon-s-grid"})])]),e("div",{staticClass:"sort-tabs"},[e("div",{staticClass:"sort-tab",class:{active:"all"===t.currentSort},on:{click:function(e){return t.handleSort("all")}}},[e("i",{staticClass:"el-icon-star-off"}),e("span",[t._v(t._s(t.$t("forum.all")))])]),e("div",{staticClass:"sort-tab",class:{active:"hot"===t.currentSort},on:{click:function(e){return t.handleSort("hot")}}},[e("i",{staticClass:"el-icon-trophy"}),e("span",[t._v(t._s(t.$t("forum.hot")))])]),e("div",{staticClass:"sort-tab",class:{active:"latest"===t.currentSort},on:{click:function(e){return t.handleSort("latest")}}},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v(t._s(t.$t("forum.latest")))])])]),e("div",{staticClass:"search-button",on:{click:t.goToSearchPage}},[e("i",{staticClass:"el-icon-search"})]),t.isLoggedIn?e("div",{staticClass:"action-button-mobile"},[e("el-dropdown",{attrs:{trigger:"click",placement:"bottom-end"},on:{command:t.handleActionCommand}},[e("div",{staticClass:"create-dropdown-trigger"},[e("i",{staticClass:"el-icon-plus"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"publish"}},[e("i",{staticClass:"el-icon-edit"}),t._v(" "+t._s(t.$t("forum.publishArticle"))+" ")]),e("el-dropdown-item",{attrs:{command:"createBoard"}},[e("i",{staticClass:"el-icon-folder-add"}),t._v(" "+t._s(t.$t("forum.createBoard"))+" ")])],1)],1)],1):t._e()]):t._e(),t.isMobile?t._e():[e("div",{staticClass:"layout-toggle"},[e("div",{staticClass:"layout-toggle-btn",class:{active:"list"===t.postsLayoutMode},attrs:{title:"列表视图"},on:{click:function(e){return t.handleLayoutChange("list")}}},[e("i",{staticClass:"el-icon-s-order"})]),e("div",{staticClass:"layout-toggle-btn",class:{active:"grid"===t.postsLayoutMode},attrs:{title:"网格视图"},on:{click:function(e){return t.handleLayoutChange("grid")}}},[e("i",{staticClass:"el-icon-s-grid"})])]),e("div",{staticClass:"sort-tabs"},[e("div",{staticClass:"sort-tab",class:{active:"all"===t.currentSort},on:{click:function(e){return t.handleSort("all")}}},[e("i",{staticClass:"el-icon-star-off"}),e("span",[t._v(t._s(t.$t("forum.all")))])]),e("div",{staticClass:"sort-tab",class:{active:"hot"===t.currentSort},on:{click:function(e){return t.handleSort("hot")}}},[e("i",{staticClass:"el-icon-trophy"}),e("span",[t._v(t._s(t.$t("forum.hot")))])]),e("div",{staticClass:"sort-tab",class:{active:"latest"===t.currentSort},on:{click:function(e){return t.handleSort("latest")}}},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v(t._s(t.$t("forum.latest")))])])])],t.isMobile?t._e():e("div",{staticClass:"filter-info"},[e("span",{staticClass:"active-filter"},[t._v(t._s(t.currentFilter||t.$t("forum.allPosts")))]),t.queryform.boardId||t.queryform.pBoardId?e("span",{staticClass:"reset-filter",on:{click:t.resetFilter}},[e("i",{staticClass:"el-icon-close"}),t._v(" "+t._s(t.$t("forum.resetFilter"))+" ")]):t._e()])],2),t.isLoggedIn&&!t.isMobile?e("div",{staticClass:"action-section"},[e("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleActionCommand}},[e("el-button",{attrs:{type:"primary",round:""}},[t._v(" "+t._s(t.$t("forum.create"))+" "),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"publish"}},[e("i",{staticClass:"el-icon-edit"}),t._v(" "+t._s(t.$t("forum.publishArticle"))+" ")]),e("el-dropdown-item",{attrs:{command:"createBoard"}},[e("i",{staticClass:"el-icon-folder-add"}),t._v(" "+t._s(t.$t("forum.createBoard"))+" ")])],1)],1)],1):t._e()]),e("publish-article",{ref:"publishArticlePC",staticClass:"pc-publish-hidden",attrs:{"is-mobile":!1,"button-text":""},on:{success:t.handleArticlePublished}}),e("publish-article",{ref:"publishArticleMobile",staticClass:"mobile-publish-hidden",attrs:{"is-mobile":!0,"button-text":""},on:{success:t.handleArticlePublished}}),e("create-board-dialog",{attrs:{visible:t.showCreateBoardDialog,"is-mobile":t.isMobile,boards:t.treedata},on:{"update:visible":function(e){t.showCreateBoardDialog=e},success:t.handleBoardCreated}}),e("forum-stats"),e("div",{staticClass:"posts-container",class:t.postsLayoutClass},[0!==t.contentlist.length||t.isInitialized?0===t.contentlist.length?e("div",{staticClass:"empty-state"},[e("div",{staticClass:"empty-icon"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"}},[e("path",{attrs:{d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("p",{staticClass:"empty-title"},[t._v(t._s(t.$t("common.noData")))]),e("p",{staticClass:"empty-desc"},[t._v(t._s(t.$t("forum.publishArticle"))+"!")])]):t._e():e("div",{staticClass:"skeleton-loading"},t._l(3,(function(a){return e("div",{key:a,staticClass:"skeleton-card"},[t._m(0,!0),e("div",{staticClass:"skeleton-title"}),t._m(1,!0)])})),0),t._l(t.contentlist,(function(a){return e("post-card",{key:a.id,attrs:{post:a,"hot-threshold":100,"summary-length":100},on:{click:t.godetail}})}))],2),e("div",{staticClass:"pagination-container"},[t.isMobile?e("div",{staticClass:"mobile-pagination-compact"},[e("div",{staticClass:"pagination-info"},[t._v(t._s(t.queryform.pageNum)+"/"+t._s(t.totalPages)+" 页 · 共 "+t._s(t.total)+" 条")]),e("div",{staticClass:"pagination-controls"},[e("button",{staticClass:"page-icon-btn",class:{disabled:t.queryform.pageNum<=1},attrs:{disabled:t.queryform.pageNum<=1,title:"首页"},on:{click:t.handleFirstPage}},[e("i",{staticClass:"el-icon-d-arrow-left"})]),e("button",{staticClass:"page-icon-btn",class:{disabled:t.queryform.pageNum<=1},attrs:{disabled:t.queryform.pageNum<=1,title:"上一页"},on:{click:t.handlePrevPage}},[e("i",{staticClass:"el-icon-arrow-left"})]),e("button",{staticClass:"page-icon-btn",class:{disabled:t.queryform.pageNum>=t.totalPages},attrs:{disabled:t.queryform.pageNum>=t.totalPages,title:"下一页"},on:{click:t.handleNextPage}},[e("i",{staticClass:"el-icon-arrow-right"})]),e("button",{staticClass:"page-icon-btn",class:{disabled:t.queryform.pageNum>=t.totalPages},attrs:{disabled:t.queryform.pageNum>=t.totalPages,title:"末页"},on:{click:t.handleLastPage}},[e("i",{staticClass:"el-icon-d-arrow-right"})])])]):e("el-pagination",{key:t.queryform.pageNum,staticClass:"forum-pagination",attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1),e("HotCommunities",{attrs:{query:t.queryform},on:{"select-community":t.handleCommunitySelect}}),e("div",{staticClass:"ai-chat-wrapper"},[e("transition",{attrs:{name:"chat-slide"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isChatOpen,expression:"isChatOpen"}],staticClass:"ai-chat-float"},[e("ChatWindow",{attrs:{messages:t.chatMessages,isChatLoading:t.isChatLoading,isOnline:!0,knowledgeBase:t.knowledgeBase},on:{sendMessage:t.handleSendMessage,close:t.toggleChat}})],1)]),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isChatOpen,expression:"!isChatOpen"}],staticClass:"ai-chat-toggle",class:{active:t.isChatOpen,disabled:!t.isLoggedIn},attrs:{title:t.isLoggedIn?"":"请先登录"},on:{click:t.toggleChat}},[e("div",{staticClass:"toggle-icon"},[t.isChatOpen?e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z","clip-rule":"evenodd"}})]):e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{"fill-rule":"evenodd",d:"M12.963 2.286a.75.75 0 00-1.071-.136 9.742 9.742 0 00-3.539 6.177 7.547 7.547 0 01-1.705-1.715.75.75 0 00-1.152.082A9 9 0 1015.68 4.534a7.46 7.46 0 01-2.717-2.248zM15.75 14.25a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z","clip-rule":"evenodd"}})])]),!t.isChatOpen&&t.unreadCount>0?e("div",{staticClass:"notification-badge"},[t._v(t._s(t.unreadCount))]):t._e(),t.isLoggedIn?t._e():e("div",{staticClass:"lock-icon"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{"fill-rule":"evenodd",d:"M12 1.5a5.25 5.25 0 00-5.25 5.25v3a3 3 0 00-3 3v6.75a3 3 0 003 3h10.5a3 3 0 003-3v-6.75a3 3 0 00-3-3v-3a5.25 5.25 0 00-5.25-5.25zm-3.75 8.25v-3a3.75 3.75 0 117.5 0v3h-7.5z","clip-rule":"evenodd"}})])])])],1)],1)},i=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"skeleton-header"},[e("div",{staticClass:"skeleton-avatar"}),e("div",{staticClass:"skeleton-user"},[e("div",{staticClass:"skeleton-line skeleton-name"}),e("div",{staticClass:"skeleton-line skeleton-time"})])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"skeleton-content"},[e("div",{staticClass:"skeleton-line"}),e("div",{staticClass:"skeleton-line"}),e("div",{staticClass:"skeleton-line short"})])}],o=(a(44114),a(17642),a(58004),a(33853),a(45876),a(32475),a(15024),a(31698),a(81454),a(18962)),r=a(27627),l=a(33827),n=a(29455),c=a(4380),d=a(9276),u=a(36197),h=a(81629),m=a(82329),p={name:"UserHome",components:{PublishArticle:r.A,ChatWindow:l.A,ForumSidebar:n.A,HotCommunities:c.A,PostCard:d.A,CreateBoardDialog:h.A,ForumStats:m.A},data(){return{defaultProps:{children:"children",label:"name"},total:0,treedata:[],contentlist:[],queryform:{boardId:"",pageNum:1,pBoardId:"",pageSize:10,status:1},user:{},currentFilter:"",currentSort:"all",expandedKeys:[1,2,5],currentNodeKey:null,isInitialized:!1,isRestoringFilterState:!1,hasTriedRestoreState:!1,chatMessages:[],isChatLoading:!1,knowledgeBase:[],isChatOpen:!1,unreadCount:0,aiConfig:null,isMobile:window.innerWidth<=768,isSidebarOpen:!1,isSidebarCollapsed:!1,activeCollapseNames:[],windowWidth:window.innerWidth,showCreateBoardDialog:!1,postsLayoutMode:"list"}},computed:{isLoggedIn(){return!!window.localStorage.getItem("token")},postsLayoutClass(){return{"posts-layout-list":"list"===this.postsLayoutMode,"posts-layout-grid":"grid"===this.postsLayoutMode}},totalPages(){return Math.ceil(this.total/this.queryform.pageSize)||1}},mounted(){console.log("[UserHome] mounted 开始执行"),this.user=JSON.parse(window.localStorage.getItem("userinfo")||"{}"),this.getlist().then((()=>{if(console.log("[UserHome] getlist 完成，开始检查筛选状态",{routeQuery:this.$route.query,isInitialized:this.isInitialized}),!this.$route.query.boardId&&!this.$route.query.pBoardId){console.log("[UserHome] URL 无参数，尝试恢复筛选状态"),this.hasTriedRestoreState=!0;const t=this.restoreFilterState();if(console.log("[UserHome] 恢复结果:",t),t)return this.isInitialized=!0,void console.log("[UserHome] 状态恢复成功，设置 isInitialized = true，当前 pageNum:",this.queryform.pageNum)}console.log("[UserHome] 无需恢复状态或恢复失败，执行默认初始化"),this.hasTriedRestoreState=!0,this.isInitialized=!0,this.handleRouteQuery(this.$route.query)})),this.loadAiConfig(),this.loadKnowledgeBase(),0===this.chatMessages.length&&(this.chatMessages=this.loadChatMessages()),window.addEventListener("storage",this.handleStorageChange),this.checkMobile(),window.addEventListener("resize",this.handleResize),this.$root.$on("toggle-mobile-sidebar",this.handleToggleFromLogo),this.loadPostsLayoutPreference()},beforeDestroy(){window.removeEventListener("storage",this.handleStorageChange),window.removeEventListener("resize",this.handleResize),this.$root.$off("toggle-mobile-sidebar",this.handleToggleFromLogo)},activated(){this.loadAiConfig(),this.loadKnowledgeBase()},watch:{$route(t,e){"/userhome"===t.path&&"/ai-settings"===e.path&&(this.loadAiConfig(),this.loadKnowledgeBase()),"/userhome"===t.path&&"/userhomedetail"===e.path&&(!this.isInitialized||this.isRestoringFilterState||this.hasTriedRestoreState||(console.log("[UserHome] 从详情页返回，恢复筛选状态"),this.hasTriedRestoreState=!0,this.restoreFilterState()))},"$route.query":{immediate:!0,handler(t){if(console.log("[UserHome] watch $route.query 触发",{newQuery:t,isInitialized:this.isInitialized,hasTriedRestoreState:this.hasTriedRestoreState,isRestoringFilterState:this.isRestoringFilterState}),this.isInitialized){if(this.hasTriedRestoreState&&!t.boardId&&!t.pBoardId)return void console.log("[UserHome] 已恢复状态且 URL 无参数，跳过 handleRouteQuery");this.handleRouteQuery(t)}}},"$i18n.locale"(){(this.queryform.boardId||this.queryform.pBoardId)&&this.updateCurrentFilter()},chatMessages:{handler(t){this.saveChatMessages(t)},deep:!0},treedata:{handler(){},immediate:!1}},methods:{saveFilterState(){const t={boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum,currentSort:this.currentSort,currentFilter:this.currentFilter,currentNodeKey:this.currentNodeKey};console.log("[UserHome] 保存筛选状态:",t);try{sessionStorage.setItem("forum_filter_state",JSON.stringify(t)),console.log("[UserHome] 筛选状态已保存到 sessionStorage")}catch(e){console.error("[UserHome] 保存筛选状态失败:",e)}},restoreFilterState(){try{const t=sessionStorage.getItem("forum_filter_state");if(console.log("[UserHome] 尝试恢复筛选状态，保存的状态:",t),t){const e=JSON.parse(t);return console.log("[UserHome] 解析后的筛选状态:",e),this.isRestoringFilterState=!0,this.$set(this.queryform,"boardId",e.boardId||""),this.$set(this.queryform,"pBoardId",e.pBoardId||""),this.$set(this.queryform,"pageNum",e.pageNum||1),this.currentSort=e.currentSort||"all",this.currentFilter=e.currentFilter||this.$t("forum.allPosts"),this.currentNodeKey=e.currentNodeKey,console.log("[UserHome] 恢复后的参数:",{boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum,currentSort:this.currentSort,currentFilter:this.currentFilter,currentNodeKey:this.currentNodeKey}),(this.queryform.boardId||this.queryform.pBoardId)&&this.updateExpandedKeys(),this.getcontent().finally((()=>{this.queryform.pageNum>this.totalPages&&(console.log("[UserHome] 恢复的页码超出总页数，重置到第一页",{"恢复的页码":this.queryform.pageNum,"总页数":this.totalPages}),this.queryform.pageNum=1,this.clearFilterState()),this.isRestoringFilterState=!1,this.$forceUpdate(),console.log("[UserHome] 筛选状态恢复完成，内容已重新加载，当前 pageNum:",this.queryform.pageNum)})),console.log("[UserHome] 筛选状态已恢复:",e),!0}console.log("[UserHome] 没有找到保存的筛选状态")}catch(t){console.error("[UserHome] 恢复筛选状态失败:",t)}return!1},clearFilterState(){try{sessionStorage.removeItem("forum_filter_state")}catch(t){console.error("[UserHome] 清除筛选状态失败:",t)}},handleStorageChange(t){"huomiao_ai_config"===t.key&&this.loadAiConfig(),"huomiao_knowledge_base"===t.key&&this.loadKnowledgeBase(),"huomiao_ai_online"===t.key&&this.loadAiConfig(),"huomiao_chat_cleared"===t.key&&(this.chatMessages=this.loadChatMessages())},loadChatMessages(){try{const t=localStorage.getItem("huomiao_chat_history");if(t)return JSON.parse(t)}catch(t){console.error("加载聊天历史失败:",t)}return[{id:"welcome",role:"model",text:"你好！我是论坛小助手火妙，有什么可以帮你的吗？",timestamp:Date.now()}]},saveChatMessages(t){try{localStorage.setItem("huomiao_chat_history",JSON.stringify(t))}catch(e){console.error("保存聊天历史失败:",e)}},loadAiConfig(){try{const t=u.A.loadConfig();this.aiConfig={protocol:t.protocol||"openai-compatible",baseUrl:t.baseUrl||"",apiKey:t.apiKey||"",modelId:t.modelId||"",systemPrompt:t.systemPrompt||""}}catch(t){console.error("加载 AI 配置失败:",t)}},loadKnowledgeBase(){try{const t=localStorage.getItem("huomiao_knowledge_base");this.knowledgeBase=t?JSON.parse(t):[]}catch(t){console.error("加载知识库失败:",t),this.knowledgeBase=[]}},initData(){this.getlist().then((()=>{this.isInitialized=!0,this.handleRouteQuery(this.$route.query)}))},handleRouteQuery(t){if(console.log("[UserHome] handleRouteQuery 被调用",{query:t,isInitialized:this.isInitialized,isRestoringFilterState:this.isRestoringFilterState,currentPageNum:this.queryform.pageNum}),this.isInitialized)if(this.isRestoringFilterState)console.log("[UserHome] handleRouteQuery: 正在恢复状态，跳过");else{if(!t.pBoardId&&!t.boardId){const t=this.queryform.boardId||this.queryform.pBoardId;return t?void console.log("[UserHome] URL 无参数，但保持已恢复的筛选条件",{boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum}):(console.log("[UserHome] URL 无参数且无筛选条件，重置为全部帖子"),this.queryform.boardId="",this.queryform.pBoardId="",this.queryform.pageNum=1,this.currentNodeKey=null,this.currentFilter=this.$t("forum.allPosts"),void this.getcontent())}console.log("[UserHome] URL 有参数，根据参数设置筛选条件"),this.queryform.boardId=t.boardId||"",this.queryform.pBoardId=t.pBoardId||"",this.queryform.pageNum=1,this.currentNodeKey=null,t.boardId?this.currentNodeKey=parseInt(t.boardId):t.pBoardId&&(this.currentNodeKey=parseInt(t.pBoardId)),this.updateExpandedKeys(),this.updateCurrentFilter(),this.getcontent()}else console.log("[UserHome] handleRouteQuery: 未初始化，跳过")},updateExpandedKeys(){const t=new Set([...this.expandedKeys]);if(this.queryform.pBoardId&&t.add(parseInt(this.queryform.pBoardId)),this.queryform.boardId&&this.treedata.length>0){const e=(t,a)=>{for(const s of t)if(s.children){for(const e of s.children)if(e.id==a)return s.id;const t=e(s.children,a);if(t)return t}return null},a=e(this.treedata,this.queryform.boardId);a&&t.add(a)}this.expandedKeys=Array.from(t)},handleNodeClick(t){const e={};0!=t.pid?(e.boardId=t.id,e.pBoardId=t.pid):e.pBoardId=t.id;const a=this.$route.query,s=a.boardId==e.boardId&&a.pBoardId==e.pBoardId;s?(this.queryform.boardId=e.boardId||"",this.queryform.pBoardId=e.pBoardId||"",this.queryform.pageNum=1,this.currentNodeKey=t.id,this.updateExpandedKeys(),this.updateCurrentFilter(),this.getcontent(),this.saveFilterState()):this.$router.push({path:"/userhome",query:e}).catch((t=>{"NavigationDuplicated"!==t.name&&console.error("导航错误:",t)})),this.isMobile&&this.isSidebarOpen&&this.toggleSidebar()},goHome(){const t=this.$route.query.boardId||this.$route.query.pBoardId;"/userhome"!==this.$route.path?this.$router.push({path:"/userhome",query:{}}):t&&this.$router.push({path:"/userhome",query:{}}).catch((t=>{"NavigationDuplicated"!==t.name&&console.error("导航错误:",t)})),this.clearFilterState()},handleNavigate(t){"home"===t?this.goHome():"community"===t?this.$message.info("社区广场功能开发中..."):"createBoard"===t&&this.openCreateBoardDialog()},resetFilter(){this.queryform.boardId="",this.queryform.pBoardId="",this.queryform.pageNum=1,this.currentFilter=this.$t("forum.allPosts"),this.getcontent(),this.clearFilterState(),this.isMobile&&this.isSidebarOpen&&(this.isSidebarOpen=!1),(this.$route.query.boardId||this.$route.query.pBoardId)&&this.$router.push({path:"/userhome",query:{}}),this.$message.success(this.$t("forum.resetFilter")+" - "+this.$t("forum.allPosts"))},getTreeIcon(t){return t.children&&t.children.length>0?"el-icon-folder":"el-icon-document"},isSubCategoryActive(t){return this.queryform.boardId==t},godetail(t){this.saveFilterState(),this.$router.push({path:"/userhomedetail",query:{id:t.id}})},handleCurrentChange(t){this.queryform.pageNum=t,this.getcontent(),this.saveFilterState()},handlePrevPage(){this.queryform.pageNum>1&&(this.queryform.pageNum--,this.getcontent(),this.saveFilterState())},handleNextPage(){this.queryform.pageNum<this.totalPages&&(this.queryform.pageNum++,this.getcontent(),this.saveFilterState())},handleFirstPage(){this.queryform.pageNum>1&&(this.queryform.pageNum=1,this.getcontent(),this.saveFilterState())},handleLastPage(){this.queryform.pageNum<this.totalPages&&(this.queryform.pageNum=this.totalPages,this.getcontent(),this.saveFilterState())},async getlist(){try{const t=await o.A.get("/board/list");return 200==t.code||1==t.code?(this.treedata=t.data,this.$nextTick((()=>{this.checkMobile()})),Promise.resolve()):(console.error("[getlist] 获取失败:",t.msg),Promise.reject(new Error(t.msg)))}catch(t){return console.error("[getlist] 请求异常:",t),Promise.reject(t)}},async getcontent(){console.log("[UserHome] getcontent 被调用",{pageNum:this.queryform.pageNum,pageSize:this.queryform.pageSize,boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId});try{const t={pageNum:this.queryform.pageNum,pageSize:this.queryform.pageSize,statusInteger:1};this.queryform.pBoardId&&(t.pBoardId=this.queryform.pBoardId),this.queryform.boardId&&(t.boardId=this.queryform.boardId),console.log("[UserHome] getcontent 请求参数:",t);const e=await o.A.post("/article/list",t);if(200==e.code||1==e.code){this.$set(this,"contentlist",e.data.records||[]),this.$set(this,"total",e.data.total||0);const t=Math.ceil((e.data.total||0)/this.queryform.pageSize)||1;console.log("[UserHome] getcontent 请求成功",{"返回的页码":e.data.current,"总记录数":e.data.total,"当前页记录数":(e.data.records||[]).length,"总页数":t,"当前请求页码":this.queryform.pageNum}),this.queryform.pageNum>t&&t>0&&(console.log("[UserHome] 当前页码超出总页数，自动跳转到第一页",{"当前页码":this.queryform.pageNum,"总页数":t}),this.queryform.pageNum=1,this.clearFilterState(),this.getcontent())}else this.$set(this,"contentlist",[]),this.$set(this,"total",0)}catch(t){console.error("[UserHome] getcontent 请求失败:",t),this.$set(this,"contentlist",[]),this.$set(this,"total",0)}},updateCurrentFilter(){if(!this.queryform.boardId&&!this.queryform.pBoardId)return void(this.currentFilter=this.$t("forum.allPosts"));const t=(e,a)=>{for(const s of e){if(s.id==a)return s.name;if(s.children&&s.children.length>0){const e=t(s.children,a);if(e)return e}}return null};let e="";this.queryform.boardId?e=t(this.treedata,this.queryform.boardId):this.queryform.pBoardId&&(e=t(this.treedata,this.queryform.pBoardId)),this.currentFilter=e?`${this.$t("forum.allPosts")} - ${e}`:this.$t("forum.allPosts")},handleArticlePublished(){this.$message.success(this.$t("article.publishSuccess")),this.getcontent()},async handleSort(t){if(this.currentSort===t)return;this.currentSort=t;const e={all:this.$t("forum.allPosts"),hot:this.$t("forum.hot")+" "+this.$t("nav.forum"),latest:this.$t("forum.latest")+" "+this.$t("nav.forum")};this.currentFilter=e[t],this.queryform.pageNum=1,"hot"===t?await this.getTopReadArticles():"latest"===t?await this.getLatestArticles():await this.getcontent(),this.saveFilterState()},async getLatestArticles(){try{const t=await o.A.post("/article/latest");200==t.code||1==t.code?(this.$set(this,"contentlist",t.data||[]),this.$set(this,"total",(t.data||[]).length)):(this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error(t.msg||"获取最新文章失败"))}catch(t){console.error("获取最新文章失败:",t),this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error("获取最新文章失败，请稍后重试")}},async getTopReadArticles(){try{const t=await o.A.post("/article/topReadCount");200==t.code||1==t.code?(this.$set(this,"contentlist",t.data||[]),this.$set(this,"total",(t.data||[]).length)):(this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error(t.msg||"获取热门文章失败"))}catch(t){console.error("获取热门文章失败:",t),this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error("获取热门文章失败，请稍后重试")}},handleCommunitySelect(t){this.queryform.boardId=t.boardId,this.queryform.pBoardId=t.pBoardId,this.queryform.pageNum=1,this.currentFilter=t.name,this.getcontent(),this.saveFilterState(),this.isMobile&&this.isSidebarOpen&&(this.isSidebarOpen=!1),this.$message.success(`已筛选：${t.name}`)},toggleChat(){this.isChatOpen||this.isLoggedIn?(this.isChatOpen=!this.isChatOpen,this.isChatOpen&&(this.unreadCount=0)):this.$message.warning("请先登录后再使用 AI 聊天功能")},async handleSendMessage(t){if(this.isLoggedIn){if(t.trim()){this.chatMessages.push({id:Date.now().toString(),role:"user",text:t,timestamp:Date.now()}),this.isChatLoading=!0;try{await this.callAiServiceStream()}catch(e){console.error("AI 服务调用失败:",e),this.chatMessages.push({id:(Date.now()+1).toString(),role:"system",text:"AI 服务暂时不可用，请稍后再试。",timestamp:Date.now()}),this.isChatLoading=!1}}}else this.$message.warning("请先登录后再使用 AI 聊天功能")},async callAiServiceStream(){try{const t=(Date.now()+1).toString();let e="",a=[],s=!1,i=-1;u.A.chatStream(this.chatMessages,(a=>{s?(e+=a,this.chatMessages[i].text=e,this.$set(this.chatMessages,i,{...this.chatMessages[i]})):(this.chatMessages.push({id:t,role:"model",text:a,timestamp:Date.now(),usedKnowledge:[]}),i=this.chatMessages.length-1,s=!0)}),(t=>{a=t,i>=0&&(this.chatMessages[i].usedKnowledge=t)}),(()=>{if(this.isChatLoading=!1,this.isChatOpen||this.unreadCount++,a&&a.length>0&&i>=0){const t=a.map((t=>`📚 ${t.title}`)).join("\n");this.chatMessages[i].text+=`\n\n---\n${t}`,this.$set(this.chatMessages,i,{...this.chatMessages[i]})}}),(t=>{console.error("AI 流式响应错误:",t),s&&i>=0&&this.chatMessages.splice(i,1),this.chatMessages.push({id:(Date.now()+2).toString(),role:"system",text:this.getFriendlyErrorMessage(t),timestamp:Date.now()}),this.isChatLoading=!1}))}catch(t){throw console.error("AI 服务错误:",t),this.isChatLoading=!1,t}},getFriendlyErrorMessage(t){const e=t.message||t.toString()||"";return e.includes("API Key")||e.includes("apiKey")?"请先配置有效的 API Key。配置路径：管理后台 → 信息管理 → AI设置管理":e.includes("网络")||e.includes("fetch")||e.includes("timeout")?"网络连接失败，请检查网络设置后重试":e.includes("rate limit")||e.includes("429")?"请求过于频繁，请稍后再试":e.includes("quota")||e.includes("balance")?"API 额度不足，请检查账户余额":"抱歉，我暂时无法回复。请稍后再试或联系管理员"},async callAiService(){try{return new Promise(((t,e)=>{let a="",s=[];u.A.chatStream(this.chatMessages,(t=>{a+=t}),(t=>{s=t}),(()=>{t({reply:a,usedKnowledge:s,latency:0})}),(t=>{e(t)}))}))}catch(t){throw console.error("AI 服务错误:",t),t}},handleToggleFromLogo(){this.isMobile&&this.toggleSidebar()},checkMobile(){const t=window.innerWidth;this.windowWidth=t,this.isMobile=t<=768,this.isMobile?this.isSidebarCollapsed=!0:this.isSidebarCollapsed=!1},handleResize(){this.checkMobile()},toggleSidebar(){this.isMobile?(this.isSidebarOpen=!this.isSidebarOpen,this.isSidebarOpen?document.body.style.overflow="hidden":document.body.style.overflow=""):this.isSidebarCollapsed=!this.isSidebarCollapsed},closeSidebar(){this.isMobile&&this.isSidebarOpen&&(console.log("[UserHome] 关闭移动端侧边栏"),this.isSidebarOpen=!1,document.body.style.overflow="")},goToSearchPage(){this.$router.push("/mobile-search")},handleActionCommand(t){"publish"===t?this.$nextTick((()=>{this.isMobile?this.$refs.publishArticleMobile?this.$refs.publishArticleMobile.openDialog():console.error("[UserHome] publishArticleMobile ref not found"):this.$refs.publishArticlePC?this.$refs.publishArticlePC.openDialog():console.error("[UserHome] publishArticlePC ref not found")})):"createBoard"===t&&this.openCreateBoardDialog()},openCreateBoardDialog(){this.isLoggedIn?this.showCreateBoardDialog=!0:this.$message.warning("请先登录后再创建板块")},async handleBoardCreated(){console.log("[UserHome] 板块创建成功，刷新板块列表"),await this.getlist()},handleLayoutChange(t){this.postsLayoutMode=t,this.savePostsLayoutPreference(t);const e="list"===t?"列表视图":"网格视图";this.$message.success(`已切换到${e}`)},savePostsLayoutPreference(t){try{localStorage.setItem("posts_layout_mode",t)}catch(e){console.error("[UserHome] 保存布局偏好失败:",e)}},loadPostsLayoutPreference(){try{const t=localStorage.getItem("posts_layout_mode");!t||"list"!==t&&"grid"!==t||(this.postsLayoutMode=t)}catch(t){console.error("[UserHome] 加载布局偏好失败:",t)}}}},g=p,f=a(81656),b=(0,f.A)(g,s,i,!1,null,"6192b394",null),y=b.exports}}]);