"use strict";(self["webpackChunkhard_diancan_front"]=self["webpackChunkhard_diancan_front"]||[]).push([[119],{42051:function(t,e,i){i.d(e,{A:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"forum-container"},[t.loadingPage?e("div",{staticClass:"page-loading"},[e("div",{staticClass:"loading-content"},[t._m(0),e("div",{staticClass:"loading-text"},[t._v(t._s(t.$t("article.loadingContent")))])])]):t._e(),t.isMobile?e("div",{staticClass:"sidebar-overlay",class:{"overlay-active":t.isSidebarOpen&&t.isMobile},on:{click:t.toggleSidebar}}):t._e(),e("ForumSidebar",{attrs:{"tree-data":t.treedata,"expanded-keys":t.expandedKeys,"current-node-key":t.currentNodeKey,"active-board-id":t.queryform.boardId,"is-mobile":t.isMobile,"is-sidebar-collapsed":t.isSidebarCollapsed,"is-sidebar-open":t.isSidebarOpen,query:t.$route.query},on:{"node-click":t.handleNodeClick,close:t.toggleSidebar,navigate:t.handleNavigate}}),e("div",{staticClass:"main-content"},[e("div",{staticClass:"back-button-container"},[e("el-button",{staticClass:"back-button",attrs:{icon:"el-icon-arrow-left",type:"text"},on:{click:t.goBack}},[t._v(" "+t._s(t.$t("article.backToPrevious"))+" ")])],1),e("div",{staticClass:"container-box"},[e("div",{staticClass:"article-card"},[e("div",{staticClass:"article-header"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.info.title))]),e("div",{staticClass:"article-meta"},[e("div",{staticClass:"meta-item"},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v(t._s(t.info.postTime))])]),e("div",{staticClass:"meta-item"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v(t._s(t.info.nickName))])])])]),e("div",{staticClass:"article-content",domProps:{innerHTML:t._s(t.info.content)}}),t.fjlist.length>0?e("div",{staticClass:"attachments"},[e("div",{staticClass:"attachments-title"},[e("i",{staticClass:"el-icon-document"}),e("span",[t._v(t._s(t.$t("article.attachmentDownload")))])]),e("div",{staticClass:"attachments-list"},t._l(t.fjlist,(function(i){return e("div",{key:i.fileId,staticClass:"attachment-item",on:{click:function(e){return t.xiazai(i)}}},[e("i",{staticClass:"el-icon-download attachment-icon"}),e("span",{staticClass:"attachment-name"},[t._v(t._s(i.fileName))]),i.fileSize?e("span",{staticClass:"attachment-size"},[t._v(t._s(t.$formatFileSize(i.fileSize)))]):t._e()])})),0)]):t._e(),e("div",{staticClass:"article-actions"},[e("div",{staticClass:"action-item",class:{active:t.havelike},on:{click:t.like}},[e("i",{staticClass:"el-icon-star-on"}),e("span",[t._v(t._s(t.info.goodCount||0))])]),e("div",{staticClass:"action-btn"},[e("i",{staticClass:"el-icon-s-comment"}),e("span",{staticClass:"action-text"},[t._v(t._s(t.$t("article.comments")))]),e("span",{staticClass:"action-count"},[t._v(t._s(t.info.commentCount||0))])]),e("div",{staticClass:"action-btn"},[e("i",{staticClass:"el-icon-view"}),e("span",{staticClass:"action-text"},[t._v(t._s(t.$t("article.view")))]),e("span",{staticClass:"action-count"},[t._v(t._s(t.info.readCount||0))])]),e("el-button",{staticClass:"comment-btn",attrs:{type:"primary",disabled:t.commentButtonDisabled},on:{click:t.pl}},[e("i",{staticClass:"el-icon-edit"}),t._v(" "+t._s(t.commentButtonText)+" ")])],1)]),e("div",{staticClass:"comments-section"},[e("div",{staticClass:"section-header"},[e("h3",{staticClass:"section-title"},[e("i",{staticClass:"el-icon-chat-dot-square"}),t._v(" "+t._s(t.$t("article.allComments"))+" "),e("span",{staticClass:"comment-count"},[t._v(t._s(t.commentlist.length))])])]),0===t.commentlist.length?e("div",{staticClass:"empty-comments"},[e("div",{staticClass:"empty-comment-icon"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"}},[e("path",{attrs:{d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("p",{staticClass:"empty-comment-title"},[t._v(t._s(t.$t("article.noCommentsYet")))]),e("p",{staticClass:"empty-comment-desc"},[t._v(t._s(t.$t("article.beFirstToComment")))])]):t._e(),e("div",{staticClass:"comments-list"},t._l(t.commentlist,(function(i){return e("div",{key:i.commentId,staticClass:"comment-item"},[e("comment-item",{attrs:{comment:i,type:"main","current-user-id":t.user?t.user.id:null,"article-author-id":t.info.userId,"can-pin":t.user&&t.user.userId==t.info.userId},on:{like:t.commentlike,reply:t.pl1,pin:t.zd,delete:t.delComment}}),i.children&&i.children.length>0?e("div",{staticClass:"comment-replies"},t._l(i.children,(function(s){return e("comment-item",{key:s.commentId,attrs:{comment:s,type:"reply","current-user-id":t.user?t.user.id:null,"article-author-id":t.info.userId,"can-pin":t.user&&t.user.userId==t.info.userId},on:{like:t.commentlike,reply:()=>t.pl2(s,i),pin:t.zd,delete:t.delComment}})})),1):t._e()],1)})),0)])])]),e("el-dialog",{class:t.isMobile?"mobile-comment-dialog":"comment-dialog",attrs:{title:0===t.form.pCommentId?t.$t("article.publishComment"):t.$t("article.replyToComment"),visible:t.fromVisible,width:t.isMobile?"100%":"600px","close-on-click-modal":!1,"modal-append-to-body":!0,"append-to-body":!0,"custom-class":"comment-dialog-wrapper"},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticClass:"comment-form",attrs:{model:t.form,"label-width":t.isMobile?"60px":"80px"}},[e("el-form-item",{attrs:{label:t.$t("article.contentLabel"),prop:"content",required:""}},[e("el-input",{staticClass:"comment-textarea",attrs:{type:"textarea",rows:t.isMobile?6:4,placeholder:t.isMobile?t.$t("article.saySomething"):t.$t("article.enterCommentContent"),maxlength:"500","show-word-limit":"",resize:"none"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),e("el-form-item",{attrs:{label:t.$t("article.imageLabel")}},[t.isMobile?[t.form.imagePath?t._e():e("oss-image-upload",{attrs:{"upload-type":"comment","max-size":1,tip:t.$t("article.uploadImage"),"size-tip":"大小不超过1MB","upload-class":"upload-area"},scopedSlots:t._u([{key:"default",fn:function(){return[e("div",{staticClass:"upload-content mobile-upload"},[e("i",{staticClass:"el-icon-plus upload-icon"})])]},proxy:!0}],null,!1,1607958322),model:{value:t.form.imagePath,callback:function(e){t.$set(t.form,"imagePath",e)},expression:"form.imagePath"}}),t.form.imagePath?e("div",{staticClass:"mobile-image-preview"},[e("div",{staticClass:"preview-wrapper"},[e("img",{staticClass:"preview-image",attrs:{src:t.$getImageUrl(t.form.imagePath)}}),e("i",{staticClass:"el-icon-error close-icon",on:{click:function(e){t.form.imagePath=""}}})])]):t._e()]:[e("oss-image-upload",{attrs:{"upload-type":"comment","max-size":1,tip:t.$t("article.uploadImage"),"size-tip":"大小不超过1MB","upload-class":"upload-area"},scopedSlots:t._u([{key:"default",fn:function(){return[e("div",{staticClass:"upload-content",class:{"mobile-upload":t.isMobile}},[t.form.imagePath?t._e():e("i",{staticClass:"el-icon-plus upload-icon"}),t.form.imagePath?e("img",{staticClass:"upload-preview",attrs:{src:t.$getImageUrl(t.form.imagePath)}}):t._e()])]},proxy:!0}],null,!1,1306826488),model:{value:t.form.imagePath,callback:function(e){t.$set(t.form,"imagePath",e)},expression:"form.imagePath"}}),e("div",{staticClass:"upload-tip"},[t._v("支持上传图片，大小不超过1MB")])]],2)],1),e("div",{class:t.isMobile?"mobile-dialog-footer":"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.isMobile?[e("el-button",{staticClass:"mobile-btn mobile-btn-cancel",attrs:{size:"large"},on:{click:function(e){t.fromVisible=!1}}},[t._v("取消")]),e("el-button",{staticClass:"mobile-btn mobile-btn-confirm",attrs:{type:"primary",loading:t.loading,size:"large"},on:{click:t.save}},[t._v(" "+t._s(t.loading?t.$t("article.publishing"):t.$t("article.publish"))+" ")])]:[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.save}},[t._v("确定")])]],2)],1)],1)},o=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"loading-spinner"},[e("div",{staticClass:"spinner"}),e("div",{staticClass:"spinner"}),e("div",{staticClass:"spinner"}),e("div",{staticClass:"spinner"})])}],a=(i(44114),i(18962)),n=i(29455),l=i(8723),r=i(92646),c=i(35637),d={name:"ArticleDetail",components:{ForumSidebar:n.A,OssImageUpload:l.A,UserAvatar:r.A,CommentItem:c.A},data(){return{info:{},fromVisible:!1,form:{},total:0,commentlist:[],havelike:!1,fjlist:[],comment:"",comment1:"",receive:"",receive1:"",receive3:"",loading:!1,user:null,token:"",commentButtonDisabled:!0,commentButtonText:"",loadingPage:!0,loadingTime:0,keyboardOpen:!1,treedata:[],expandedKeys:[1,2,5],currentNodeKey:null,queryform:{boardId:"",pBoardId:""},isMobile:!1,isSidebarOpen:!1,isSidebarCollapsed:!1,windowWidth:window.innerWidth}},mounted(){this.commentButtonText=this.$t("article.publishComment"),this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),this.startLoadingTimer(),this.getdata(),this.getBoardList(),this.checkMobile(),window.addEventListener("resize",this.handleResize),this.$root.$on("toggle-mobile-sidebar",this.handleToggleFromLogo),setTimeout((()=>{this.commentButtonDisabled=!1}),500)},methods:{goBack(){window.history.length>1?this.$router.go(-1):this.$router.push("/userhome")},startLoadingTimer(){this.loadingTime=setTimeout((()=>{this.loadingPage}),3e3)},clearLoadingTimer(){this.loadingTime&&(clearTimeout(this.loadingTime),this.loadingTime=0)},async getBoardList(){try{const t=await a.A.get("/board/list");200==t.code&&(this.treedata=t.data)}catch(t){console.error(t)}},handleNavClick(t){this.activeNav=t},handleNodeClick(t){this.$router.push({path:"/userhome",query:{boardId:0!=t.pid?t.id:"",pBoardId:0!=t.pid?t.pid:t.id}}),window.innerWidth<=768&&this.closeMobileSidebar()},handleNavigate(t){"home"===t?this.$router.push({path:"/userhome",query:{}}):"community"===t&&this.$message.info("社区广场功能开发中...")},toggleMobileSidebar(){this.mobileSidebarOpen=!this.mobileSidebarOpen},closeMobileSidebar(){this.mobileSidebarOpen=!1},handleToggleFromLogo(){this.toggleMobileSidebar()},pl1(t){const e=localStorage.getItem("userinfo");e?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:t.commentId,replyUserId:t.userId,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error(this.$t("article.notLoggedIn"))},pl2(t,e){const i=localStorage.getItem("userinfo");i?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:e.commentId,replyUserId:t.userId,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error(this.$t("article.notLoggedIn"))},pl(){if(this.commentButtonDisabled)return void console.log("[评论] 按钮还在禁用期内，忽略点击");const t=localStorage.getItem("userinfo");t?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:0,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error(this.$t("article.notLoggedIn"))},async zd(t){const e=localStorage.getItem("userinfo");if(e)try{const e=await a.A.post("/article/changeTop",{commentId:t});200==e.code&&(this.$message.success(e.message||this.$t("article.operationSuccess")),this.getdata())}catch(i){console.error(i)}else this.$message.error(this.$t("article.notLoggedIn"))},async commentlike(t){const e=localStorage.getItem("userinfo");if(e)try{const e=await a.A.post("/article/commentlike",{commentId:t});200==e.code&&this.getdata()}catch(i){console.error(i)}else this.$message.error(this.$t("article.notLoggedIn"))},async getlist(){try{const t=await a.A.post("/article/loadcomment",{articleId:this.info.id});200==t.code&&(this.commentlist=t.data)}catch(t){console.error("加载评论失败:",t),this.commentlist=[]}},async xiazai(t){try{await a.A.get("/article/downloadAttachment?fileId="+t.fileId);this.$message.success(this.$t("article.startDownload"))}catch(e){console.error(e)}},async like(){const t=localStorage.getItem("userinfo");if(!t)return void this.$message.error(this.$t("article.notLoggedIn"));const e=this.havelike,i=this.info.goodCount||0;this.havelike=!e,this.info.goodCount=e?i-1:i+1;try{const t=await a.A.post("/article/dolike",{id:this.info.id});200==t.code||(this.havelike=e,this.info.goodCount=i,this.$message.error(t.msg||this.$t("article.operationFailed")))}catch(s){this.havelike=e,this.info.goodCount=i,this.$message.error("网络错误，请稍后重试")}},async delComment(t){this.$confirm(this.$t("article.deleteCommentConfirm"),this.$t("common.confirm"),{confirmButtonText:this.$t("article.confirmDelete"),cancelButtonText:this.$t("common.cancel"),type:"warning",customClass:"delete-confirm"}).then((async()=>{try{const e=await a.A.post("/article/deletecomment",{commentId:t});200==e.code||1==e.code?(this.$message.success(this.$t("article.deleteSuccess")),this.getlist(),this.info&&void 0!==this.info.commentCount&&(this.info.commentCount=Math.max(0,this.info.commentCount-1))):this.$message.error(e.msg||this.$t("article.deleteFailed"))}catch(e){console.error("删除评论失败:",e),this.$message.error(this.$t("article.operationRetry"))}})).catch((()=>{}))},async save(){if(this.form.content&&""!==this.form.content.trim()){this.loading=!0;try{const t=await a.A.post("/article/postcomment",{articleId:this.form.articleId,pCommentId:this.form.pCommentId,content:this.form.content,imagePath:this.form.imagePath,replyUserId:this.form.replyUserId});200==t.code&&(this.$message.success(this.$t("article.commentSuccess")),this.fromVisible=!1,this.getdata())}catch(t){console.error(t)}finally{this.loading=!1}}else this.$message.warning(this.$t("article.enterCommentContent"))},async getdata(){try{const t=await a.A.post("/article/detail",{id:this.$route.query.id});200==t.code&&(this.info=t.data.article,this.fjlist=t.data.attachments||[],this.havelike=!0===t.data.haveLike||1===t.data.haveLike,await this.getlist())}catch(t){console.error(t)}finally{setTimeout((()=>{this.loadingPage=!1,this.clearLoadingTimer()}),1e3)}},checkMobile(){const t=window.innerWidth;this.windowWidth=t,this.isMobile=t<=768,this.isMobile?this.isSidebarCollapsed=!0:this.isSidebarCollapsed=!1},handleResize(){this.checkMobile()},toggleSidebar(){this.isMobile?(this.isSidebarOpen=!this.isSidebarOpen,this.isSidebarOpen?document.body.style.overflow="hidden":document.body.style.overflow=""):this.isSidebarCollapsed=!this.isSidebarCollapsed},setupMobileKeyboardListener(){this.removeMobileKeyboardListener(),this.initialHeight=window.innerHeight,this.keyboardShowHandler=()=>{const t=window.innerHeight;t<this.initialHeight-150?(this.keyboardOpen=!0,this.addKeyboardOpenClass()):(this.keyboardOpen=!1,this.removeKeyboardOpenClass())},window.addEventListener("resize",this.keyboardShowHandler),window.visualViewport&&window.visualViewport.addEventListener("resize",this.keyboardShowHandler)},addKeyboardOpenClass(){const t=document.querySelector(".mobile-comment-dialog");t&&t.classList.add("keyboard-open")},removeKeyboardOpenClass(){const t=document.querySelector(".mobile-comment-dialog");t&&t.classList.remove("keyboard-open")},removeMobileKeyboardListener(){this.keyboardShowHandler&&(window.removeEventListener("resize",this.keyboardShowHandler),window.visualViewport&&window.visualViewport.removeEventListener("resize",this.keyboardShowHandler),this.keyboardShowHandler=null),this.removeKeyboardOpenClass()}},beforeDestroy(){this.clearLoadingTimer(),window.removeEventListener("resize",this.handleResize),this.$root.$off("toggle-mobile-sidebar",this.handleToggleFromLogo),this.removeMobileKeyboardListener()}},m=d,h=i(81656),u=(0,h.A)(m,s,o,!1,null,"351badc8",null),p=u.exports}}]);