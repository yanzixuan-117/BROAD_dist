"use strict";(self["webpackChunkhard_diancan_front"]=self["webpackChunkhard_diancan_front"]||[]).push([[641],{17021:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},[t("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}}),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.search()}}},[e._v("查询")]),t("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){return e.research()}}},[e._v("重置")]),t("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(t){return e.add()}}},[e._v("新增")])],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{prop:"id",label:"序号",width:"70",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{prop:"rightreply",label:"答案"}}),t("el-table-column",{attrs:{prop:"tikuname",label:"所属题库"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"题库信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"gname"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"类型",prop:"score"}},[t("el-select",{staticStyle:{width:"100%","margin-right":"10px"},attrs:{placeholder:"请选择"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[t("el-option",{attrs:{value:"选择题",label:"选择题"}}),t("el-option",{attrs:{value:"判断题",label:"判断题"}})],1)],1),"选择题"==e.form.type?t("el-form-item",{attrs:{label:"A",prop:"optiona"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.optiona,callback:function(t){e.$set(e.form,"optiona",t)},expression:"form.optiona"}})],1):e._e(),"选择题"==e.form.type?t("el-form-item",{attrs:{label:"B",prop:"optionb"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.optionb,callback:function(t){e.$set(e.form,"optionb",t)},expression:"form.optionb"}})],1):e._e(),"选择题"==e.form.type?t("el-form-item",{attrs:{label:"C",prop:"optionc"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.optionc,callback:function(t){e.$set(e.form,"optionc",t)},expression:"form.optionc"}})],1):e._e(),t("el-form-item",{attrs:{label:"正确答案",prop:"rightreply"}},[t("el-input",{attrs:{placeholder:"正确答案"},model:{value:e.form.rightreply,callback:function(t){e.$set(e.form,"rightreply",t)},expression:"form.rightreply"}})],1),t("el-form-item",{attrs:{label:"所属题库",prop:"score"}},[t("el-select",{staticStyle:{width:"100%","margin-right":"10px"},attrs:{placeholder:"请选择"},model:{value:e.form.tikuid,callback:function(t){e.$set(e.form,"tikuid",t)},expression:"form.tikuid"}},e._l(e.tikulist,(function(e){return t("el-option",{attrs:{value:e.id,label:e.name}})})),1)],1),t("el-form-item",{attrs:{label:"是否重点题目",prop:"score"}},[t("el-select",{staticStyle:{width:"100%","margin-right":"10px"},attrs:{placeholder:"请选择"},model:{value:e.form.isim,callback:function(t){e.$set(e.form,"isim",t)},expression:"form.isim"}},[t("el-option",{attrs:{value:"是",label:"是"}}),t("el-option",{attrs:{value:"否",label:"否"}})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=s(18962),r={data(){return{fileList:[],teacherlist:[],tikulist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist(),this.getall()},methods:{shenhe(e){},async selectca(e){console.log(e);const t=await o.A.get("/hotal/typeByhotel?id="+e);console.log(t),this.categoryList=t.data},selectcaf(e){this.$forceUpdate()},handleFileSuccess(e){this.form.img=e.data},async getall(){const e=await o.A.get("/tiku/all");console.log(e),this.tikulist=e.data},del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/tiku/delete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.form=e,this.avatar=e.avatar,this.form.teacherid=e.teacherid,"ADMIN"==this.user.role&&this.getall(),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const e=await o.A.get("/tiku/qlist",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){const e=await o.A.post("/tiku/savequestion",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"600277f2",null),d=c.exports},62432:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg"},[t("div",{staticClass:"register-container"},[t("el-form",{ref:"loginForm",staticClass:"register-form",attrs:{model:e.loginForm,rules:e.rules,"label-position":"left","label-width":"0px"}},[t("div",{staticClass:"title"},[t("i",{staticClass:"el-icon-s-platform"}),t("span",[e._v("论坛注册")])]),t("el-form-item",{attrs:{prop:"userName"}},[t("el-input",{staticClass:"register-input",attrs:{type:"text",autocomplete:"off","prefix-icon":"el-icon-user",placeholder:"请输入用户名"},model:{value:e.loginForm.userName,callback:function(t){e.$set(e.loginForm,"userName",t)},expression:"loginForm.userName"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{staticClass:"register-input",attrs:{type:"password",autocomplete:"off","prefix-icon":"el-icon-lock",placeholder:"请输入密码"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),t("el-form-item",{attrs:{prop:"repassword"}},[t("el-input",{staticClass:"register-input",attrs:{type:"password",autocomplete:"off","prefix-icon":"el-icon-lock",placeholder:"请输入确认密码"},model:{value:e.repassword,callback:function(t){e.repassword=t},expression:"repassword"}})],1),t("el-form-item",{attrs:{prop:"role"}},[t("el-select",{staticClass:"register-input role-select",attrs:{placeholder:"请选择角色"},model:{value:e.loginForm.role,callback:function(t){e.$set(e.loginForm,"role",t)},expression:"loginForm.role"}},[t("el-option",{attrs:{label:"用户",value:1}},[t("i",{staticClass:"el-icon-user"}),e._v(" 用户 ")])],1)],1),t("el-form-item",[t("el-button",{staticClass:"register-button",attrs:{type:"primary"},on:{click:e.handleLogin}},[t("i",{staticClass:"el-icon-upload2"}),e._v(" 注册 ")])],1),t("div",{staticClass:"tip"},[t("span",[e._v("已有账号？")]),t("span",{staticClass:"login-link",on:{click:function(t){return e.sjzhuce()}}},[e._v("立即登录")])])],1)],1)])},i=[],o=(s(44114),s(18962)),r={data(){return{loginForm:{userName:"",password:"",role:1,inviterId:""},repassword:"",rules:{userName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]}}},mounted(){const e=this.$route.query.inviterId;console.log("注册页面 - 完整URL:",window.location.href),console.log("注册页面 - 从route.query获取的inviterId:",e),e?(this.loginForm.inviterId=e,console.log("✅ 检测到邀请码并已保存到表单:",e),this.$message.success(`已填写邀请码: ${e}`)):console.log("❌ 未检测到邀请码")},methods:{sjzhuce(){this.$router.push({path:"/login"})},handleLogin(){this.$refs.loginForm.validate((async e=>{if(!e)return console.log("表单校验失败"),!1;if(this.repassword==this.loginForm.password){console.log(this.loginForm);const e=await o.A.post("/register",this.loginForm);1==e.code||200==e.code?(this.$message.success("注册成功"),this.$router.push({path:"/login"})):this.$message.warning(e.msg)}else this.$message.warning("密码和确认密码不一样")}))}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"bf981990",null),d=c.exports},52743:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},["ADMIN"==e.user.role?t("el-select",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请选择酒店"},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}},e._l(e.hotellist,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1):e._e(),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.search()}}},[e._v("查询")]),t("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){return e.research()}}},[e._v("重置")]),"HOTEL"==e.user.role?t("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(t){return e.add()}}},[e._v("新增")]):e._e()],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{prop:"id",label:"序号",width:"70",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"name",label:"房间编号"}}),t("el-table-column",{attrs:{prop:"status",label:"房间状态"}}),t("el-table-column",{attrs:{prop:"typeName",label:"所属分类"}}),t("el-table-column",{attrs:{prop:"hotelName",label:"所属酒店"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return["HOTEL"==e.user.role?t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]):e._e(),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"房间信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"gname"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"房间状态状态",prop:"status"}},[t("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[t("el-radio",{attrs:{label:"空闲"}}),t("el-radio",{attrs:{label:"占用"}})],1)],1),t("el-form-item",{attrs:{label:"分类",prop:"categoryId"}},[t("el-select",{staticStyle:{width:"100%"},on:{change:e.selectcaf},model:{value:e.form.typeId,callback:function(t){e.$set(e.form,"typeId",t)},expression:"form.typeId"}},e._l(e.categoryList,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=s(18962),r={data(){return{fileList:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getall(),this.getlist(),"HOTEL"==this.user.role&&this.selectca(this.user.id)},methods:{async selectca(e){console.log(e);const t=await o.A.get("/hotal/typeByhotel?id="+e);console.log(t),this.categoryList=t.data},selectcaf(e){this.$forceUpdate()},handleFileSuccess(e){this.form.img=e.data},async getall(){const e=await o.A.get("/hotal/all");console.log(e),this.hotellist=e.data},del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/hotal/roomdelete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.form=e,this.form.hotelId=e.hotelId,this.selectca(this.form.hotelId),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){"HOTEL"==this.user.role&&(this.queryform.keyword=this.user.id);const e=await o.A.get("/hotal/roomlist",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){"HOTEL"==this.user.role&&(this.form.hotelId=this.user.id);const e=await o.A.post("/hotal/roomsave",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"4a720e22",null),d=c.exports},79881:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},[t("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(t){return e.add()}}},[e._v("新增")])],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"70",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"id",label:"订单编号"}}),t("el-table-column",{attrs:{prop:"username",label:"用户"}}),t("el-table-column",{attrs:{prop:"hotelname",label:"酒店"}}),t("el-table-column",{attrs:{prop:"typename",label:"客房"}}),t("el-table-column",{attrs:{prop:"roomname",label:"房间号"}}),t("el-table-column",{attrs:{prop:"intime",label:"入住时间"}}),t("el-table-column",{attrs:{prop:"outtime",label:"退房时间"}}),t("el-table-column",{attrs:{prop:"status",label:"状态"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return["已退房"!==s.row.status?t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("退房")]):e._e(),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"入住信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"订单编号",prop:"categoryId"}},[t("el-select",{staticStyle:{width:"100%"},on:{change:e.selectcaf},model:{value:e.form.orderid,callback:function(t){e.$set(e.form,"orderid",t)},expression:"form.orderid"}},e._l(e.categoryList,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),t("el-form-item",{attrs:{label:"房间号",prop:"categoryId"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.roomid,callback:function(t){e.$set(e.form,"roomid",t)},expression:"form.roomid"}},e._l(e.roomlist,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),t("el-form-item",{attrs:{label:"入住日期",prop:"intime"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"入住时间"},model:{value:e.form.intime,callback:function(t){e.$set(e.form,"intime",t)},expression:"form.intime"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=(s(98992),s(3949),s(18962)),r={data(){return{fileList:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],roomlist:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getall(),this.getlist(),this.selectca(this.user.id)},methods:{async selectca(e){console.log(e);const t=await o.A.get("/hotal/orderall");console.log(t),this.categoryList=t.data},async selectcaf(e){this.categoryList.forEach((async(t,s)=>{if(t.id==e){this.form.outtime=this.categoryList[s].outtime,this.form.userid=this.categoryList[s].userid,this.form.hotelid=this.categoryList[s].hotelid,this.form.typeid=this.categoryList[s].typeid,console.log(this.categoryList[s]);const e=await o.A.get(`/hotal/roomByhotalId?hotelId=${this.categoryList[s].hotelid}&&typeId=${this.categoryList[s].typeid}`);console.log(e),this.roomlist=e.data,this.$forceUpdate()}}))},handleFileSuccess(e){this.form.img=e.data},async getall(){const e=await o.A.get("/hotal/all");console.log(e),this.hotellist=e.data},del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/hotal/checkdelete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.$confirm("是否确认退房?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/hotal/checklogout?id="+e.orderid);console.log(t),1==t.code&&(this.$message({type:"success",message:"退房成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){"HOTEL"==this.user.role&&(this.queryform.keyword=this.user.id);const e=await o.A.get("/hotal/checkinlist",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){const e=await o.A.post("/hotal/addcheckin",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"783117c8",null),d=c.exports},2621:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},[t("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}}),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.search()}}},[e._v("查询")]),t("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){return e.research()}}},[e._v("重置")])],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"70",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{prop:"username",label:"提交人"}}),t("el-table-column",{attrs:{prop:"score",label:"分数"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:e._u([{key:"default",fn:function(s){return[0==s.row.score?t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.pf(s.row)}}},[e._v("评分")]):e._e()]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)])],1)},i=[],o=(s(98992),s(3949),s(18962)),r={data(){return{fileList:[],teacherlist:[],tikulist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist(),this.getall()},methods:{async pf(e){const t=JSON.parse(e.biaozhundaan),s=JSON.parse(e.xueshengdaan);let a=0;t.forEach((e=>{s.forEach((t=>{e==t&&(a+=20)}))})),console.log(a);const i=await o.A.post("/tiku/addsj",{id:e.id,score:a});console.log(i),1==i.code&&this.getlist()},shenhe(e){},async selectca(e){console.log(e);const t=await o.A.get("/hotal/typeByhotel?id="+e);console.log(t),this.categoryList=t.data},selectcaf(e){this.$forceUpdate()},handleFileSuccess(e){this.form.img=e.data},async getall(){const e=await o.A.get("/tiku/all");console.log(e),this.tikulist=e.data},del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/tiku/delete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.form=e,this.avatar=e.avatar,this.form.teacherid=e.teacherid,"ADMIN"==this.user.role&&this.getall(),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const e=await o.A.get("/tiku/shijuanlist",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){const e=await o.A.post("/tiku/savequestion",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"281b99d1",null),d=c.exports},15863:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},[t("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}}),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.search()}}},[e._v("查询")]),t("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){return e.research()}}},[e._v("重置")]),t("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(t){return e.add()}}},[e._v("新增")])],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"70",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"name",label:"资源名称"}}),t("el-table-column",{attrs:{prop:"url",label:"资源路径",width:"200"}}),t("el-table-column",{attrs:{prop:"type",label:"所属分类"}}),t("el-table-column",{attrs:{prop:"createtime",label:"上传时间"}}),t("el-table-column",{attrs:{prop:"teachername",label:"上传人"}}),t("el-table-column",{attrs:{prop:"info",label:"简介"}}),t("el-table-column",{attrs:{prop:"downloadnum",label:"下载量"},scopedSlots:e._u([{key:"default",fn:function(s){return[null==s.row.downloadnum?t("div",[e._v("0")]):t("div",[e._v(e._s(s.row.downloadnum))])]}}])}),t("el-table-column",{attrs:{prop:"watchnum",label:"浏览量"},scopedSlots:e._u([{key:"default",fn:function(s){return[null==s.row.watchnum?t("div",[e._v("0")]):t("div",[e._v(e._s(s.row.watchnum))])]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"资源信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"gname"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"分类",prop:"type"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}})],1),t("el-form-item",{attrs:{label:"视频",prop:"avatar"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/files/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess}},[""!==e.avatar?t("video",{staticClass:"avatar",attrs:{src:e.avatar}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t("el-form-item",{attrs:{label:"简介",prop:"info"}},[t("el-input",{attrs:{type:"textarea",placeholder:"简介"},model:{value:e.form.info,callback:function(t){e.$set(e.form,"info",t)},expression:"form.info"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=s(18962),r={data(){return{fileList:[],teacherlist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,tid:0,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist(),"ADMIN"==this.user.role&&this.getall()},methods:{shenhe(e){},async selectca(e){console.log(e);const t=await o.A.get("/hotal/typeByhotel?id="+e);console.log(t),this.categoryList=t.data},selectcaf(e){this.$forceUpdate()},handleFileSuccess(e){this.form.img=e.data},async getall(){const e=await o.A.get("/teacher/all");console.log(e),this.teacherlist=e.data},guidang(e){this.$confirm("是否确认归档？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/subject/guidang?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"归档成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/source/delete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.form=e,this.avatar=e.url,this.form.teacherid=e.teacherid,"ADMIN"==this.user.role&&this.getall(),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){"TEACHER"==this.user.role&&(this.queryform.tid=this.user.id);const e=await o.A.get("/source/list",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){this.form.url=this.avatar,this.form.teacherid=this.user.id,this.form.createtime=(new Date).toLocaleString(),this.form.watchnum=0,this.form.downloadnum=0;const e=await o.A.post("/source/add",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"042b8d64",null),d=c.exports},64262:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},[t("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}}),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.search()}}},[e._v("查询")]),t("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){return e.research()}}},[e._v("重置")]),t("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(t){return e.add()}}},[e._v("新增")])],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{prop:"id",label:"序号",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"username",label:"账号"}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{label:"头像"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticStyle:{display:"flex","align-items":"center"}},[s.row.avatar?t("el-image",{staticStyle:{width:"40px",height:"40px","border-radius":"50%"},attrs:{src:s.row.avatar,"preview-src-list":[s.row.avatar]}}):e._e()],1)]}}])}),t("el-table-column",{attrs:{prop:"role",label:"角色"}}),t("el-table-column",{attrs:{prop:"phone",label:"电话"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"180",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"酒店",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"账号",prop:"username"}},[t("el-input",{attrs:{placeholder:"账号"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{placeholder:"密码","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"电话",prop:"phone"}},[t("el-input",{attrs:{placeholder:"电话"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{placeholder:"电话"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),t("el-form-item",{attrs:{label:"头像"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/files/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess}},[""!==e.avatar?t("img",{staticClass:"avatar",attrs:{src:e.avatar}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=s(18962),r={data(){return{tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:JSON.parse(localStorage.getItem("xm-user")||"{}"),rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],type:[{required:!0,message:"请选择商家类型",trigger:"blur"}]},ids:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.getlist()},methods:{del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/teacher/delete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.form=e,this.avatar=e.avatar,this.license=e.license,this.form.timeRange=e.time_range,this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const e=await o.A.get("/teacher/list",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){this.form.avatar=this.avatar,this.form.role="TEACHER";const e=await o.A.post("/teacher/addandupdate",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"b01eac40",null),d=c.exports},48604:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},[t("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}}),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.search()}}},[e._v("查询")]),t("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){return e.research()}}},[e._v("重置")]),t("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(t){return e.add()}}},[e._v("新增")])],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{prop:"id",label:"序号",width:"70",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{prop:"avatar",label:"题库图片"},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.avatar?t("el-image",{staticStyle:{width:"40px",height:"40px"},attrs:{src:s.row.avatar,"preview-src-list":[s.row.avatar]}}):e._e()]}}])}),t("el-table-column",{attrs:{prop:"score",label:"分数"}}),t("el-table-column",{attrs:{prop:"num",label:"题目数"}}),t("el-table-column",{attrs:{prop:"teachername",label:"教课教师"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"题库信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"gname"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"图片",prop:"avatar"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/files/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess}},[""!==e.avatar?t("img",{staticClass:"avatar",attrs:{src:e.avatar}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t("el-form-item",{attrs:{label:"分数",prop:"score"}},[t("el-input",{attrs:{placeholder:"分数"},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}})],1),t("el-form-item",{attrs:{label:"数量",prop:"num"}},[t("el-input",{attrs:{placeholder:"数量"},model:{value:e.form.num,callback:function(t){e.$set(e.form,"num",t)},expression:"form.num"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=s(18962),r={data(){return{fileList:[],teacherlist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,tid:0,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist(),"ADMIN"==this.user.role&&this.getall()},methods:{shenhe(e){},async selectca(e){console.log(e);const t=await o.A.get("/hotal/typeByhotel?id="+e);console.log(t),this.categoryList=t.data},selectcaf(e){this.$forceUpdate()},handleFileSuccess(e){this.form.img=e.data},async getall(){const e=await o.A.get("/teacher/all");console.log(e),this.teacherlist=e.data},del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/tiku/delete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.form=e,this.avatar=e.avatar,this.form.teacherid=e.teacherid,"ADMIN"==this.user.role&&this.getall(),this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){"TEACHER"==this.user.role&&(this.queryform.tid=this.user.id);const e=await o.A.get("/tiku/list",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){this.form.avatar=this.avatar,"TEACHER"==this.user.role&&(this.form.teacherid=this.user.id);const e=await o.A.post("/tiku/add",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"1eff4078",null),d=c.exports},84052:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},[t("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(t){return e.add()}}},[e._v("新增")])],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"id",label:"id"}}),t("el-table-column",{attrs:{prop:"name",label:"名称"}}),t("el-table-column",{attrs:{prop:"desc",label:"描述"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"350"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1)],1)]),t("el-dialog",{attrs:{title:"板块信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"父id",prop:"pid"}},[t("el-input",{attrs:{placeholder:"请输入父id默认0"},model:{value:e.form.pid,callback:function(t){e.$set(e.form,"pid",t)},expression:"form.pid"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"desc"}},[t("el-input",{attrs:{placeholder:"描述"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=s(18962),r={data(){return{fileList:[],teacherlist:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist()},methods:{shenhe(e){},async selectca(e){console.log(e);const t=await o.A.get("/hotal/typeByhotel?id="+e);console.log(t),this.categoryList=t.data},selectcaf(e){this.$forceUpdate()},handleFileSuccess(e){this.form.img=e.data},async getall(){const e=await o.A.get("/teacher/all");console.log(e),this.teacherlist=e.data},guidang(e){this.$confirm("是否确认归档？, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/subject/guidang?id="+e);console.log(t),200!=t.code&&1!=t.code||(this.$message({type:"success",message:"归档成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.post("/board/delete",{id:e});console.log(t),200!=t.code&&1!=t.code||(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.form=e,this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const e=await o.A.get("/board/list",{params:this.queryform});console.log(e),200!=e.code&&1!=e.code||(this.tableData=e.data)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){const e=await o.A.post("/board/add",this.form);200!=e.code&&1!=e.code||(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"002d8e54",null),d=c.exports},57695:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{staticClass:"mb"},[t("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请输入关键词搜索"},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}}),t("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.search()}}},[e._v("查询")]),t("el-button",{attrs:{type:"info",plain:""},on:{click:function(t){return e.research()}}},[e._v("重置")]),t("el-button",{staticStyle:{float:"right"},attrs:{type:"warning",plain:""},on:{click:function(t){return e.add()}}},[e._v("新增")])],1),t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{prop:"id",label:"序号",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"username",label:"账号"}}),t("el-table-column",{attrs:{label:"头像"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticStyle:{display:"flex","align-items":"center"}},[s.row.avatar?t("el-image",{staticStyle:{width:"40px",height:"40px","border-radius":"50%"},attrs:{src:s.row.avatar,"preview-src-list":[s.row.avatar]}}):e._e()],1)]}}])}),t("el-table-column",{attrs:{prop:"name",label:"姓名"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"180",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"用户信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"账号",prop:"username"}},[t("el-input",{attrs:{placeholder:"账号"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),t("el-form-item",{attrs:{label:"名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"头像"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/admin/common/upload","show-file-list":!1,"on-success":e.handleAvatarSuccess}},[""!==e.avatar?t("img",{staticClass:"avatar",attrs:{src:e.avatar}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=s(18962),r={data(){return{tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{keyword:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:JSON.parse(localStorage.getItem("userinfo")||"{}"),rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],type:[{required:!0,message:"请选择商家类型",trigger:"blur"}]},ids:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.getlist()},methods:{del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/user/delete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.form=e,this.avatar=e.avatar,this.license=e.license,this.form.timeRange=e.time_range,this.fromVisible=!0},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){const e=await o.A.get("/user/list",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){this.form.avatar=this.avatar,this.form.role="ADMIN";const e=await o.A.post("/user/useraddandupdate",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"405b1a13",null),d=c.exports},53911:function(e,t,s){s.d(t,{A:function(){return d}});var a=function(){var e=this,t=e._self._c;return t("div",[t("el-card",[t("div",{staticClass:"table"},[t("el-table",{attrs:{data:e.tableData,strip:""}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"70",align:"center",sortable:""}}),t("el-table-column",{attrs:{prop:"id",label:"订单编号"}}),t("el-table-column",{attrs:{prop:"username",label:"用户"}}),t("el-table-column",{attrs:{prop:"hotelname",label:"酒店"}}),t("el-table-column",{attrs:{prop:"typename",label:"客房"}}),t("el-table-column",{attrs:{prop:"roomname",label:"房间号"}}),t("el-table-column",{attrs:{prop:"intime",label:"入住时间"}}),t("el-table-column",{attrs:{prop:"outtime",label:"退房时间"}}),t("el-table-column",{attrs:{prop:"status",label:"状态"}}),t("el-table-column",{attrs:{label:"操作",align:"center",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return["已退房"!==s.row.status?t("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("退房")]):e._e(),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)]),t("el-dialog",{attrs:{title:"入住信息",visible:e.fromVisible,width:"40%","close-on-click-modal":!1,"destroy-on-close":""},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticStyle:{"padding-right":"50px"},attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"订单编号",prop:"categoryId"}},[t("el-select",{staticStyle:{width:"100%"},on:{change:e.selectcaf},model:{value:e.form.orderid,callback:function(t){e.$set(e.form,"orderid",t)},expression:"form.orderid"}},e._l(e.categoryList,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),t("el-form-item",{attrs:{label:"房间号",prop:"categoryId"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.roomid,callback:function(t){e.$set(e.form,"roomid",t)},expression:"form.roomid"}},e._l(e.roomlist,(function(e){return t("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),t("el-form-item",{attrs:{label:"入住日期",prop:"intime"}},[t("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"入住时间"},model:{value:e.form.intime,callback:function(t){e.$set(e.form,"intime",t)},expression:"form.intime"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1)],1)},i=[],o=(s(98992),s(3949),s(18962)),r={data(){return{fileList:[],tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,avatar:"",queryform:{uid:"",pageNum:1,pageSize:10},license:"",form:{avatar:"",license:""},user:{},rules:{cname:[{required:!0,message:"请输入名称",trigger:"blur"}]},ids:[],businessList:[],categoryList:[],roomlist:[],hotellist:[],sjlist:[]}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),console.log(this.user),this.getlist()},methods:{async selectca(e){console.log(e);const t=await o.A.get("/hotal/orderall");console.log(t),this.categoryList=t.data},async selectcaf(e){this.categoryList.forEach((async(t,s)=>{if(t.id==e){this.form.outtime=this.categoryList[s].outtime,this.form.userid=this.categoryList[s].userid,this.form.hotelid=this.categoryList[s].hotelid,this.form.typeid=this.categoryList[s].typeid,console.log(this.categoryList[s]);const e=await o.A.get(`/hotal/roomByhotalId?hotelId=${this.categoryList[s].hotelid}&&typeId=${this.categoryList[s].typeid}`);console.log(e),this.roomlist=e.data,this.$forceUpdate()}}))},handleFileSuccess(e){this.form.img=e.data},async getall(){const e=await o.A.get("/hotal/all");console.log(e),this.hotellist=e.data},del(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/hotal/checkdelete?id="+e);console.log(t),1==t.code&&(this.$message({type:"success",message:"删除成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},force(e){this.form.timeRange=e,this.$forceUpdate()},handleEdit(e){this.$confirm("是否确认退房?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=await o.A.get("/hotal/checklogout?id="+e.orderid);console.log(t),1==t.code&&(this.$message({type:"success",message:"退房成功!"}),this.getlist())})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},search(){this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.queryform.pageSize=10,this.getlist()},async getlist(){this.queryform.uid=this.user.id;const e=await o.A.get("/hotal/percheckinlist",{params:this.queryform});console.log(e),1==e.code&&(this.tableData=e.data.records,this.total=e.data.total)},add(){this.avatar="",this.license="",this.fileList=[],this.form={},this.fromVisible=!0},handleLicenseSuccess(e){},async save(){const e=await o.A.post("/hotal/addcheckin",this.form);1==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())},handleCurrentChange(e){},handleAvatarSuccess(e){console.log(e),this.avatar=e.data,console.log(this.form.avatar)},handleAvatarSuccess1(e){this.license=e.data}}},l=r,n=s(81656),c=(0,n.A)(l,a,i,!1,null,"09c6b4b9",null),d=c.exports},93420:function(e,t,s){s.d(t,{A:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"personal-container"},[t("div",{staticClass:"action-card"},[t("div",{staticClass:"search-section"},[e.isMobile?e._e():t("div",{staticClass:"search-input"},[t("el-input",{staticClass:"search-box",attrs:{placeholder:"请输入关键词搜索文章标题或内容",clearable:""},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}},[t("template",{slot:"prefix"},[t("i",{staticClass:"el-icon-search"})])],2)],1),e.isMobile?e._e():t("div",{staticClass:"action-buttons"},[t("el-button",{staticClass:"btn-primary",attrs:{type:"primary"},on:{click:function(t){return e.search()}}},[t("i",{staticClass:"el-icon-search"}),e._v("查询 ")]),t("el-button",{staticClass:"btn-reset",on:{click:function(t){return e.research()}}},[t("i",{staticClass:"el-icon-refresh"}),e._v("重置 ")]),t("el-button",{staticClass:"btn-add",attrs:{type:"warning"},on:{click:function(t){return e.add()}}},[t("i",{staticClass:"el-icon-plus"}),e._v("发布新文章 ")])],1),e.isMobile?t("div",{staticClass:"mobile-search-section"},[t("div",{staticClass:"search-input-mobile"},[t("el-input",{staticClass:"search-box-mobile",attrs:{placeholder:"搜索文章标题或内容",clearable:""},model:{value:e.queryform.keyword,callback:function(t){e.$set(e.queryform,"keyword",t)},expression:"queryform.keyword"}})],1),t("div",{staticClass:"mobile-action-buttons"},[t("el-button",{staticClass:"mobile-btn-search",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.search()}}},[t("i",{staticClass:"el-icon-search"})]),t("el-button",{staticClass:"mobile-btn-reset",attrs:{size:"small"},on:{click:function(t){return e.research()}}},[t("i",{staticClass:"el-icon-refresh"})]),t("el-button",{staticClass:"mobile-btn-add",attrs:{type:"warning",size:"small"},on:{click:function(t){return e.add()}}},[t("i",{staticClass:"el-icon-plus"})])],1)]):e._e()])]),t("div",{staticClass:"content-card"},[t("div",{staticClass:"table-wrapper"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"article-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f8fafc",color:"#2c3e50",fontWeight:"600",fontSize:"14px"},"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center",sortable:""},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{staticClass:"article-id"},[e._v("#"+e._s(s.row.id))])]}}])}),t("el-table-column",{attrs:{prop:"title",label:"文章标题",width:"250"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"article-title-cell"},[t("div",{staticClass:"title-text",attrs:{title:s.row.title}},[e._v(" "+e._s(s.row.title)+" ")]),s.row.summary?t("div",{staticClass:"title-summary"},[e._v(" "+e._s(s.row.summary)+" ")]):e._e()])]}}])}),t("el-table-column",{attrs:{prop:"cover",label:"封面",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"cover-container"},[s.row.cover?t("el-image",{staticClass:"cover-image",attrs:{src:e.$getImageUrl(s.row.cover),"preview-src-list":[e.$getImageUrl(s.row.cover)],fit:"cover"}},[t("div",{staticClass:"image-error",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture"})])]):t("div",{staticClass:"no-cover"},[t("i",{staticClass:"el-icon-picture-outline"})])],1)]}}])}),t("el-table-column",{attrs:{prop:"boardName",label:"分类",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{staticClass:"category-tag",attrs:{size:"small",type:"info"}},[e._v(" "+e._s(s.row.boardName||"未分类")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"pboardName",label:"标签",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{staticClass:"tag-item",attrs:{size:"small",type:e.getTagType(s.row.pboardName)}},[e._v(" "+e._s(s.row.pboardName||"无标签")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"nickName",label:"作者",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"author-info"},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v(e._s(s.row.nickName))])])]}}])}),t("el-table-column",{attrs:{prop:"postTime",label:"发布日期",width:"140",sortable:""},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"date-cell"},[t("i",{staticClass:"el-icon-time"}),t("span",[e._v(e._s(e.formatDate(s.row.postTime)))])])]}}])}),t("el-table-column",{attrs:{prop:"readCount",label:"浏览量",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"stat-item"},[t("i",{staticClass:"el-icon-view"}),t("span",{staticClass:"stat-value"},[e._v(e._s(s.row.readCount||0))])])]}}])}),t("el-table-column",{attrs:{prop:"content",label:"内容预览",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{staticClass:"preview-btn",attrs:{type:"info",size:"mini"},on:{click:function(t){return e.chakan(s.row.content)}}},[t("i",{staticClass:"el-icon-document"}),e._v("查看内容 ")])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"action-buttons-cell"},[t("el-button",{staticClass:"edit-btn",attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){return e.handleEdit(s.row)}}},[t("i",{staticClass:"el-icon-edit"}),e._v("编辑 ")]),t("el-button",{staticClass:"delete-btn",attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.del(s.row.id)}}},[t("i",{staticClass:"el-icon-delete"}),e._v("删除 ")])],1)]}}])})],1),0!==e.tableData.length||e.loading?e._e():t("div",{staticClass:"empty-state"},[t("i",{staticClass:"el-icon-document-delete"}),t("p",[e._v("暂无文章数据")]),t("p",{staticClass:"empty-tip"},[e._v('点击"发布新文章"按钮创建您的第一篇文章')])])],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"mobile-card-list",attrs:{"element-loading-text":"正在加载数据...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[e._l(e.tableData,(function(s){return t("div",{key:s.id,staticClass:"article-card"},[t("div",{staticClass:"card-header",on:{click:function(t){return e.chakan(s.content)}}},[s.cover?t("div",{staticClass:"card-cover"},[t("el-image",{staticClass:"card-cover-image",attrs:{src:e.$getImageUrl(s.cover),"preview-src-list":[e.$getImageUrl(s.cover)],fit:"cover"}},[t("div",{staticClass:"image-error",attrs:{slot:"error"},slot:"error"},[t("i",{staticClass:"el-icon-picture"})])])],1):t("div",{staticClass:"card-cover no-cover-card"},[t("i",{staticClass:"el-icon-picture-outline"})]),t("div",{staticClass:"card-title-section"},[t("h3",{staticClass:"card-title"},[e._v(e._s(s.title))]),s.summary?t("p",{staticClass:"card-summary"},[e._v(e._s(s.summary))]):e._e()])]),t("div",{staticClass:"card-meta"},[t("div",{staticClass:"meta-tags"},[t("el-tag",{staticClass:"meta-tag",attrs:{size:"small",type:"info"}},[e._v(" "+e._s(s.boardName||"未分类")+" ")]),t("el-tag",{staticClass:"meta-tag",attrs:{size:"small",type:e.getTagType(s.pboardName)}},[e._v(" "+e._s(s.pboardName||"无标签")+" ")])],1),t("div",{staticClass:"meta-info"},[t("div",{staticClass:"meta-item"},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v(e._s(s.nickName))])]),t("div",{staticClass:"meta-item"},[t("i",{staticClass:"el-icon-time"}),t("span",[e._v(e._s(e.formatDate(s.postTime)))])]),t("div",{staticClass:"meta-item"},[t("i",{staticClass:"el-icon-view"}),t("span",[e._v(e._s(s.readCount||0))])])])]),t("div",{staticClass:"card-actions"},[t("el-button",{staticClass:"card-action-btn preview",attrs:{type:"info",size:"small",plain:""},on:{click:function(t){return e.chakan(s.content)}}},[t("i",{staticClass:"el-icon-document"}),t("span",[e._v("查看内容")])]),t("el-button",{staticClass:"card-action-btn edit",attrs:{type:"primary",size:"small",plain:""},on:{click:function(t){return e.handleEdit(s)}}},[t("i",{staticClass:"el-icon-edit"}),t("span",[e._v("编辑")])]),t("el-button",{staticClass:"card-action-btn delete",attrs:{type:"danger",size:"small",plain:""},on:{click:function(t){return e.del(s.id)}}},[t("i",{staticClass:"el-icon-delete"}),t("span",[e._v("删除")])])],1)])})),0!==e.tableData.length||e.loading?e._e():t("div",{staticClass:"empty-state-mobile"},[e._m(0),t("p",{staticClass:"empty-text"},[e._v("暂无文章数据")]),t("p",{staticClass:"empty-tip-mobile"},[e._v('点击"发布新文章"按钮创建您的第一篇文章')])])],2),t("div",{staticClass:"pagination-wrapper"},[t("el-pagination",{staticClass:"custom-pagination",attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)]),t("el-dialog",{attrs:{title:"文章内容预览",visible:e.fromVisible1,width:"60%","close-on-click-modal":!1,"custom-class":"content-preview-dialog"},on:{"update:visible":function(t){e.fromVisible1=t}}},[t("div",{staticClass:"content-preview",domProps:{innerHTML:e._s(e.content)}}),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible1=!1}}},[e._v("关闭")])],1)]),e.isMobile?t("el-drawer",{attrs:{title:e.form.id?"编辑文章":"发布新文章",visible:e.fromVisible,direction:"btt",size:"95%","custom-class":"article-edit-drawer","append-to-body":!0},on:{"update:visible":function(t){e.fromVisible=t},close:e.handleDialogClose}},[t("div",{staticClass:"drawer-content-mobile"},[t("div",{staticClass:"form-card-mobile"},[t("div",{staticClass:"card-label-mobile"},[t("span",{staticClass:"required-mark"},[e._v("*")]),e._v(" 文章标题 ")]),t("el-input",{staticClass:"title-input-mobile",attrs:{placeholder:"请输入文章标题",maxlength:"100","show-word-limit":"",type:"textarea",rows:2,autosize:{minRows:2,maxRows:4}},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("div",{staticClass:"form-card-mobile"},[t("div",{staticClass:"card-label-mobile"},[t("span",{staticClass:"required-mark"},[e._v("*")]),e._v(" 文章分类 ")]),t("el-cascader",{staticClass:"cascader-mobile",staticStyle:{width:"100%"},attrs:{options:e.typelist,props:e.props,"show-all-levels":!1,placeholder:"请选择文章分类",clearable:""},on:{change:e.handleChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),t("div",{staticClass:"form-card-mobile"},[t("div",{staticClass:"card-label-mobile"},[e._v("文章摘要")]),t("el-input",{staticClass:"summary-input-mobile",attrs:{placeholder:"简单描述文章内容（选填）",type:"textarea",rows:3,maxlength:"200","show-word-limit":""},model:{value:e.form.summary,callback:function(t){e.$set(e.form,"summary",t)},expression:"form.summary"}})],1),t("div",{staticClass:"form-card-mobile"},[t("div",{staticClass:"card-label-mobile"},[e._v("封面图片")]),t("div",{staticClass:"cover-upload-wrapper-mobile"},[t("oss-image-upload",{attrs:{"upload-type":"cover","max-size":1,tip:"上传封面","size-tip":"建议尺寸：1200×600px，大小不超过1MB","upload-class":"cover-uploader-mobile"},scopedSlots:e._u([{key:"default",fn:function(){return[e.form.cover?t("div",{staticClass:"upload-area-mobile"},[t("img",{staticClass:"cover-image-preview-mobile",attrs:{src:e.$getImageUrl(e.form.cover)}}),t("div",{staticClass:"upload-mask-mobile"},[t("i",{staticClass:"el-icon-upload2"}),t("span",[e._v("点击更换")])])]):t("div",{staticClass:"upload-area-mobile empty"},[t("i",{staticClass:"el-icon-picture-outline"}),t("div",{staticClass:"upload-text"},[e._v("点击上传封面")]),t("div",{staticClass:"upload-hint"},[e._v("建议尺寸 1200×600")])])]},proxy:!0}]),model:{value:e.form.cover,callback:function(t){e.$set(e.form,"cover",t)},expression:"form.cover"}}),e.form.cover?t("div",{staticClass:"cover-actions-mobile"},[t("el-button",{staticClass:"remove-cover-btn",attrs:{type:"text",size:"small"},on:{click:function(t){e.form.cover=""}}},[t("i",{staticClass:"el-icon-delete"}),e._v("移除封面 ")])],1):e._e()],1)]),t("div",{staticClass:"form-card-mobile content-card"},[t("div",{staticClass:"card-label-mobile"},[t("span",{staticClass:"required-mark"},[e._v("*")]),e._v(" 文章内容 ")]),t("div",{staticClass:"editor-wrapper-mobile"},[t("div",{staticClass:"ai-polish-bar-mobile"},[t("el-select",{staticClass:"polish-select-mobile",attrs:{size:"small",placeholder:"润色类型",disabled:e.isPolishing},model:{value:e.polishTarget,callback:function(t){e.polishTarget=t},expression:"polishTarget"}},e._l(e.targetOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-button",{staticClass:"polish-btn-mobile",attrs:{type:"warning",size:"small",loading:e.isPolishing,disabled:!e.form.content||e.isPolishing,icon:"el-icon-magic-stick"},on:{click:e.handleAIPolish}},[e._v(" "+e._s(e.isPolishing?"润色中...":"AI润色")+" ")])],1),t("wang-editor",{attrs:{placeholder:"开始写作...",height:"350px","z-index":2e3,"is-mobile":!0},on:{ready:e.handleEditorReady},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1)]),t("div",{staticClass:"bottom-spacer"})]),t("div",{staticClass:"drawer-footer-mobile"},[t("el-button",{staticClass:"cancel-btn-mobile",attrs:{size:"medium"},on:{click:function(t){e.fromVisible=!1}}},[e._v(" 取消 ")]),t("el-button",{staticClass:"submit-btn-mobile",attrs:{type:"primary",loading:e.saving,size:"medium"},on:{click:e.save}},[e._v(" "+e._s(e.saving?"保存中...":"发布文章")+" ")])],1)]):t("el-dialog",{attrs:{title:e.form.id?"编辑文章":"发布新文章",visible:e.fromVisible,width:"800px","close-on-click-modal":!1,"custom-class":"article-edit-dialog"},on:{"update:visible":function(t){e.fromVisible=t},close:e.handleDialogClose}},[t("el-form",{ref:"formRef",staticClass:"article-form",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[t("el-form-item",{attrs:{label:"文章标题",prop:"title",required:""}},[t("el-input",{staticClass:"title-input",attrs:{placeholder:"请输入文章标题",maxlength:"100","show-word-limit":""},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"文章分类",prop:"typeid",required:""}},[t("el-cascader",{staticClass:"cascader-selector",staticStyle:{width:"100%"},attrs:{options:e.typelist,props:e.props,"show-all-levels":!1,placeholder:"请选择文章分类",clearable:""},on:{change:e.handleChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),t("el-form-item",{attrs:{label:"文章摘要",prop:"summary"}},[t("el-input",{attrs:{placeholder:"请输入文章摘要（选填）",type:"textarea",rows:3,maxlength:"200","show-word-limit":""},model:{value:e.form.summary,callback:function(t){e.$set(e.form,"summary",t)},expression:"form.summary"}})],1),t("el-form-item",{attrs:{label:"封面图片"}},[t("oss-image-upload",{attrs:{"upload-type":"cover","max-size":1,tip:"上传封面图片","size-tip":"建议尺寸：1200×600px，大小不超过1MB","upload-class":"cover-uploader"},scopedSlots:e._u([{key:"default",fn:function(){return[e.form.cover?t("div",{staticClass:"upload-area"},[t("img",{staticClass:"cover-image-preview",attrs:{src:e.$getImageUrl(e.form.cover)}}),t("div",{staticClass:"upload-mask"},[t("i",{staticClass:"el-icon-upload2"}),t("span",[e._v("更换封面")])])]):t("div",{staticClass:"upload-area empty"},[t("i",{staticClass:"el-icon-plus"}),t("div",{staticClass:"upload-text"},[e._v("上传封面图片")]),t("div",{staticClass:"upload-tip"},[e._v("建议尺寸：1200×600px")])])]},proxy:!0}],null,!1,1471520155),model:{value:e.form.cover,callback:function(t){e.$set(e.form,"cover",t)},expression:"form.cover"}}),e.form.cover?t("div",{staticClass:"cover-tip"},[t("el-button",{staticClass:"remove-cover",attrs:{type:"text"},on:{click:function(t){e.form.cover=""}}},[t("i",{staticClass:"el-icon-delete"}),e._v("移除封面 ")])],1):e._e()],1),t("el-form-item",{attrs:{label:"文章内容",prop:"content",required:""}},[t("div",{staticClass:"editor-wrapper"},[t("div",{staticClass:"ai-polish-toolbar"},[t("el-select",{staticClass:"polish-target-select",attrs:{size:"small",placeholder:"选择润色类型",disabled:e.isPolishing},model:{value:e.polishTarget,callback:function(t){e.polishTarget=t},expression:"polishTarget"}},e._l(e.targetOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-button",{staticClass:"ai-polish-btn",attrs:{type:"warning",size:"small",icon:"el-icon-magic-stick",loading:e.isPolishing,disabled:!e.form.content||e.isPolishing},on:{click:e.handleAIPolish}},[e.isPolishing?e._e():t("i",{staticClass:"el-icon-magic-stick"}),t("span",[e._v(e._s(e.isPolishing?"润色中...":"AI 润色"))])]),e.form.content?t("span",{staticClass:"toolbar-tip"},[e._v("让 AI 帮你优化文章内容")]):e._e()],1),t("wang-editor",{attrs:{placeholder:"请输入文章内容...",height:"400px","z-index":100,"is-mobile":!1},on:{ready:e.handleEditorReady},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}),t("div",{staticClass:"editor-tip"},[e._v("文章内容不能为空")])],1)])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.saving},on:{click:e.save}},[e._v(" "+e._s(e.saving?"保存中...":"确定保存")+" ")])],1)],1)],1)},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"empty-icon"},[t("i",{staticClass:"el-icon-document-delete"})])}],o=(s(44114),s(81454),s(18962)),r=s(8723),l=s(41368),n={components:{OssImageUpload:r.A,WangEditor:l.A},data(){return{tableData:[],pageNum:1,pageSize:10,total:0,username:null,token:"",name:null,fromVisible:!1,fromVisible1:!1,avatar:"",content:"",loading:!1,saving:!1,isMobile:window.innerWidth<=768,isPolishing:!1,polishTarget:"readability",targetOptions:[{value:"readability",label:"可读性优化"},{value:"conciseness",label:"简洁化"},{value:"expansion",label:"扩充内容"},{value:"correction",label:"纠错校对"}],queryform:{keyword:"",pageNum:1,pageSize:10},license:"",value:[],form:{avatar:"",license:"",cover:""},user:{},props:{value:"id",label:"name",checkStrictly:!0,expandTrigger:"hover"},rules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}]},ids:[],typelist:[],sjlist:[],editor:null}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),this.checkMobile(),window.addEventListener("resize",this.checkMobile),this.getall(),this.getlist(),this.$nextTick((()=>{this.initCascaderClickHandler()}))},methods:{initCascaderClickHandler(){document.addEventListener("click",this.handleCascaderGlobalClick,!0)},handleCascaderGlobalClick(e){const t=e.target;if(t.classList.contains("el-cascader-node__label")){const s=t.closest(".el-cascader-node");if(s){const t=s.querySelector(".el-radio__input");t&&(t.click(),e.stopPropagation(),e.preventDefault())}}},goBack(){this.$router.push("/userhome")},handleChange(e){e&&e.length>1?(this.form.pBoardId=e[0],this.form.boardId=e[1]):e&&1==e.length&&(this.form.pBoardId=e[0])},add(){this.value=[],this.form={cover:""},this.fromVisible=!0},handleEditorReady(e){this.editor=e},chakan(e){this.content=e,this.fromVisible1=!0},cleanCategoryData(e){return e&&Array.isArray(e)?e.map((e=>{const t={...e};return t.children&&Array.isArray(t.children)&&(0===t.children.length?delete t.children:t.children=this.cleanCategoryData(t.children)),t})):[]},async getall(){try{const e=await o.A.get("/board/list");200==e.code&&(this.typelist=this.cleanCategoryData(e.data))}catch(e){console.error(e)}},del(e){this.$confirm("确定要删除这篇文章吗？删除后不可恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",customClass:"delete-confirm-dialog"}).then((async()=>{try{const t=await o.A.post("/article/delete",{id:e});200==t.code&&(this.$message.success("删除成功"),this.getlist())}catch(t){console.error(t)}})).catch((()=>{}))},handleEdit(e){this.form={...e},this.value=[],e.pboardId&&e.boardId?this.value=[e.pboardId,e.boardId]:e.pboardId&&(this.value=[e.pboardId]),this.fromVisible=!0,this.$nextTick((()=>{setTimeout((()=>{this.initWangEditor(e.content||"")}),300)}))},search(){this.queryform.pageNum=1,this.getlist()},research(){this.queryform.keyword="",this.queryform.pageNum=1,this.getlist()},async getlist(){this.loading=!0;try{const e=await o.A.post("/article/myarticle",this.queryform);200==e.code&&(this.tableData=e.data.records||[],this.total=e.data.total||0)}catch(e){console.error(e),this.$message.error("加载失败，请稍后重试")}finally{this.loading=!1}},async save(){if(this.form.title&&this.form.title.trim())if(this.editor&&this.editor.txt.html()&&""!==this.editor.txt.text().trim()){this.form.content=this.editor.txt.html(),this.saving=!0;try{let e;e=this.form.id?await o.A.post("/article/update",this.form):await o.A.post("/article/post",this.form),200==e.code&&(this.fromVisible=!1,this.$message.success("操作成功"),this.getlist())}catch(e){console.error(e),this.$message.error("保存失败，请稍后重试")}finally{this.saving=!1}}else this.$message.warning("请输入文章内容");else this.$message.warning("请输入文章标题")},handleCurrentChange(e){this.queryform.pageNum=e,this.getlist()},handleAvatarSuccess(e){200==e.code?(this.form.cover=e.data,this.$message.success("封面图片上传成功")):this.$message.error("图片上传失败")},getTagType(e){const t={"前端":"success","后端":"warning","设计":"danger","测试":"info","热门":"danger","精华":"success","推荐":"warning"};return t[e]||"info"},formatDate(e){if(!e)return"-";const t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},async handleAIPolish(){if(!this.editor)return void this.$message.warning("请先输入文章内容");const e=this.editor.txt.html();if(!e||""===e.trim()||"<p><br></p>"===e)return void this.$message.warning("请先输入文章内容");const t=this.editor.txt.text();if(t&&t.trim()){this.isPolishing=!0,this.$message.info("AI 正在润色文章内容...");try{const e=await fetch("https://orkj406039jmw6me.top/api/article/polishContent",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+window.localStorage.getItem("token")},body:JSON.stringify({originalContent:t,target:this.polishTarget})});if(!e.ok)throw new Error("润色请求失败");const a=e.body.getReader(),i=new TextDecoder;let o="",r="";while(1){const{done:e,value:t}=await a.read();if(e)break;r+=i.decode(t,{stream:!0});const l=r.split("\n");r=l.pop()||"";for(const a of l)if(a.trim())try{const e=a.replace(/^data:\s*/,"").trim();if(!e)continue;const t=JSON.parse(e);if("end"===t.type)break;"content"===t.type&&t.data&&(o+=t.data,this.editor.txt.html(o))}catch(s){console.error("解析 SSE 数据失败:",s,a)}}this.editor.txt.html(o),this.form.content=o,this.$message.success("AI 润色完成！")}catch(a){console.error("AI 润色失败:",a),this.$message.error("AI 润色失败，请稍后重试")}finally{this.isPolishing=!1}}else this.$message.warning("请先输入文章内容")},checkMobile(){this.isMobile=window.innerWidth<=768},handleDialogClose(){this.resetForm()},resetForm(){this.form={avatar:"",license:"",cover:"",id:"",title:"",summary:"",content:"",pBoardId:"",boardId:""},this.value=[],this.editor&&this.editor.txt.clear()}},beforeDestroy(){document.removeEventListener("click",this.handleCascaderGlobalClick,!0),this.editor&&(this.editor.destroy(),this.editor=null),window.removeEventListener("resize",this.checkMobile)}},c=n,d=s(81656),m=(0,d.A)(c,a,i,!1,null,"7d70ff83",null),u=m.exports},9857:function(e,t,s){s.d(t,{A:function(){return b}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"forum-container"},[t("ForumSidebar",{attrs:{"tree-data":e.treedata,"expanded-keys":e.expandedKeys,"current-node-key":e.currentNodeKey,"active-board-id":e.queryform.boardId,"is-mobile":e.isMobile,"is-sidebar-collapsed":e.isSidebarCollapsed,"is-sidebar-open":e.isSidebarOpen,query:e.$route.query},on:{"node-click":e.handleNodeClick,close:e.closeSidebar,navigate:e.handleNavigate,"select-community":e.handleCommunitySelect}}),e.isMobile?t("div",{staticClass:"sidebar-overlay",class:{"overlay-active":e.isSidebarOpen&&e.isMobile},on:{click:e.closeSidebar}}):e._e(),t("div",{staticClass:"main-content"},[t("div",{staticClass:"filter-bar"},[t("div",{staticClass:"filter-left"},[t("div",{staticClass:"sort-tabs"},[t("div",{staticClass:"sort-tab",class:{active:"all"===e.currentSort},on:{click:function(t){return e.handleSort("all")}}},[t("i",{staticClass:"el-icon-star-off"}),t("span",[e._v("全部")])]),t("div",{staticClass:"sort-tab",class:{active:"hot"===e.currentSort},on:{click:function(t){return e.handleSort("hot")}}},[t("i",{staticClass:"el-icon-trophy"}),t("span",[e._v("热门")])]),t("div",{staticClass:"sort-tab",class:{active:"latest"===e.currentSort},on:{click:function(t){return e.handleSort("latest")}}},[t("i",{staticClass:"el-icon-time"}),t("span",[e._v("最新")])])]),t("div",{staticClass:"filter-info"},[e._v(" 当前显示："),t("span",{staticClass:"active-filter"},[e._v(e._s(e.currentFilter||"全部帖子"))]),e.queryform.boardId||e.queryform.pBoardId?t("span",{staticClass:"reset-filter",on:{click:e.resetFilter}},[t("i",{staticClass:"el-icon-close"}),e._v(" 重置筛选 ")]):e._e()])]),e.isLoggedIn?t("div",{staticClass:"publish-section"},[t("publish-article",{attrs:{"button-text":"发布新文章","button-icon":"el-icon-edit","button-type":"primary","button-round":!0,"is-mobile":e.isMobile},on:{success:e.handleArticlePublished}})],1):e._e(),e.isMobile?e._e():t("div",{staticClass:"create-board-section"},[t("el-button",{attrs:{type:"success",icon:"el-icon-folder-add",round:""},on:{click:e.openCreateBoardDialog}},[e._v(" 创建板块 ")])],1)]),t("create-board-dialog",{attrs:{visible:e.showCreateBoardDialog,"is-mobile":e.isMobile,boards:e.treedata},on:{"update:visible":function(t){e.showCreateBoardDialog=t},success:e.handleBoardCreated}}),t("div",{staticClass:"posts-container"},[0!==e.contentlist.length||e.isInitialized?0===e.contentlist.length?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"}},[t("path",{attrs:{d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t("p",{staticClass:"empty-title"},[e._v("暂无帖子内容")]),t("p",{staticClass:"empty-desc"},[e._v("快去发布第一个帖子吧！")])]):e._e():t("div",{staticClass:"skeleton-loading"},e._l(3,(function(s){return t("div",{key:s,staticClass:"skeleton-card"},[e._m(0,!0),t("div",{staticClass:"skeleton-title"}),e._m(1,!0)])})),0),e._l(e.contentlist,(function(s){return t("post-card",{key:s.id,attrs:{post:s,"hot-threshold":100,"summary-length":100},on:{click:e.godetail}})}))],2),t("div",{staticClass:"pagination-container"},[t("el-pagination",{key:e.queryform.pageNum,staticClass:"forum-pagination",attrs:{background:"","current-page":e.queryform.pageNum,"page-sizes":[5,10,20],"page-size":e.queryform.pageSize,layout:"total, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1),t("HotCommunities",{attrs:{query:e.queryform},on:{"select-community":e.handleCommunitySelect}}),t("div",{staticClass:"ai-chat-wrapper"},[t("transition",{attrs:{name:"chat-slide"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isChatOpen,expression:"isChatOpen"}],staticClass:"ai-chat-float"},[t("ChatWindow",{attrs:{messages:e.chatMessages,isChatLoading:e.isChatLoading,isOnline:!0,knowledgeBase:e.knowledgeBase},on:{sendMessage:e.handleSendMessage,close:e.toggleChat}})],1)]),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isChatOpen,expression:"!isChatOpen"}],staticClass:"ai-chat-toggle",class:{active:e.isChatOpen,disabled:!e.isLoggedIn},attrs:{title:e.isLoggedIn?"":"请先登录"},on:{click:e.toggleChat}},[t("div",{staticClass:"toggle-icon"},[e.isChatOpen?t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[t("path",{attrs:{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z","clip-rule":"evenodd"}})]):t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[t("path",{attrs:{"fill-rule":"evenodd",d:"M12.963 2.286a.75.75 0 00-1.071-.136 9.742 9.742 0 00-3.539 6.177 7.547 7.547 0 01-1.705-1.715.75.75 0 00-1.152.082A9 9 0 1015.68 4.534a7.46 7.46 0 01-2.717-2.248zM15.75 14.25a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z","clip-rule":"evenodd"}})])]),!e.isChatOpen&&e.unreadCount>0?t("div",{staticClass:"notification-badge"},[e._v(e._s(e.unreadCount))]):e._e(),e.isLoggedIn?e._e():t("div",{staticClass:"lock-icon"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[t("path",{attrs:{"fill-rule":"evenodd",d:"M12 1.5a5.25 5.25 0 00-5.25 5.25v3a3 3 0 00-3 3v6.75a3 3 0 003 3h10.5a3 3 0 003-3v-6.75a3 3 0 00-3-3v-3a5.25 5.25 0 00-5.25-5.25zm-3.75 8.25v-3a3.75 3.75 0 117.5 0v3h-7.5z","clip-rule":"evenodd"}})])])])],1)],1)},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"skeleton-header"},[t("div",{staticClass:"skeleton-avatar"}),t("div",{staticClass:"skeleton-user"},[t("div",{staticClass:"skeleton-line skeleton-name"}),t("div",{staticClass:"skeleton-line skeleton-time"})])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"skeleton-content"},[t("div",{staticClass:"skeleton-line"}),t("div",{staticClass:"skeleton-line"}),t("div",{staticClass:"skeleton-line short"})])}],o=(s(44114),s(17642),s(58004),s(33853),s(45876),s(32475),s(15024),s(31698),s(81454),s(18962)),r=s(21409),l=s(33827),n=s(1416),c=s(14251),d=s(33045),m=s(36197),u=s(47406),h={name:"UserHome",components:{PublishArticle:r.A,ChatWindow:l.A,ForumSidebar:n.A,HotCommunities:c.A,PostCard:d.A,CreateBoardDialog:u.A},data(){return{defaultProps:{children:"children",label:"name"},total:0,treedata:[],contentlist:[],queryform:{boardId:"",pageNum:1,pBoardId:"",pageSize:10,status:1},user:{},currentFilter:"",currentSort:"all",expandedKeys:[1,2,5],currentNodeKey:null,isInitialized:!1,isRestoringFilterState:!1,hasTriedRestoreState:!1,chatMessages:[],isChatLoading:!1,knowledgeBase:[],isChatOpen:!1,unreadCount:0,aiConfig:null,isMobile:window.innerWidth<=768,isSidebarOpen:!1,isSidebarCollapsed:!1,activeCollapseNames:[],windowWidth:window.innerWidth,showCreateBoardDialog:!1}},computed:{isLoggedIn(){return!!window.localStorage.getItem("token")}},mounted(){console.log("[UserHome] mounted 开始执行"),this.user=JSON.parse(window.localStorage.getItem("userinfo")||"{}"),this.getlist().then((()=>{if(console.log("[UserHome] getlist 完成，开始检查筛选状态",{routeQuery:this.$route.query,isInitialized:this.isInitialized}),!this.$route.query.boardId&&!this.$route.query.pBoardId){console.log("[UserHome] URL 无参数，尝试恢复筛选状态"),this.hasTriedRestoreState=!0;const e=this.restoreFilterState();if(console.log("[UserHome] 恢复结果:",e),e)return this.isInitialized=!0,void console.log("[UserHome] 状态恢复成功，设置 isInitialized = true，当前 pageNum:",this.queryform.pageNum)}console.log("[UserHome] 无需恢复状态或恢复失败，执行默认初始化"),this.hasTriedRestoreState=!0,this.isInitialized=!0,this.handleRouteQuery(this.$route.query)})),this.loadAiConfig(),this.loadKnowledgeBase(),0===this.chatMessages.length&&(this.chatMessages=this.loadChatMessages()),window.addEventListener("storage",this.handleStorageChange),this.checkMobile(),window.addEventListener("resize",this.handleResize),this.$root.$on("toggle-mobile-sidebar",this.handleToggleFromLogo),this.$root.$on("search-articles",this.handleSearchFromHeader),this.$root.$on("clear-search",this.handleClearSearchFromHeader)},beforeDestroy(){window.removeEventListener("storage",this.handleStorageChange),window.removeEventListener("resize",this.handleResize),this.$root.$off("toggle-mobile-sidebar",this.handleToggleFromLogo),this.$root.$off("search-articles",this.handleSearchFromHeader),this.$root.$off("clear-search",this.handleClearSearchFromHeader)},activated(){this.loadAiConfig(),this.loadKnowledgeBase()},watch:{$route(e,t){"/userhome"===e.path&&"/ai-settings"===t.path&&(this.loadAiConfig(),this.loadKnowledgeBase()),"/userhome"===e.path&&"/userhomedetail"===t.path&&(!this.isInitialized||this.isRestoringFilterState||this.hasTriedRestoreState||(console.log("[UserHome] 从详情页返回，恢复筛选状态"),this.hasTriedRestoreState=!0,this.restoreFilterState()))},"$route.query":{immediate:!0,handler(e){if(console.log("[UserHome] watch $route.query 触发",{newQuery:e,isInitialized:this.isInitialized,hasTriedRestoreState:this.hasTriedRestoreState,isRestoringFilterState:this.isRestoringFilterState}),this.isInitialized){if(this.hasTriedRestoreState&&!e.boardId&&!e.pBoardId)return void console.log("[UserHome] 已恢复状态且 URL 无参数，跳过 handleRouteQuery");this.handleRouteQuery(e)}}},chatMessages:{handler(e){this.saveChatMessages(e)},deep:!0},treedata:{handler(){},immediate:!1}},methods:{saveFilterState(){const e={boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum,currentSort:this.currentSort,currentFilter:this.currentFilter,currentNodeKey:this.currentNodeKey};console.log("[UserHome] 保存筛选状态:",e);try{sessionStorage.setItem("forum_filter_state",JSON.stringify(e)),console.log("[UserHome] 筛选状态已保存到 sessionStorage")}catch(t){console.error("[UserHome] 保存筛选状态失败:",t)}},restoreFilterState(){try{const e=sessionStorage.getItem("forum_filter_state");if(console.log("[UserHome] 尝试恢复筛选状态，保存的状态:",e),e){const t=JSON.parse(e);return console.log("[UserHome] 解析后的筛选状态:",t),this.isRestoringFilterState=!0,this.$set(this.queryform,"boardId",t.boardId||""),this.$set(this.queryform,"pBoardId",t.pBoardId||""),this.$set(this.queryform,"pageNum",t.pageNum||1),this.currentSort=t.currentSort||"all",this.currentFilter=t.currentFilter||"全部帖子",this.currentNodeKey=t.currentNodeKey,console.log("[UserHome] 恢复后的参数:",{boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum,currentSort:this.currentSort,currentFilter:this.currentFilter,currentNodeKey:this.currentNodeKey}),(this.queryform.boardId||this.queryform.pBoardId)&&this.updateExpandedKeys(),this.getcontent().finally((()=>{this.isRestoringFilterState=!1,this.$forceUpdate(),console.log("[UserHome] 筛选状态恢复完成，内容已重新加载，当前 pageNum:",this.queryform.pageNum)})),console.log("[UserHome] 筛选状态已恢复:",t),!0}console.log("[UserHome] 没有找到保存的筛选状态")}catch(e){console.error("[UserHome] 恢复筛选状态失败:",e)}return!1},clearFilterState(){try{sessionStorage.removeItem("forum_filter_state")}catch(e){console.error("[UserHome] 清除筛选状态失败:",e)}},handleStorageChange(e){"huomiao_ai_config"===e.key&&this.loadAiConfig(),"huomiao_knowledge_base"===e.key&&this.loadKnowledgeBase(),"huomiao_ai_online"===e.key&&this.loadAiConfig(),"huomiao_chat_cleared"===e.key&&(this.chatMessages=this.loadChatMessages())},loadChatMessages(){try{const e=localStorage.getItem("huomiao_chat_history");if(e)return JSON.parse(e)}catch(e){console.error("加载聊天历史失败:",e)}return[{id:"welcome",role:"model",text:"你好！我是论坛小助手火妙，有什么可以帮你的吗？",timestamp:Date.now()}]},saveChatMessages(e){try{localStorage.setItem("huomiao_chat_history",JSON.stringify(e))}catch(t){console.error("保存聊天历史失败:",t)}},loadAiConfig(){try{const e=m.A.loadConfig();this.aiConfig={protocol:e.protocol||"openai-compatible",baseUrl:e.baseUrl||"",apiKey:e.apiKey||"",modelId:e.modelId||"",systemPrompt:e.systemPrompt||""}}catch(e){console.error("加载 AI 配置失败:",e)}},loadKnowledgeBase(){try{const e=localStorage.getItem("huomiao_knowledge_base");this.knowledgeBase=e?JSON.parse(e):[]}catch(e){console.error("加载知识库失败:",e),this.knowledgeBase=[]}},initData(){this.getlist().then((()=>{this.isInitialized=!0,this.handleRouteQuery(this.$route.query)}))},handleRouteQuery(e){if(console.log("[UserHome] handleRouteQuery 被调用",{query:e,isInitialized:this.isInitialized,isRestoringFilterState:this.isRestoringFilterState,currentPageNum:this.queryform.pageNum}),this.isInitialized)if(this.isRestoringFilterState)console.log("[UserHome] handleRouteQuery: 正在恢复状态，跳过");else{if(!e.pBoardId&&!e.boardId){const e=this.queryform.boardId||this.queryform.pBoardId;return e?void console.log("[UserHome] URL 无参数，但保持已恢复的筛选条件",{boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum}):(console.log("[UserHome] URL 无参数且无筛选条件，重置为全部帖子"),this.queryform.boardId="",this.queryform.pBoardId="",this.queryform.pageNum=1,this.currentNodeKey=null,this.currentFilter="全部帖子",void this.getcontent())}console.log("[UserHome] URL 有参数，根据参数设置筛选条件"),this.queryform.boardId=e.boardId||"",this.queryform.pBoardId=e.pBoardId||"",this.queryform.pageNum=1,this.currentNodeKey=null,e.boardId?this.currentNodeKey=parseInt(e.boardId):e.pBoardId&&(this.currentNodeKey=parseInt(e.pBoardId)),this.updateExpandedKeys(),this.updateCurrentFilter(),this.getcontent()}else console.log("[UserHome] handleRouteQuery: 未初始化，跳过")},updateExpandedKeys(){const e=new Set([...this.expandedKeys]);if(this.queryform.pBoardId&&e.add(parseInt(this.queryform.pBoardId)),this.queryform.boardId&&this.treedata.length>0){const t=(e,s)=>{for(const a of e)if(a.children){for(const t of a.children)if(t.id==s)return a.id;const e=t(a.children,s);if(e)return e}return null},s=t(this.treedata,this.queryform.boardId);s&&e.add(s)}this.expandedKeys=Array.from(e)},handleNodeClick(e){const t={};0!=e.pid?(t.boardId=e.id,t.pBoardId=e.pid):t.pBoardId=e.id;const s=this.$route.query,a=s.boardId==t.boardId&&s.pBoardId==t.pBoardId;a?(this.queryform.boardId=t.boardId||"",this.queryform.pBoardId=t.pBoardId||"",this.queryform.pageNum=1,this.currentNodeKey=e.id,this.updateExpandedKeys(),this.updateCurrentFilter(),this.getcontent(),this.saveFilterState()):this.$router.push({path:"/userhome",query:t}).catch((e=>{"NavigationDuplicated"!==e.name&&console.error("导航错误:",e)})),this.isMobile&&this.isSidebarOpen&&this.toggleSidebar()},goHome(){const e=this.$route.query.boardId||this.$route.query.pBoardId;"/userhome"!==this.$route.path?this.$router.push({path:"/userhome",query:{}}):e&&this.$router.push({path:"/userhome",query:{}}).catch((e=>{"NavigationDuplicated"!==e.name&&console.error("导航错误:",e)})),this.clearFilterState()},handleNavigate(e){"home"===e?this.goHome():"community"===e?this.$message.info("社区广场功能开发中..."):"createBoard"===e&&this.openCreateBoardDialog()},resetFilter(){this.queryform.boardId="",this.queryform.pBoardId="",this.queryform.pageNum=1,this.currentFilter="全部帖子",this.getcontent(),this.clearFilterState(),this.isMobile&&this.isSidebarOpen&&(this.isSidebarOpen=!1),(this.$route.query.boardId||this.$route.query.pBoardId)&&this.$router.push({path:"/userhome",query:{}}),this.$message.success("已重置筛选，显示全部帖子")},getTreeIcon(e){return e.children&&e.children.length>0?"el-icon-folder":"el-icon-document"},isSubCategoryActive(e){return this.queryform.boardId==e},godetail(e){this.saveFilterState(),this.$router.push({path:"/userhomedetail",query:{id:e.id}})},handleCurrentChange(e){this.queryform.pageNum=e,this.getcontent(),this.saveFilterState()},async getlist(){try{const e=await o.A.get("/board/list");return 200==e.code||1==e.code?(this.treedata=e.data,this.$nextTick((()=>{this.checkMobile()})),Promise.resolve()):(console.error("[getlist] 获取失败:",e.msg),Promise.reject(new Error(e.msg)))}catch(e){return console.error("[getlist] 请求异常:",e),Promise.reject(e)}},async getcontent(){console.log("[UserHome] getcontent 被调用",{pageNum:this.queryform.pageNum,pageSize:this.queryform.pageSize,boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId});try{const e={pageNum:this.queryform.pageNum,pageSize:this.queryform.pageSize,statusInteger:1};this.queryform.pBoardId&&(e.pBoardId=this.queryform.pBoardId),this.queryform.boardId&&(e.boardId=this.queryform.boardId),console.log("[UserHome] getcontent 请求参数:",e);const t=await o.A.post("/article/list",e);200==t.code||1==t.code?(this.$set(this,"contentlist",t.data.records||[]),this.$set(this,"total",t.data.total||0),console.log("[UserHome] getcontent 请求成功",{"返回的页码":t.data.current,"总记录数":t.data.total,"当前页记录数":(t.data.records||[]).length})):(this.$set(this,"contentlist",[]),this.$set(this,"total",0))}catch(e){console.error("[UserHome] getcontent 请求失败:",e),this.$set(this,"contentlist",[]),this.$set(this,"total",0)}},updateCurrentFilter(){if(!this.queryform.boardId&&!this.queryform.pBoardId)return void(this.currentFilter="全部帖子");const e=(t,s)=>{for(const a of t){if(a.id==s)return a.name;if(a.children&&a.children.length>0){const t=e(a.children,s);if(t)return t}}return null};let t="";this.queryform.boardId?t=e(this.treedata,this.queryform.boardId):this.queryform.pBoardId&&(t=e(this.treedata,this.queryform.pBoardId)),this.currentFilter=t||"筛选内容"},handleArticlePublished(){this.$message.success("文章发布成功！"),this.getcontent()},async handleSort(e){if(this.currentSort===e)return;this.currentSort=e;const t={all:"全部帖子",hot:"热门帖子",latest:"最新帖子"};this.currentFilter=t[e],this.queryform.pageNum=1,"hot"===e?await this.getTopReadArticles():"latest"===e?await this.getLatestArticles():await this.getcontent(),this.saveFilterState()},async getLatestArticles(){try{const e=await o.A.post("/article/latest");200==e.code||1==e.code?(this.$set(this,"contentlist",e.data||[]),this.$set(this,"total",(e.data||[]).length)):(this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error(e.msg||"获取最新文章失败"))}catch(e){console.error("获取最新文章失败:",e),this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error("获取最新文章失败，请稍后重试")}},async getTopReadArticles(){try{const e=await o.A.post("/article/topReadCount");200==e.code||1==e.code?(this.$set(this,"contentlist",e.data||[]),this.$set(this,"total",(e.data||[]).length)):(this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error(e.msg||"获取热门文章失败"))}catch(e){console.error("获取热门文章失败:",e),this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error("获取热门文章失败，请稍后重试")}},handleCommunitySelect(e){this.queryform.boardId=e.boardId,this.queryform.pBoardId=e.pBoardId,this.queryform.pageNum=1,this.currentFilter=e.name,this.getcontent(),this.saveFilterState(),this.isMobile&&this.isSidebarOpen&&(this.isSidebarOpen=!1),this.$message.success(`已筛选：${e.name}`)},toggleChat(){this.isChatOpen||this.isLoggedIn?(this.isChatOpen=!this.isChatOpen,this.isChatOpen&&(this.unreadCount=0)):this.$message.warning("请先登录后再使用 AI 聊天功能")},async handleSendMessage(e){if(this.isLoggedIn){if(e.trim()){this.chatMessages.push({id:Date.now().toString(),role:"user",text:e,timestamp:Date.now()}),this.isChatLoading=!0;try{await this.callAiServiceStream()}catch(t){console.error("AI 服务调用失败:",t),this.chatMessages.push({id:(Date.now()+1).toString(),role:"system",text:"AI 服务暂时不可用，请稍后再试。",timestamp:Date.now()}),this.isChatLoading=!1}}}else this.$message.warning("请先登录后再使用 AI 聊天功能")},async callAiServiceStream(){try{const e=(Date.now()+1).toString();let t="",s=[],a=!1,i=-1;m.A.chatStream(this.chatMessages,(s=>{a?(t+=s,this.chatMessages[i].text=t,this.$set(this.chatMessages,i,{...this.chatMessages[i]})):(this.chatMessages.push({id:e,role:"model",text:s,timestamp:Date.now(),usedKnowledge:[]}),i=this.chatMessages.length-1,a=!0)}),(e=>{s=e,i>=0&&(this.chatMessages[i].usedKnowledge=e)}),(()=>{if(this.isChatLoading=!1,this.isChatOpen||this.unreadCount++,s&&s.length>0&&i>=0){const e=s.map((e=>`📚 ${e.title}`)).join("\n");this.chatMessages[i].text+=`\n\n---\n${e}`,this.$set(this.chatMessages,i,{...this.chatMessages[i]})}}),(e=>{console.error("AI 流式响应错误:",e),a&&i>=0&&this.chatMessages.splice(i,1),this.chatMessages.push({id:(Date.now()+2).toString(),role:"system",text:this.getFriendlyErrorMessage(e),timestamp:Date.now()}),this.isChatLoading=!1}))}catch(e){throw console.error("AI 服务错误:",e),this.isChatLoading=!1,e}},getFriendlyErrorMessage(e){const t=e.message||e.toString()||"";return t.includes("API Key")||t.includes("apiKey")?"请先配置有效的 API Key。配置路径：管理后台 → 信息管理 → AI设置管理":t.includes("网络")||t.includes("fetch")||t.includes("timeout")?"网络连接失败，请检查网络设置后重试":t.includes("rate limit")||t.includes("429")?"请求过于频繁，请稍后再试":t.includes("quota")||t.includes("balance")?"API 额度不足，请检查账户余额":"抱歉，我暂时无法回复。请稍后再试或联系管理员"},async callAiService(){try{return new Promise(((e,t)=>{let s="",a=[];m.A.chatStream(this.chatMessages,(e=>{s+=e}),(e=>{a=e}),(()=>{e({reply:s,usedKnowledge:a,latency:0})}),(e=>{t(e)}))}))}catch(e){throw console.error("AI 服务错误:",e),e}},handleToggleFromLogo(){this.isMobile&&this.toggleSidebar()},checkMobile(){const e=window.innerWidth;this.windowWidth=e,this.isMobile=e<=768,this.isMobile?this.isSidebarCollapsed=!0:this.isSidebarCollapsed=!1},handleResize(){this.checkMobile()},toggleSidebar(){this.isMobile?(this.isSidebarOpen=!this.isSidebarOpen,this.isSidebarOpen?document.body.style.overflow="hidden":document.body.style.overflow=""):this.isSidebarCollapsed=!this.isSidebarCollapsed},closeSidebar(){this.isMobile&&this.isSidebarOpen&&(console.log("[UserHome] 关闭移动端侧边栏"),this.isSidebarOpen=!1,document.body.style.overflow="")},async handleSearchFromHeader(e){console.log("[UserHome] 收到搜索请求:",e);try{const t=await o.A.post("/article/aiSearch",{question:e});200===t.code||1===t.code?(console.log("[UserHome] 搜索结果:",t.data),t.data&&Array.isArray(t.data)?(this.$set(this,"contentlist",t.data),this.$set(this,"total",t.data.length||0)):t.data&&t.data.records?(this.$set(this,"contentlist",t.data.records||[]),this.$set(this,"total",t.data.total||0)):(this.$set(this,"contentlist",[]),this.$set(this,"total",0)),this.currentFilter=`搜索："${e}"`,this.queryform.pageNum=1,this.$message.success("搜索完成")):(this.$message.error(t.msg||"搜索失败，请稍后重试"),this.$set(this,"contentlist",[]),this.$set(this,"total",0))}catch(t){console.error("[UserHome] 搜索失败:",t),this.$message.error("搜索失败，请稍后重试"),this.$set(this,"contentlist",[]),this.$set(this,"total",0)}},handleClearSearchFromHeader(){console.log("[UserHome] 收到清除搜索请求"),this.currentFilter="全部帖子",this.getcontent()},openCreateBoardDialog(){this.isLoggedIn?this.showCreateBoardDialog=!0:this.$message.warning("请先登录后再创建板块")},async handleBoardCreated(){console.log("[UserHome] 板块创建成功，刷新板块列表"),await this.getlist()}}},p=h,g=s(81656),f=(0,g.A)(p,a,i,!1,null,"c31a890a",null),b=f.exports},14149:function(e,t,s){s.d(t,{A:function(){return p}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"forum-container"},[e.loadingPage?t("div",{staticClass:"page-loading"},[e._m(0)]):e._e(),e.isMobile?t("div",{staticClass:"sidebar-overlay",class:{"overlay-active":e.isSidebarOpen&&e.isMobile},on:{click:e.toggleSidebar}}):e._e(),t("ForumSidebar",{attrs:{"tree-data":e.treedata,"expanded-keys":e.expandedKeys,"current-node-key":e.currentNodeKey,"active-board-id":e.queryform.boardId,"is-mobile":e.isMobile,"is-sidebar-collapsed":e.isSidebarCollapsed,"is-sidebar-open":e.isSidebarOpen,query:e.$route.query},on:{"node-click":e.handleNodeClick,close:e.toggleSidebar,navigate:e.handleNavigate}}),t("div",{staticClass:"main-content"},[t("div",{staticClass:"back-button-container"},[t("el-button",{staticClass:"back-button",attrs:{icon:"el-icon-arrow-left",type:"text"},on:{click:e.goBack}},[e._v(" 返回上一页 ")])],1),t("div",{staticClass:"container-box"},[t("div",{staticClass:"article-card"},[t("div",{staticClass:"article-header"},[t("h1",{staticClass:"article-title"},[e._v(e._s(e.info.title))]),t("div",{staticClass:"article-meta"},[t("div",{staticClass:"meta-item"},[t("i",{staticClass:"el-icon-time"}),t("span",[e._v(e._s(e.info.postTime))])]),t("div",{staticClass:"meta-item"},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v(e._s(e.info.nickName))])])])]),t("div",{staticClass:"article-content",domProps:{innerHTML:e._s(e.info.content)}}),e.fjlist.length>0?t("div",{staticClass:"attachments"},[e._m(1),t("div",{staticClass:"attachments-list"},e._l(e.fjlist,(function(s){return t("div",{key:s.fileId,staticClass:"attachment-item",on:{click:function(t){return e.xiazai(s)}}},[t("i",{staticClass:"el-icon-download attachment-icon"}),t("span",{staticClass:"attachment-name"},[e._v(e._s(s.fileName))]),s.fileSize?t("span",{staticClass:"attachment-size"},[e._v(e._s(e.$formatFileSize(s.fileSize)))]):e._e()])})),0)]):e._e(),t("div",{staticClass:"article-actions"},[t("div",{staticClass:"action-item",class:{active:e.havelike},on:{click:e.like}},[t("i",{staticClass:"el-icon-star-on"}),t("span",[e._v(e._s(e.info.goodCount||0))])]),t("div",{staticClass:"action-btn"},[t("i",{staticClass:"el-icon-s-comment"}),t("span",{staticClass:"action-text"},[e._v("评论")]),t("span",{staticClass:"action-count"},[e._v(e._s(e.info.commentCount||0))])]),t("div",{staticClass:"action-btn"},[t("i",{staticClass:"el-icon-view"}),t("span",{staticClass:"action-text"},[e._v("浏览")]),t("span",{staticClass:"action-count"},[e._v(e._s(e.info.readCount||0))])]),t("el-button",{staticClass:"comment-btn",attrs:{type:"primary",disabled:e.commentButtonDisabled},on:{click:e.pl}},[t("i",{staticClass:"el-icon-edit"}),e._v(" "+e._s(e.commentButtonText)+" ")])],1)]),t("div",{staticClass:"comments-section"},[t("div",{staticClass:"section-header"},[t("h3",{staticClass:"section-title"},[t("i",{staticClass:"el-icon-chat-dot-square"}),e._v(" 全部评论 "),t("span",{staticClass:"comment-count"},[e._v(e._s(e.commentlist.length))])])]),0===e.commentlist.length?t("div",{staticClass:"empty-comments"},[t("div",{staticClass:"empty-comment-icon"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"}},[t("path",{attrs:{d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z","stroke-linecap":"round","stroke-linejoin":"round"}})])]),t("p",{staticClass:"empty-comment-title"},[e._v("还没有评论")]),t("p",{staticClass:"empty-comment-desc"},[e._v("快来发表你的见解吧！")])]):e._e(),t("div",{staticClass:"comments-list"},e._l(e.commentlist,(function(s){return t("div",{key:s.commentId,staticClass:"comment-item"},[t("comment-item",{attrs:{comment:s,type:"main","current-user-id":e.user?e.user.id:null,"article-author-id":e.info.userId,"can-pin":e.user&&e.user.userId==e.info.userId},on:{like:e.commentlike,reply:e.pl1,pin:e.zd,delete:e.delComment}}),s.children&&s.children.length>0?t("div",{staticClass:"comment-replies"},e._l(s.children,(function(a){return t("comment-item",{key:a.commentId,attrs:{comment:a,type:"reply","current-user-id":e.user?e.user.id:null,"article-author-id":e.info.userId,"can-pin":e.user&&e.user.userId==e.info.userId},on:{like:e.commentlike,reply:()=>e.pl2(a,s),pin:e.zd,delete:e.delComment}})})),1):e._e()],1)})),0)])])]),t("el-dialog",{class:e.isMobile?"mobile-comment-dialog":"comment-dialog",attrs:{title:0===e.form.pCommentId?"发表评论":"回复评论",visible:e.fromVisible,width:e.isMobile?"100%":"600px","close-on-click-modal":!1,"modal-append-to-body":!0,"append-to-body":!0,"custom-class":"comment-dialog-wrapper"},on:{"update:visible":function(t){e.fromVisible=t}}},[t("el-form",{ref:"formRef",staticClass:"comment-form",attrs:{model:e.form,"label-width":e.isMobile?"60px":"80px"}},[t("el-form-item",{attrs:{label:"内容",prop:"content",required:""}},[t("el-input",{staticClass:"comment-textarea",attrs:{type:"textarea",rows:e.isMobile?6:4,placeholder:e.isMobile?"说点什么...":"请输入评论内容...",maxlength:"500","show-word-limit":"",resize:"none"},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),t("el-form-item",{attrs:{label:"图片"}},[e.isMobile?[e.form.imagePath?e._e():t("oss-image-upload",{attrs:{"upload-type":"comment","max-size":1,tip:"上传图片","size-tip":"大小不超过1MB","upload-class":"upload-area"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"upload-content mobile-upload"},[t("i",{staticClass:"el-icon-plus upload-icon"})])]},proxy:!0}],null,!1,1607958322),model:{value:e.form.imagePath,callback:function(t){e.$set(e.form,"imagePath",t)},expression:"form.imagePath"}}),e.form.imagePath?t("div",{staticClass:"mobile-image-preview"},[t("div",{staticClass:"preview-wrapper"},[t("img",{staticClass:"preview-image",attrs:{src:e.$getImageUrl(e.form.imagePath)}}),t("i",{staticClass:"el-icon-error close-icon",on:{click:function(t){e.form.imagePath=""}}})])]):e._e()]:[t("oss-image-upload",{attrs:{"upload-type":"comment","max-size":1,tip:"上传图片","size-tip":"大小不超过1MB","upload-class":"upload-area"},scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"upload-content",class:{"mobile-upload":e.isMobile}},[e.form.imagePath?e._e():t("i",{staticClass:"el-icon-plus upload-icon"}),e.form.imagePath?t("img",{staticClass:"upload-preview",attrs:{src:e.$getImageUrl(e.form.imagePath)}}):e._e()])]},proxy:!0}],null,!1,1306826488),model:{value:e.form.imagePath,callback:function(t){e.$set(e.form,"imagePath",t)},expression:"form.imagePath"}}),t("div",{staticClass:"upload-tip"},[e._v("支持上传图片，大小不超过1MB")])]],2)],1),t("div",{class:e.isMobile?"mobile-dialog-footer":"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.isMobile?[t("el-button",{staticClass:"mobile-btn mobile-btn-cancel",attrs:{size:"large"},on:{click:function(t){e.fromVisible=!1}}},[e._v("取消")]),t("el-button",{staticClass:"mobile-btn mobile-btn-confirm",attrs:{type:"primary",loading:e.loading,size:"large"},on:{click:e.save}},[e._v(" "+e._s(e.loading?"发布中...":"发布")+" ")])]:[t("el-button",{on:{click:function(t){e.fromVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("确定")])]],2)],1)],1)},i=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"loading-content"},[t("div",{staticClass:"loading-spinner"},[t("div",{staticClass:"spinner"}),t("div",{staticClass:"spinner"}),t("div",{staticClass:"spinner"}),t("div",{staticClass:"spinner"})]),t("div",{staticClass:"loading-text"},[e._v("正在加载内容...")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"attachments-title"},[t("i",{staticClass:"el-icon-document"}),t("span",[e._v("附件下载")])])}],o=(s(44114),s(18962)),r=s(1416),l=s(8723),n=s(92646),c=s(65383),d={name:"ArticleDetail",components:{ForumSidebar:r.A,OssImageUpload:l.A,UserAvatar:n.A,CommentItem:c.A},data(){return{info:{},fromVisible:!1,form:{},total:0,commentlist:[],havelike:!1,fjlist:[],comment:"",comment1:"",receive:"",receive1:"",receive3:"",loading:!1,user:null,token:"",commentButtonDisabled:!0,commentButtonText:"发表评论",loadingPage:!0,loadingTime:0,keyboardOpen:!1,treedata:[],expandedKeys:[1,2,5],currentNodeKey:null,queryform:{boardId:"",pBoardId:""},isMobile:!1,isSidebarOpen:!1,isSidebarCollapsed:!1,windowWidth:window.innerWidth}},mounted(){this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),this.startLoadingTimer(),this.getdata(),this.getBoardList(),this.checkMobile(),window.addEventListener("resize",this.handleResize),this.$root.$on("toggle-mobile-sidebar",this.handleToggleFromLogo),setTimeout((()=>{this.commentButtonDisabled=!1}),500)},methods:{goBack(){window.history.length>1?this.$router.go(-1):this.$router.push("/userhome")},startLoadingTimer(){this.loadingTime=setTimeout((()=>{this.loadingPage}),3e3)},clearLoadingTimer(){this.loadingTime&&(clearTimeout(this.loadingTime),this.loadingTime=0)},async getBoardList(){try{const e=await o.A.get("/board/list");200==e.code&&(this.treedata=e.data)}catch(e){console.error(e)}},handleNavClick(e){this.activeNav=e},handleNodeClick(e){this.$router.push({path:"/userhome",query:{boardId:0!=e.pid?e.id:"",pBoardId:0!=e.pid?e.pid:e.id}}),window.innerWidth<=768&&this.closeMobileSidebar()},handleNavigate(e){"home"===e?this.$router.push({path:"/userhome",query:{}}):"community"===e&&this.$message.info("社区广场功能开发中...")},toggleMobileSidebar(){this.mobileSidebarOpen=!this.mobileSidebarOpen},closeMobileSidebar(){this.mobileSidebarOpen=!1},handleToggleFromLogo(){this.toggleMobileSidebar()},pl1(e){const t=localStorage.getItem("userinfo");t?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:e.commentId,replyUserId:e.userId,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error("你还未登录")},pl2(e,t){const s=localStorage.getItem("userinfo");s?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:t.commentId,replyUserId:e.userId,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error("你还未登录")},pl(){if(this.commentButtonDisabled)return void console.log("[评论] 按钮还在禁用期内，忽略点击");const e=localStorage.getItem("userinfo");e?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:0,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error("你还未登录")},async zd(e){const t=localStorage.getItem("userinfo");if(t)try{const t=await o.A.post("/article/changeTop",{commentId:e});200==t.code&&(this.$message.success(t.message||"操作成功"),this.getdata())}catch(s){console.error(s)}else this.$message.error("你还未登录")},async commentlike(e){const t=localStorage.getItem("userinfo");if(t)try{const t=await o.A.post("/article/commentlike",{commentId:e});200==t.code&&this.getdata()}catch(s){console.error(s)}else this.$message.error("你还未登录")},async getlist(){try{const e=await o.A.post("/article/loadcomment",{articleId:this.info.id});200==e.code&&(this.commentlist=e.data)}catch(e){console.error("加载评论失败:",e),this.commentlist=[]}},async xiazai(e){try{await o.A.get("/article/downloadAttachment?fileId="+e.fileId);this.$message.success("开始下载")}catch(t){console.error(t)}},async like(){const e=localStorage.getItem("userinfo");if(!e)return void this.$message.error("你还未登录");const t=this.havelike,s=this.info.goodCount||0;this.havelike=!t,this.info.goodCount=t?s-1:s+1;try{const e=await o.A.post("/article/dolike",{id:this.info.id});200==e.code||(this.havelike=t,this.info.goodCount=s,this.$message.error(e.msg||"操作失败"))}catch(a){this.havelike=t,this.info.goodCount=s,this.$message.error("网络错误，请稍后重试")}},async delComment(e){this.$confirm("确定要删除这条评论吗？删除后不可恢复。","提示",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",customClass:"delete-confirm"}).then((async()=>{try{const t=await o.A.post("/article/deletecomment",{commentId:e});200==t.code||1==t.code?(this.$message.success("删除成功"),this.getlist(),this.info&&void 0!==this.info.commentCount&&(this.info.commentCount=Math.max(0,this.info.commentCount-1))):this.$message.error(t.msg||"删除失败")}catch(t){console.error("删除评论失败:",t),this.$message.error("删除失败，请稍后重试")}})).catch((()=>{}))},async save(){if(this.form.content&&""!==this.form.content.trim()){this.loading=!0;try{const e=await o.A.post("/article/postcomment",{articleId:this.form.articleId,pCommentId:this.form.pCommentId,content:this.form.content,imagePath:this.form.imagePath,replyUserId:this.form.replyUserId});200==e.code&&(this.$message.success("评论成功"),this.fromVisible=!1,this.getdata())}catch(e){console.error(e)}finally{this.loading=!1}}else this.$message.warning("请输入评论内容")},async getdata(){try{const e=await o.A.post("/article/detail",{id:this.$route.query.id});200==e.code&&(this.info=e.data.article,this.fjlist=e.data.attachments||[],this.havelike=!0===e.data.haveLike||1===e.data.haveLike,await this.getlist())}catch(e){console.error(e)}finally{setTimeout((()=>{this.loadingPage=!1,this.clearLoadingTimer()}),1e3)}},checkMobile(){const e=window.innerWidth;this.windowWidth=e,this.isMobile=e<=768,this.isMobile?this.isSidebarCollapsed=!0:this.isSidebarCollapsed=!1},handleResize(){this.checkMobile()},toggleSidebar(){this.isMobile?(this.isSidebarOpen=!this.isSidebarOpen,this.isSidebarOpen?document.body.style.overflow="hidden":document.body.style.overflow=""):this.isSidebarCollapsed=!this.isSidebarCollapsed},setupMobileKeyboardListener(){this.removeMobileKeyboardListener(),this.initialHeight=window.innerHeight,this.keyboardShowHandler=()=>{const e=window.innerHeight;e<this.initialHeight-150?(this.keyboardOpen=!0,this.addKeyboardOpenClass()):(this.keyboardOpen=!1,this.removeKeyboardOpenClass())},window.addEventListener("resize",this.keyboardShowHandler),window.visualViewport&&window.visualViewport.addEventListener("resize",this.keyboardShowHandler)},addKeyboardOpenClass(){const e=document.querySelector(".mobile-comment-dialog");e&&e.classList.add("keyboard-open")},removeKeyboardOpenClass(){const e=document.querySelector(".mobile-comment-dialog");e&&e.classList.remove("keyboard-open")},removeMobileKeyboardListener(){this.keyboardShowHandler&&(window.removeEventListener("resize",this.keyboardShowHandler),window.visualViewport&&window.visualViewport.removeEventListener("resize",this.keyboardShowHandler),this.keyboardShowHandler=null),this.removeKeyboardOpenClass()}},beforeDestroy(){this.clearLoadingTimer(),window.removeEventListener("resize",this.handleResize),this.$root.$off("toggle-mobile-sidebar",this.handleToggleFromLogo),this.removeMobileKeyboardListener()}},m=d,u=s(81656),h=(0,u.A)(m,a,i,!1,null,"231cc0b5",null),p=h.exports}}]);