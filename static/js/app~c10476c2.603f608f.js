"use strict";(self["webpackChunkhard_diancan_front"]=self["webpackChunkhard_diancan_front"]||[]).push([[126],{54457:function(t,e,s){s.d(e,{A:function(){return y}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"forum-container"},[e("ForumSidebar",{attrs:{"tree-data":t.treedata,"expanded-keys":t.expandedKeys,"current-node-key":t.currentNodeKey,"active-board-id":t.queryform.boardId,"is-mobile":t.isMobile,"is-sidebar-collapsed":t.isSidebarCollapsed,"is-sidebar-open":t.isSidebarOpen,query:t.$route.query},on:{"node-click":t.handleNodeClick,close:t.closeSidebar,navigate:t.handleNavigate,"select-community":t.handleCommunitySelect}}),t.isMobile?e("div",{staticClass:"sidebar-overlay",class:{"overlay-active":t.isSidebarOpen&&t.isMobile},on:{click:t.closeSidebar}}):t._e(),e("div",{staticClass:"main-content"},[e("div",{staticClass:"filter-bar"},[e("div",{staticClass:"filter-left"},[t.isMobile?e("div",{staticClass:"mobile-top-row"},[e("div",{staticClass:"layout-toggle"},[e("div",{staticClass:"layout-toggle-btn",class:{active:"list"===t.postsLayoutMode},attrs:{title:"ÂàóË°®ËßÜÂõæ"},on:{click:function(e){return t.handleLayoutChange("list")}}},[e("i",{staticClass:"el-icon-s-order"})]),e("div",{staticClass:"layout-toggle-btn",class:{active:"grid"===t.postsLayoutMode},attrs:{title:"ÁΩëÊ†ºËßÜÂõæ"},on:{click:function(e){return t.handleLayoutChange("grid")}}},[e("i",{staticClass:"el-icon-s-grid"})])]),e("div",{staticClass:"sort-tabs"},[e("div",{staticClass:"sort-tab",class:{active:"all"===t.currentSort},on:{click:function(e){return t.handleSort("all")}}},[e("i",{staticClass:"el-icon-star-off"}),e("span",[t._v(t._s(t.$t("forum.all")))])]),e("div",{staticClass:"sort-tab",class:{active:"hot"===t.currentSort},on:{click:function(e){return t.handleSort("hot")}}},[e("i",{staticClass:"el-icon-trophy"}),e("span",[t._v(t._s(t.$t("forum.hot")))])]),e("div",{staticClass:"sort-tab",class:{active:"latest"===t.currentSort},on:{click:function(e){return t.handleSort("latest")}}},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v(t._s(t.$t("forum.latest")))])])]),e("div",{staticClass:"search-button",on:{click:t.goToSearchPage}},[e("i",{staticClass:"el-icon-search"})]),t.isLoggedIn?e("div",{staticClass:"action-button-mobile"},[e("el-dropdown",{attrs:{trigger:"click",placement:"bottom-end"},on:{command:t.handleActionCommand}},[e("div",{staticClass:"create-dropdown-trigger"},[e("i",{staticClass:"el-icon-plus"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"publish"}},[e("i",{staticClass:"el-icon-edit"}),t._v(" "+t._s(t.$t("forum.publishArticle"))+" ")]),e("el-dropdown-item",{attrs:{command:"createBoard"}},[e("i",{staticClass:"el-icon-folder-add"}),t._v(" "+t._s(t.$t("forum.createBoard"))+" ")])],1)],1)],1):t._e()]):t._e(),t.isMobile?t._e():[e("div",{staticClass:"layout-toggle"},[e("div",{staticClass:"layout-toggle-btn",class:{active:"list"===t.postsLayoutMode},attrs:{title:"ÂàóË°®ËßÜÂõæ"},on:{click:function(e){return t.handleLayoutChange("list")}}},[e("i",{staticClass:"el-icon-s-order"})]),e("div",{staticClass:"layout-toggle-btn",class:{active:"grid"===t.postsLayoutMode},attrs:{title:"ÁΩëÊ†ºËßÜÂõæ"},on:{click:function(e){return t.handleLayoutChange("grid")}}},[e("i",{staticClass:"el-icon-s-grid"})])]),e("div",{staticClass:"sort-tabs"},[e("div",{staticClass:"sort-tab",class:{active:"all"===t.currentSort},on:{click:function(e){return t.handleSort("all")}}},[e("i",{staticClass:"el-icon-star-off"}),e("span",[t._v(t._s(t.$t("forum.all")))])]),e("div",{staticClass:"sort-tab",class:{active:"hot"===t.currentSort},on:{click:function(e){return t.handleSort("hot")}}},[e("i",{staticClass:"el-icon-trophy"}),e("span",[t._v(t._s(t.$t("forum.hot")))])]),e("div",{staticClass:"sort-tab",class:{active:"latest"===t.currentSort},on:{click:function(e){return t.handleSort("latest")}}},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v(t._s(t.$t("forum.latest")))])])])],t.isMobile?t._e():e("div",{staticClass:"filter-info"},[e("span",{staticClass:"active-filter"},[t._v(t._s(t.currentFilter||t.$t("forum.allPosts")))]),t.queryform.boardId||t.queryform.pBoardId?e("span",{staticClass:"reset-filter",on:{click:t.resetFilter}},[e("i",{staticClass:"el-icon-close"}),t._v(" "+t._s(t.$t("forum.resetFilter"))+" ")]):t._e()])],2),t.isLoggedIn&&!t.isMobile?e("div",{staticClass:"action-section"},[e("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleActionCommand}},[e("el-button",{attrs:{type:"primary",round:""}},[t._v(" "+t._s(t.$t("forum.create"))+" "),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:"publish"}},[e("i",{staticClass:"el-icon-edit"}),t._v(" "+t._s(t.$t("forum.publishArticle"))+" ")]),e("el-dropdown-item",{attrs:{command:"createBoard"}},[e("i",{staticClass:"el-icon-folder-add"}),t._v(" "+t._s(t.$t("forum.createBoard"))+" ")])],1)],1)],1):t._e()]),e("publish-article",{ref:"publishArticlePC",staticClass:"pc-publish-hidden",attrs:{"is-mobile":!1,"button-text":""},on:{success:t.handleArticlePublished}}),e("publish-article",{ref:"publishArticleMobile",staticClass:"mobile-publish-hidden",attrs:{"is-mobile":!0,"button-text":""},on:{success:t.handleArticlePublished}}),e("create-board-dialog",{attrs:{visible:t.showCreateBoardDialog,"is-mobile":t.isMobile,boards:t.treedata},on:{"update:visible":function(e){t.showCreateBoardDialog=e},success:t.handleBoardCreated}}),e("forum-stats"),e("div",{staticClass:"posts-container",class:t.postsLayoutClass},[0!==t.contentlist.length||t.isInitialized?0===t.contentlist.length?e("div",{staticClass:"empty-state"},[e("div",{staticClass:"empty-icon"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"}},[e("path",{attrs:{d:"M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("p",{staticClass:"empty-title"},[t._v(t._s(t.$t("common.noData")))]),e("p",{staticClass:"empty-desc"},[t._v(t._s(t.$t("forum.publishArticle"))+"!")])]):t._e():e("div",{staticClass:"skeleton-loading"},t._l(3,(function(s){return e("div",{key:s,staticClass:"skeleton-card"},[t._m(0,!0),e("div",{staticClass:"skeleton-title"}),t._m(1,!0)])})),0),t._l(t.contentlist,(function(s){return e("post-card",{key:s.id,attrs:{post:s,"hot-threshold":100,"summary-length":100},on:{click:t.godetail}})}))],2),e("div",{staticClass:"pagination-container"},[e("el-pagination",{key:t.queryform.pageNum,staticClass:"forum-pagination",attrs:{background:"","current-page":t.queryform.pageNum,"page-sizes":[5,10,20],"page-size":t.queryform.pageSize,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1),e("HotCommunities",{attrs:{query:t.queryform},on:{"select-community":t.handleCommunitySelect}}),e("div",{staticClass:"ai-chat-wrapper"},[e("transition",{attrs:{name:"chat-slide"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isChatOpen,expression:"isChatOpen"}],staticClass:"ai-chat-float"},[e("ChatWindow",{attrs:{messages:t.chatMessages,isChatLoading:t.isChatLoading,isOnline:!0,knowledgeBase:t.knowledgeBase},on:{sendMessage:t.handleSendMessage,close:t.toggleChat}})],1)]),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isChatOpen,expression:"!isChatOpen"}],staticClass:"ai-chat-toggle",class:{active:t.isChatOpen,disabled:!t.isLoggedIn},attrs:{title:t.isLoggedIn?"":"ËØ∑ÂÖàÁôªÂΩï"},on:{click:t.toggleChat}},[e("div",{staticClass:"toggle-icon"},[t.isChatOpen?e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z","clip-rule":"evenodd"}})]):e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{"fill-rule":"evenodd",d:"M12.963 2.286a.75.75 0 00-1.071-.136 9.742 9.742 0 00-3.539 6.177 7.547 7.547 0 01-1.705-1.715.75.75 0 00-1.152.082A9 9 0 1015.68 4.534a7.46 7.46 0 01-2.717-2.248zM15.75 14.25a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z","clip-rule":"evenodd"}})])]),!t.isChatOpen&&t.unreadCount>0?e("div",{staticClass:"notification-badge"},[t._v(t._s(t.unreadCount))]):t._e(),t.isLoggedIn?t._e():e("div",{staticClass:"lock-icon"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{"fill-rule":"evenodd",d:"M12 1.5a5.25 5.25 0 00-5.25 5.25v3a3 3 0 00-3 3v6.75a3 3 0 003 3h10.5a3 3 0 003-3v-6.75a3 3 0 00-3-3v-3a5.25 5.25 0 00-5.25-5.25zm-3.75 8.25v-3a3.75 3.75 0 117.5 0v3h-7.5z","clip-rule":"evenodd"}})])])])],1)],1)},o=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"skeleton-header"},[e("div",{staticClass:"skeleton-avatar"}),e("div",{staticClass:"skeleton-user"},[e("div",{staticClass:"skeleton-line skeleton-name"}),e("div",{staticClass:"skeleton-line skeleton-time"})])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"skeleton-content"},[e("div",{staticClass:"skeleton-line"}),e("div",{staticClass:"skeleton-line"}),e("div",{staticClass:"skeleton-line short"})])}],a=(s(44114),s(17642),s(58004),s(33853),s(45876),s(32475),s(15024),s(31698),s(81454),s(18962)),r=s(27627),n=s(33827),l=s(29455),d=s(4380),c=s(61309),h=s(36197),m=s(81629),u=s(82329),g={name:"UserHome",components:{PublishArticle:r.A,ChatWindow:n.A,ForumSidebar:l.A,HotCommunities:d.A,PostCard:c.A,CreateBoardDialog:m.A,ForumStats:u.A},data(){return{defaultProps:{children:"children",label:"name"},total:0,treedata:[],contentlist:[],queryform:{boardId:"",pageNum:1,pBoardId:"",pageSize:10,status:1},user:{},currentFilter:"",currentSort:"all",expandedKeys:[1,2,5],currentNodeKey:null,isInitialized:!1,isRestoringFilterState:!1,hasTriedRestoreState:!1,chatMessages:[],isChatLoading:!1,knowledgeBase:[],isChatOpen:!1,unreadCount:0,aiConfig:null,isMobile:window.innerWidth<=768,isSidebarOpen:!1,isSidebarCollapsed:!1,activeCollapseNames:[],windowWidth:window.innerWidth,showCreateBoardDialog:!1,postsLayoutMode:"list"}},computed:{isLoggedIn(){return!!window.localStorage.getItem("token")},postsLayoutClass(){return{"posts-layout-list":"list"===this.postsLayoutMode,"posts-layout-grid":"grid"===this.postsLayoutMode}}},mounted(){console.log("[UserHome] mounted ÂºÄÂßãÊâßË°å"),this.user=JSON.parse(window.localStorage.getItem("userinfo")||"{}"),this.getlist().then((()=>{if(console.log("[UserHome] getlist ÂÆåÊàêÔºåÂºÄÂßãÊ£ÄÊü•Á≠õÈÄâÁä∂ÊÄÅ",{routeQuery:this.$route.query,isInitialized:this.isInitialized}),!this.$route.query.boardId&&!this.$route.query.pBoardId){console.log("[UserHome] URL Êó†ÂèÇÊï∞ÔºåÂ∞ùËØïÊÅ¢Â§çÁ≠õÈÄâÁä∂ÊÄÅ"),this.hasTriedRestoreState=!0;const t=this.restoreFilterState();if(console.log("[UserHome] ÊÅ¢Â§çÁªìÊûú:",t),t)return this.isInitialized=!0,void console.log("[UserHome] Áä∂ÊÄÅÊÅ¢Â§çÊàêÂäüÔºåËÆæÁΩÆ isInitialized = trueÔºåÂΩìÂâç pageNum:",this.queryform.pageNum)}console.log("[UserHome] Êó†ÈúÄÊÅ¢Â§çÁä∂ÊÄÅÊàñÊÅ¢Â§çÂ§±Ë¥•ÔºåÊâßË°åÈªòËÆ§ÂàùÂßãÂåñ"),this.hasTriedRestoreState=!0,this.isInitialized=!0,this.handleRouteQuery(this.$route.query)})),this.loadAiConfig(),this.loadKnowledgeBase(),0===this.chatMessages.length&&(this.chatMessages=this.loadChatMessages()),window.addEventListener("storage",this.handleStorageChange),this.checkMobile(),window.addEventListener("resize",this.handleResize),this.$root.$on("toggle-mobile-sidebar",this.handleToggleFromLogo),this.loadPostsLayoutPreference()},beforeDestroy(){window.removeEventListener("storage",this.handleStorageChange),window.removeEventListener("resize",this.handleResize),this.$root.$off("toggle-mobile-sidebar",this.handleToggleFromLogo)},activated(){this.loadAiConfig(),this.loadKnowledgeBase()},watch:{$route(t,e){"/userhome"===t.path&&"/ai-settings"===e.path&&(this.loadAiConfig(),this.loadKnowledgeBase()),"/userhome"===t.path&&"/userhomedetail"===e.path&&(!this.isInitialized||this.isRestoringFilterState||this.hasTriedRestoreState||(console.log("[UserHome] ‰ªéËØ¶ÊÉÖÈ°µËøîÂõûÔºåÊÅ¢Â§çÁ≠õÈÄâÁä∂ÊÄÅ"),this.hasTriedRestoreState=!0,this.restoreFilterState()))},"$route.query":{immediate:!0,handler(t){if(console.log("[UserHome] watch $route.query Ëß¶Âèë",{newQuery:t,isInitialized:this.isInitialized,hasTriedRestoreState:this.hasTriedRestoreState,isRestoringFilterState:this.isRestoringFilterState}),this.isInitialized){if(this.hasTriedRestoreState&&!t.boardId&&!t.pBoardId)return void console.log("[UserHome] Â∑≤ÊÅ¢Â§çÁä∂ÊÄÅ‰∏î URL Êó†ÂèÇÊï∞ÔºåË∑≥Ëøá handleRouteQuery");this.handleRouteQuery(t)}}},"$i18n.locale"(){(this.queryform.boardId||this.queryform.pBoardId)&&this.updateCurrentFilter()},chatMessages:{handler(t){this.saveChatMessages(t)},deep:!0},treedata:{handler(){},immediate:!1}},methods:{saveFilterState(){const t={boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum,currentSort:this.currentSort,currentFilter:this.currentFilter,currentNodeKey:this.currentNodeKey};console.log("[UserHome] ‰øùÂ≠òÁ≠õÈÄâÁä∂ÊÄÅ:",t);try{sessionStorage.setItem("forum_filter_state",JSON.stringify(t)),console.log("[UserHome] Á≠õÈÄâÁä∂ÊÄÅÂ∑≤‰øùÂ≠òÂà∞ sessionStorage")}catch(e){console.error("[UserHome] ‰øùÂ≠òÁ≠õÈÄâÁä∂ÊÄÅÂ§±Ë¥•:",e)}},restoreFilterState(){try{const t=sessionStorage.getItem("forum_filter_state");if(console.log("[UserHome] Â∞ùËØïÊÅ¢Â§çÁ≠õÈÄâÁä∂ÊÄÅÔºå‰øùÂ≠òÁöÑÁä∂ÊÄÅ:",t),t){const e=JSON.parse(t);return console.log("[UserHome] Ëß£ÊûêÂêéÁöÑÁ≠õÈÄâÁä∂ÊÄÅ:",e),this.isRestoringFilterState=!0,this.$set(this.queryform,"boardId",e.boardId||""),this.$set(this.queryform,"pBoardId",e.pBoardId||""),this.$set(this.queryform,"pageNum",e.pageNum||1),this.currentSort=e.currentSort||"all",this.currentFilter=e.currentFilter||this.$t("forum.allPosts"),this.currentNodeKey=e.currentNodeKey,console.log("[UserHome] ÊÅ¢Â§çÂêéÁöÑÂèÇÊï∞:",{boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum,currentSort:this.currentSort,currentFilter:this.currentFilter,currentNodeKey:this.currentNodeKey}),(this.queryform.boardId||this.queryform.pBoardId)&&this.updateExpandedKeys(),this.getcontent().finally((()=>{this.isRestoringFilterState=!1,this.$forceUpdate(),console.log("[UserHome] Á≠õÈÄâÁä∂ÊÄÅÊÅ¢Â§çÂÆåÊàêÔºåÂÜÖÂÆπÂ∑≤ÈáçÊñ∞Âä†ËΩΩÔºåÂΩìÂâç pageNum:",this.queryform.pageNum)})),console.log("[UserHome] Á≠õÈÄâÁä∂ÊÄÅÂ∑≤ÊÅ¢Â§ç:",e),!0}console.log("[UserHome] Ê≤°ÊúâÊâæÂà∞‰øùÂ≠òÁöÑÁ≠õÈÄâÁä∂ÊÄÅ")}catch(t){console.error("[UserHome] ÊÅ¢Â§çÁ≠õÈÄâÁä∂ÊÄÅÂ§±Ë¥•:",t)}return!1},clearFilterState(){try{sessionStorage.removeItem("forum_filter_state")}catch(t){console.error("[UserHome] Ê∏ÖÈô§Á≠õÈÄâÁä∂ÊÄÅÂ§±Ë¥•:",t)}},handleStorageChange(t){"huomiao_ai_config"===t.key&&this.loadAiConfig(),"huomiao_knowledge_base"===t.key&&this.loadKnowledgeBase(),"huomiao_ai_online"===t.key&&this.loadAiConfig(),"huomiao_chat_cleared"===t.key&&(this.chatMessages=this.loadChatMessages())},loadChatMessages(){try{const t=localStorage.getItem("huomiao_chat_history");if(t)return JSON.parse(t)}catch(t){console.error("Âä†ËΩΩËÅäÂ§©ÂéÜÂè≤Â§±Ë¥•:",t)}return[{id:"welcome",role:"model",text:"‰Ω†Â•ΩÔºÅÊàëÊòØËÆ∫ÂùõÂ∞èÂä©ÊâãÁÅ´Â¶ôÔºåÊúâ‰ªÄ‰πàÂèØ‰ª•Â∏Æ‰Ω†ÁöÑÂêóÔºü",timestamp:Date.now()}]},saveChatMessages(t){try{localStorage.setItem("huomiao_chat_history",JSON.stringify(t))}catch(e){console.error("‰øùÂ≠òËÅäÂ§©ÂéÜÂè≤Â§±Ë¥•:",e)}},loadAiConfig(){try{const t=h.A.loadConfig();this.aiConfig={protocol:t.protocol||"openai-compatible",baseUrl:t.baseUrl||"",apiKey:t.apiKey||"",modelId:t.modelId||"",systemPrompt:t.systemPrompt||""}}catch(t){console.error("Âä†ËΩΩ AI ÈÖçÁΩÆÂ§±Ë¥•:",t)}},loadKnowledgeBase(){try{const t=localStorage.getItem("huomiao_knowledge_base");this.knowledgeBase=t?JSON.parse(t):[]}catch(t){console.error("Âä†ËΩΩÁü•ËØÜÂ∫ìÂ§±Ë¥•:",t),this.knowledgeBase=[]}},initData(){this.getlist().then((()=>{this.isInitialized=!0,this.handleRouteQuery(this.$route.query)}))},handleRouteQuery(t){if(console.log("[UserHome] handleRouteQuery Ë¢´Ë∞ÉÁî®",{query:t,isInitialized:this.isInitialized,isRestoringFilterState:this.isRestoringFilterState,currentPageNum:this.queryform.pageNum}),this.isInitialized)if(this.isRestoringFilterState)console.log("[UserHome] handleRouteQuery: Ê≠£Âú®ÊÅ¢Â§çÁä∂ÊÄÅÔºåË∑≥Ëøá");else{if(!t.pBoardId&&!t.boardId){const t=this.queryform.boardId||this.queryform.pBoardId;return t?void console.log("[UserHome] URL Êó†ÂèÇÊï∞Ôºå‰ΩÜ‰øùÊåÅÂ∑≤ÊÅ¢Â§çÁöÑÁ≠õÈÄâÊù°‰ª∂",{boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId,pageNum:this.queryform.pageNum}):(console.log("[UserHome] URL Êó†ÂèÇÊï∞‰∏îÊó†Á≠õÈÄâÊù°‰ª∂ÔºåÈáçÁΩÆ‰∏∫ÂÖ®ÈÉ®Â∏ñÂ≠ê"),this.queryform.boardId="",this.queryform.pBoardId="",this.queryform.pageNum=1,this.currentNodeKey=null,this.currentFilter=this.$t("forum.allPosts"),void this.getcontent())}console.log("[UserHome] URL ÊúâÂèÇÊï∞ÔºåÊ†πÊçÆÂèÇÊï∞ËÆæÁΩÆÁ≠õÈÄâÊù°‰ª∂"),this.queryform.boardId=t.boardId||"",this.queryform.pBoardId=t.pBoardId||"",this.queryform.pageNum=1,this.currentNodeKey=null,t.boardId?this.currentNodeKey=parseInt(t.boardId):t.pBoardId&&(this.currentNodeKey=parseInt(t.pBoardId)),this.updateExpandedKeys(),this.updateCurrentFilter(),this.getcontent()}else console.log("[UserHome] handleRouteQuery: Êú™ÂàùÂßãÂåñÔºåË∑≥Ëøá")},updateExpandedKeys(){const t=new Set([...this.expandedKeys]);if(this.queryform.pBoardId&&t.add(parseInt(this.queryform.pBoardId)),this.queryform.boardId&&this.treedata.length>0){const e=(t,s)=>{for(const i of t)if(i.children){for(const e of i.children)if(e.id==s)return i.id;const t=e(i.children,s);if(t)return t}return null},s=e(this.treedata,this.queryform.boardId);s&&t.add(s)}this.expandedKeys=Array.from(t)},handleNodeClick(t){const e={};0!=t.pid?(e.boardId=t.id,e.pBoardId=t.pid):e.pBoardId=t.id;const s=this.$route.query,i=s.boardId==e.boardId&&s.pBoardId==e.pBoardId;i?(this.queryform.boardId=e.boardId||"",this.queryform.pBoardId=e.pBoardId||"",this.queryform.pageNum=1,this.currentNodeKey=t.id,this.updateExpandedKeys(),this.updateCurrentFilter(),this.getcontent(),this.saveFilterState()):this.$router.push({path:"/userhome",query:e}).catch((t=>{"NavigationDuplicated"!==t.name&&console.error("ÂØºËà™ÈîôËØØ:",t)})),this.isMobile&&this.isSidebarOpen&&this.toggleSidebar()},goHome(){const t=this.$route.query.boardId||this.$route.query.pBoardId;"/userhome"!==this.$route.path?this.$router.push({path:"/userhome",query:{}}):t&&this.$router.push({path:"/userhome",query:{}}).catch((t=>{"NavigationDuplicated"!==t.name&&console.error("ÂØºËà™ÈîôËØØ:",t)})),this.clearFilterState()},handleNavigate(t){"home"===t?this.goHome():"community"===t?this.$message.info("Á§æÂå∫ÂπøÂú∫ÂäüËÉΩÂºÄÂèë‰∏≠..."):"createBoard"===t&&this.openCreateBoardDialog()},resetFilter(){this.queryform.boardId="",this.queryform.pBoardId="",this.queryform.pageNum=1,this.currentFilter=this.$t("forum.allPosts"),this.getcontent(),this.clearFilterState(),this.isMobile&&this.isSidebarOpen&&(this.isSidebarOpen=!1),(this.$route.query.boardId||this.$route.query.pBoardId)&&this.$router.push({path:"/userhome",query:{}}),this.$message.success(this.$t("forum.resetFilter")+" - "+this.$t("forum.allPosts"))},getTreeIcon(t){return t.children&&t.children.length>0?"el-icon-folder":"el-icon-document"},isSubCategoryActive(t){return this.queryform.boardId==t},godetail(t){this.saveFilterState(),this.$router.push({path:"/userhomedetail",query:{id:t.id}})},handleCurrentChange(t){this.queryform.pageNum=t,this.getcontent(),this.saveFilterState()},async getlist(){try{const t=await a.A.get("/board/list");return 200==t.code||1==t.code?(this.treedata=t.data,this.$nextTick((()=>{this.checkMobile()})),Promise.resolve()):(console.error("[getlist] Ëé∑ÂèñÂ§±Ë¥•:",t.msg),Promise.reject(new Error(t.msg)))}catch(t){return console.error("[getlist] ËØ∑Ê±ÇÂºÇÂ∏∏:",t),Promise.reject(t)}},async getcontent(){console.log("[UserHome] getcontent Ë¢´Ë∞ÉÁî®",{pageNum:this.queryform.pageNum,pageSize:this.queryform.pageSize,boardId:this.queryform.boardId,pBoardId:this.queryform.pBoardId});try{const t={pageNum:this.queryform.pageNum,pageSize:this.queryform.pageSize,statusInteger:1};this.queryform.pBoardId&&(t.pBoardId=this.queryform.pBoardId),this.queryform.boardId&&(t.boardId=this.queryform.boardId),console.log("[UserHome] getcontent ËØ∑Ê±ÇÂèÇÊï∞:",t);const e=await a.A.post("/article/list",t);200==e.code||1==e.code?(this.$set(this,"contentlist",e.data.records||[]),this.$set(this,"total",e.data.total||0),console.log("[UserHome] getcontent ËØ∑Ê±ÇÊàêÂäü",{"ËøîÂõûÁöÑÈ°µÁ†Å":e.data.current,"ÊÄªËÆ∞ÂΩïÊï∞":e.data.total,"ÂΩìÂâçÈ°µËÆ∞ÂΩïÊï∞":(e.data.records||[]).length})):(this.$set(this,"contentlist",[]),this.$set(this,"total",0))}catch(t){console.error("[UserHome] getcontent ËØ∑Ê±ÇÂ§±Ë¥•:",t),this.$set(this,"contentlist",[]),this.$set(this,"total",0)}},updateCurrentFilter(){if(!this.queryform.boardId&&!this.queryform.pBoardId)return void(this.currentFilter=this.$t("forum.allPosts"));const t=(e,s)=>{for(const i of e){if(i.id==s)return i.name;if(i.children&&i.children.length>0){const e=t(i.children,s);if(e)return e}}return null};let e="";this.queryform.boardId?e=t(this.treedata,this.queryform.boardId):this.queryform.pBoardId&&(e=t(this.treedata,this.queryform.pBoardId)),this.currentFilter=e?`${this.$t("forum.allPosts")} - ${e}`:this.$t("forum.allPosts")},handleArticlePublished(){this.$message.success(this.$t("article.publishSuccess")),this.getcontent()},async handleSort(t){if(this.currentSort===t)return;this.currentSort=t;const e={all:this.$t("forum.allPosts"),hot:this.$t("forum.hot")+" "+this.$t("nav.forum"),latest:this.$t("forum.latest")+" "+this.$t("nav.forum")};this.currentFilter=e[t],this.queryform.pageNum=1,"hot"===t?await this.getTopReadArticles():"latest"===t?await this.getLatestArticles():await this.getcontent(),this.saveFilterState()},async getLatestArticles(){try{const t=await a.A.post("/article/latest");200==t.code||1==t.code?(this.$set(this,"contentlist",t.data||[]),this.$set(this,"total",(t.data||[]).length)):(this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error(t.msg||"Ëé∑ÂèñÊúÄÊñ∞ÊñáÁ´†Â§±Ë¥•"))}catch(t){console.error("Ëé∑ÂèñÊúÄÊñ∞ÊñáÁ´†Â§±Ë¥•:",t),this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error("Ëé∑ÂèñÊúÄÊñ∞ÊñáÁ´†Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}},async getTopReadArticles(){try{const t=await a.A.post("/article/topReadCount");200==t.code||1==t.code?(this.$set(this,"contentlist",t.data||[]),this.$set(this,"total",(t.data||[]).length)):(this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error(t.msg||"Ëé∑ÂèñÁÉ≠Èó®ÊñáÁ´†Â§±Ë¥•"))}catch(t){console.error("Ëé∑ÂèñÁÉ≠Èó®ÊñáÁ´†Â§±Ë¥•:",t),this.$set(this,"contentlist",[]),this.$set(this,"total",0),this.$message.error("Ëé∑ÂèñÁÉ≠Èó®ÊñáÁ´†Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï")}},handleCommunitySelect(t){this.queryform.boardId=t.boardId,this.queryform.pBoardId=t.pBoardId,this.queryform.pageNum=1,this.currentFilter=t.name,this.getcontent(),this.saveFilterState(),this.isMobile&&this.isSidebarOpen&&(this.isSidebarOpen=!1),this.$message.success(`Â∑≤Á≠õÈÄâÔºö${t.name}`)},toggleChat(){this.isChatOpen||this.isLoggedIn?(this.isChatOpen=!this.isChatOpen,this.isChatOpen&&(this.unreadCount=0)):this.$message.warning("ËØ∑ÂÖàÁôªÂΩïÂêéÂÜç‰ΩøÁî® AI ËÅäÂ§©ÂäüËÉΩ")},async handleSendMessage(t){if(this.isLoggedIn){if(t.trim()){this.chatMessages.push({id:Date.now().toString(),role:"user",text:t,timestamp:Date.now()}),this.isChatLoading=!0;try{await this.callAiServiceStream()}catch(e){console.error("AI ÊúçÂä°Ë∞ÉÁî®Â§±Ë¥•:",e),this.chatMessages.push({id:(Date.now()+1).toString(),role:"system",text:"AI ÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®ÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ",timestamp:Date.now()}),this.isChatLoading=!1}}}else this.$message.warning("ËØ∑ÂÖàÁôªÂΩïÂêéÂÜç‰ΩøÁî® AI ËÅäÂ§©ÂäüËÉΩ")},async callAiServiceStream(){try{const t=(Date.now()+1).toString();let e="",s=[],i=!1,o=-1;h.A.chatStream(this.chatMessages,(s=>{i?(e+=s,this.chatMessages[o].text=e,this.$set(this.chatMessages,o,{...this.chatMessages[o]})):(this.chatMessages.push({id:t,role:"model",text:s,timestamp:Date.now(),usedKnowledge:[]}),o=this.chatMessages.length-1,i=!0)}),(t=>{s=t,o>=0&&(this.chatMessages[o].usedKnowledge=t)}),(()=>{if(this.isChatLoading=!1,this.isChatOpen||this.unreadCount++,s&&s.length>0&&o>=0){const t=s.map((t=>`üìö ${t.title}`)).join("\n");this.chatMessages[o].text+=`\n\n---\n${t}`,this.$set(this.chatMessages,o,{...this.chatMessages[o]})}}),(t=>{console.error("AI ÊµÅÂºèÂìçÂ∫îÈîôËØØ:",t),i&&o>=0&&this.chatMessages.splice(o,1),this.chatMessages.push({id:(Date.now()+2).toString(),role:"system",text:this.getFriendlyErrorMessage(t),timestamp:Date.now()}),this.isChatLoading=!1}))}catch(t){throw console.error("AI ÊúçÂä°ÈîôËØØ:",t),this.isChatLoading=!1,t}},getFriendlyErrorMessage(t){const e=t.message||t.toString()||"";return e.includes("API Key")||e.includes("apiKey")?"ËØ∑ÂÖàÈÖçÁΩÆÊúâÊïàÁöÑ API Key„ÄÇÈÖçÁΩÆË∑ØÂæÑÔºöÁÆ°ÁêÜÂêéÂè∞ ‚Üí ‰ø°ÊÅØÁÆ°ÁêÜ ‚Üí AIËÆæÁΩÆÁÆ°ÁêÜ":e.includes("ÁΩëÁªú")||e.includes("fetch")||e.includes("timeout")?"ÁΩëÁªúËøûÊé•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËÆæÁΩÆÂêéÈáçËØï":e.includes("rate limit")||e.includes("429")?"ËØ∑Ê±ÇËøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÂÜçËØï":e.includes("quota")||e.includes("balance")?"API È¢ùÂ∫¶‰∏çË∂≥ÔºåËØ∑Ê£ÄÊü•Ë¥¶Êà∑‰ΩôÈ¢ù":"Êä±Ê≠âÔºåÊàëÊöÇÊó∂Êó†Ê≥ïÂõûÂ§ç„ÄÇËØ∑Á®çÂêéÂÜçËØïÊàñËÅîÁ≥ªÁÆ°ÁêÜÂëò"},async callAiService(){try{return new Promise(((t,e)=>{let s="",i=[];h.A.chatStream(this.chatMessages,(t=>{s+=t}),(t=>{i=t}),(()=>{t({reply:s,usedKnowledge:i,latency:0})}),(t=>{e(t)}))}))}catch(t){throw console.error("AI ÊúçÂä°ÈîôËØØ:",t),t}},handleToggleFromLogo(){this.isMobile&&this.toggleSidebar()},checkMobile(){const t=window.innerWidth;this.windowWidth=t,this.isMobile=t<=768,this.isMobile?this.isSidebarCollapsed=!0:this.isSidebarCollapsed=!1},handleResize(){this.checkMobile()},toggleSidebar(){this.isMobile?(this.isSidebarOpen=!this.isSidebarOpen,this.isSidebarOpen?document.body.style.overflow="hidden":document.body.style.overflow=""):this.isSidebarCollapsed=!this.isSidebarCollapsed},closeSidebar(){this.isMobile&&this.isSidebarOpen&&(console.log("[UserHome] ÂÖ≥Èó≠ÁßªÂä®Á´Ø‰æßËæπÊ†è"),this.isSidebarOpen=!1,document.body.style.overflow="")},goToSearchPage(){this.$router.push("/mobile-search")},handleActionCommand(t){"publish"===t?this.$nextTick((()=>{this.isMobile?this.$refs.publishArticleMobile?this.$refs.publishArticleMobile.openDialog():console.error("[UserHome] publishArticleMobile ref not found"):this.$refs.publishArticlePC?this.$refs.publishArticlePC.openDialog():console.error("[UserHome] publishArticlePC ref not found")})):"createBoard"===t&&this.openCreateBoardDialog()},openCreateBoardDialog(){this.isLoggedIn?this.showCreateBoardDialog=!0:this.$message.warning("ËØ∑ÂÖàÁôªÂΩïÂêéÂÜçÂàõÂª∫ÊùøÂùó")},async handleBoardCreated(){console.log("[UserHome] ÊùøÂùóÂàõÂª∫ÊàêÂäüÔºåÂà∑Êñ∞ÊùøÂùóÂàóË°®"),await this.getlist()},handleLayoutChange(t){this.postsLayoutMode=t,this.savePostsLayoutPreference(t);const e="list"===t?"ÂàóË°®ËßÜÂõæ":"ÁΩëÊ†ºËßÜÂõæ";this.$message.success(`Â∑≤ÂàáÊç¢Âà∞${e}`)},savePostsLayoutPreference(t){try{localStorage.setItem("posts_layout_mode",t)}catch(e){console.error("[UserHome] ‰øùÂ≠òÂ∏ÉÂ±ÄÂÅèÂ•ΩÂ§±Ë¥•:",e)}},loadPostsLayoutPreference(){try{const t=localStorage.getItem("posts_layout_mode");!t||"list"!==t&&"grid"!==t||(this.postsLayoutMode=t)}catch(t){console.error("[UserHome] Âä†ËΩΩÂ∏ÉÂ±ÄÂÅèÂ•ΩÂ§±Ë¥•:",t)}}}},p=g,f=s(81656),b=(0,f.A)(p,i,o,!1,null,"903d9412",null),y=b.exports},42051:function(t,e,s){s.d(e,{A:function(){return g}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"forum-container"},[t.loadingPage?e("div",{staticClass:"page-loading"},[e("div",{staticClass:"loading-content"},[t._m(0),e("div",{staticClass:"loading-text"},[t._v(t._s(t.$t("article.loadingContent")))])])]):t._e(),t.isMobile?e("div",{staticClass:"sidebar-overlay",class:{"overlay-active":t.isSidebarOpen&&t.isMobile},on:{click:t.toggleSidebar}}):t._e(),e("ForumSidebar",{attrs:{"tree-data":t.treedata,"expanded-keys":t.expandedKeys,"current-node-key":t.currentNodeKey,"active-board-id":t.queryform.boardId,"is-mobile":t.isMobile,"is-sidebar-collapsed":t.isSidebarCollapsed,"is-sidebar-open":t.isSidebarOpen,query:t.$route.query},on:{"node-click":t.handleNodeClick,close:t.toggleSidebar,navigate:t.handleNavigate}}),e("div",{staticClass:"main-content"},[e("div",{staticClass:"back-button-container"},[e("el-button",{staticClass:"back-button",attrs:{icon:"el-icon-arrow-left",type:"text"},on:{click:t.goBack}},[t._v(" "+t._s(t.$t("article.backToPrevious"))+" ")])],1),e("div",{staticClass:"container-box"},[e("div",{staticClass:"article-card"},[e("div",{staticClass:"article-header"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.info.title))]),e("div",{staticClass:"article-meta"},[e("div",{staticClass:"meta-item"},[e("i",{staticClass:"el-icon-time"}),e("span",[t._v(t._s(t.info.postTime))])]),e("div",{staticClass:"meta-item"},[e("i",{staticClass:"el-icon-user"}),e("span",[t._v(t._s(t.info.nickName))])])])]),e("div",{staticClass:"article-content",domProps:{innerHTML:t._s(t.info.content)}}),t.fjlist.length>0?e("div",{staticClass:"attachments"},[e("div",{staticClass:"attachments-title"},[e("i",{staticClass:"el-icon-document"}),e("span",[t._v(t._s(t.$t("article.attachmentDownload")))])]),e("div",{staticClass:"attachments-list"},t._l(t.fjlist,(function(s){return e("div",{key:s.fileId,staticClass:"attachment-item",on:{click:function(e){return t.xiazai(s)}}},[e("i",{staticClass:"el-icon-download attachment-icon"}),e("span",{staticClass:"attachment-name"},[t._v(t._s(s.fileName))]),s.fileSize?e("span",{staticClass:"attachment-size"},[t._v(t._s(t.$formatFileSize(s.fileSize)))]):t._e()])})),0)]):t._e(),e("div",{staticClass:"article-actions"},[e("div",{staticClass:"action-item",class:{active:t.havelike},on:{click:t.like}},[e("i",{staticClass:"el-icon-star-on"}),e("span",[t._v(t._s(t.info.goodCount||0))])]),e("div",{staticClass:"action-btn"},[e("i",{staticClass:"el-icon-s-comment"}),e("span",{staticClass:"action-text"},[t._v(t._s(t.$t("article.comments")))]),e("span",{staticClass:"action-count"},[t._v(t._s(t.info.commentCount||0))])]),e("div",{staticClass:"action-btn"},[e("i",{staticClass:"el-icon-view"}),e("span",{staticClass:"action-text"},[t._v(t._s(t.$t("article.view")))]),e("span",{staticClass:"action-count"},[t._v(t._s(t.info.readCount||0))])]),e("el-button",{staticClass:"comment-btn",attrs:{type:"primary",disabled:t.commentButtonDisabled},on:{click:t.pl}},[e("i",{staticClass:"el-icon-edit"}),t._v(" "+t._s(t.commentButtonText)+" ")])],1)]),e("div",{staticClass:"comments-section"},[e("div",{staticClass:"section-header"},[e("h3",{staticClass:"section-title"},[e("i",{staticClass:"el-icon-chat-dot-square"}),t._v(" "+t._s(t.$t("article.allComments"))+" "),e("span",{staticClass:"comment-count"},[t._v(t._s(t.commentlist.length))])])]),0===t.commentlist.length?e("div",{staticClass:"empty-comments"},[e("div",{staticClass:"empty-comment-icon"},[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"}},[e("path",{attrs:{d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e("p",{staticClass:"empty-comment-title"},[t._v(t._s(t.$t("article.noCommentsYet")))]),e("p",{staticClass:"empty-comment-desc"},[t._v(t._s(t.$t("article.beFirstToComment")))])]):t._e(),e("div",{staticClass:"comments-list"},t._l(t.commentlist,(function(s){return e("div",{key:s.commentId,staticClass:"comment-item"},[e("comment-item",{attrs:{comment:s,type:"main","current-user-id":t.user?t.user.id:null,"article-author-id":t.info.userId,"can-pin":t.user&&t.user.userId==t.info.userId},on:{like:t.commentlike,reply:t.pl1,pin:t.zd,delete:t.delComment}}),s.children&&s.children.length>0?e("div",{staticClass:"comment-replies"},t._l(s.children,(function(i){return e("comment-item",{key:i.commentId,attrs:{comment:i,type:"reply","current-user-id":t.user?t.user.id:null,"article-author-id":t.info.userId,"can-pin":t.user&&t.user.userId==t.info.userId},on:{like:t.commentlike,reply:()=>t.pl2(i,s),pin:t.zd,delete:t.delComment}})})),1):t._e()],1)})),0)])])]),e("el-dialog",{class:t.isMobile?"mobile-comment-dialog":"comment-dialog",attrs:{title:0===t.form.pCommentId?t.$t("article.publishComment"):t.$t("article.replyToComment"),visible:t.fromVisible,width:t.isMobile?"100%":"600px","close-on-click-modal":!1,"modal-append-to-body":!0,"append-to-body":!0,"custom-class":"comment-dialog-wrapper"},on:{"update:visible":function(e){t.fromVisible=e}}},[e("el-form",{ref:"formRef",staticClass:"comment-form",attrs:{model:t.form,"label-width":t.isMobile?"60px":"80px"}},[e("el-form-item",{attrs:{label:t.$t("article.contentLabel"),prop:"content",required:""}},[e("el-input",{staticClass:"comment-textarea",attrs:{type:"textarea",rows:t.isMobile?6:4,placeholder:t.isMobile?t.$t("article.saySomething"):t.$t("article.enterCommentContent"),maxlength:"500","show-word-limit":"",resize:"none"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),e("el-form-item",{attrs:{label:t.$t("article.imageLabel")}},[t.isMobile?[t.form.imagePath?t._e():e("oss-image-upload",{attrs:{"upload-type":"comment","max-size":1,tip:t.$t("article.uploadImage"),"size-tip":"Â§ßÂ∞è‰∏çË∂ÖËøá1MB","upload-class":"upload-area"},scopedSlots:t._u([{key:"default",fn:function(){return[e("div",{staticClass:"upload-content mobile-upload"},[e("i",{staticClass:"el-icon-plus upload-icon"})])]},proxy:!0}],null,!1,1607958322),model:{value:t.form.imagePath,callback:function(e){t.$set(t.form,"imagePath",e)},expression:"form.imagePath"}}),t.form.imagePath?e("div",{staticClass:"mobile-image-preview"},[e("div",{staticClass:"preview-wrapper"},[e("img",{staticClass:"preview-image",attrs:{src:t.$getImageUrl(t.form.imagePath)}}),e("i",{staticClass:"el-icon-error close-icon",on:{click:function(e){t.form.imagePath=""}}})])]):t._e()]:[e("oss-image-upload",{attrs:{"upload-type":"comment","max-size":1,tip:t.$t("article.uploadImage"),"size-tip":"Â§ßÂ∞è‰∏çË∂ÖËøá1MB","upload-class":"upload-area"},scopedSlots:t._u([{key:"default",fn:function(){return[e("div",{staticClass:"upload-content",class:{"mobile-upload":t.isMobile}},[t.form.imagePath?t._e():e("i",{staticClass:"el-icon-plus upload-icon"}),t.form.imagePath?e("img",{staticClass:"upload-preview",attrs:{src:t.$getImageUrl(t.form.imagePath)}}):t._e()])]},proxy:!0}],null,!1,1306826488),model:{value:t.form.imagePath,callback:function(e){t.$set(t.form,"imagePath",e)},expression:"form.imagePath"}}),e("div",{staticClass:"upload-tip"},[t._v("ÊîØÊåÅ‰∏ä‰º†ÂõæÁâáÔºåÂ§ßÂ∞è‰∏çË∂ÖËøá1MB")])]],2)],1),e("div",{class:t.isMobile?"mobile-dialog-footer":"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.isMobile?[e("el-button",{staticClass:"mobile-btn mobile-btn-cancel",attrs:{size:"large"},on:{click:function(e){t.fromVisible=!1}}},[t._v("ÂèñÊ∂à")]),e("el-button",{staticClass:"mobile-btn mobile-btn-confirm",attrs:{type:"primary",loading:t.loading,size:"large"},on:{click:t.save}},[t._v(" "+t._s(t.loading?t.$t("article.publishing"):t.$t("article.publish"))+" ")])]:[e("el-button",{on:{click:function(e){t.fromVisible=!1}}},[t._v("ÂèñÊ∂à")]),e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.save}},[t._v("Á°ÆÂÆö")])]],2)],1)],1)},o=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"loading-spinner"},[e("div",{staticClass:"spinner"}),e("div",{staticClass:"spinner"}),e("div",{staticClass:"spinner"}),e("div",{staticClass:"spinner"})])}],a=(s(44114),s(18962)),r=s(29455),n=s(8723),l=s(92646),d=s(35637),c={name:"ArticleDetail",components:{ForumSidebar:r.A,OssImageUpload:n.A,UserAvatar:l.A,CommentItem:d.A},data(){return{info:{},fromVisible:!1,form:{},total:0,commentlist:[],havelike:!1,fjlist:[],comment:"",comment1:"",receive:"",receive1:"",receive3:"",loading:!1,user:null,token:"",commentButtonDisabled:!0,commentButtonText:"",loadingPage:!0,loadingTime:0,keyboardOpen:!1,treedata:[],expandedKeys:[1,2,5],currentNodeKey:null,queryform:{boardId:"",pBoardId:""},isMobile:!1,isSidebarOpen:!1,isSidebarCollapsed:!1,windowWidth:window.innerWidth}},mounted(){this.commentButtonText=this.$t("article.publishComment"),this.token=window.localStorage.getItem("token"),this.user=JSON.parse(window.localStorage.getItem("userinfo")),this.startLoadingTimer(),this.getdata(),this.getBoardList(),this.checkMobile(),window.addEventListener("resize",this.handleResize),this.$root.$on("toggle-mobile-sidebar",this.handleToggleFromLogo),setTimeout((()=>{this.commentButtonDisabled=!1}),500)},methods:{goBack(){window.history.length>1?this.$router.go(-1):this.$router.push("/userhome")},startLoadingTimer(){this.loadingTime=setTimeout((()=>{this.loadingPage}),3e3)},clearLoadingTimer(){this.loadingTime&&(clearTimeout(this.loadingTime),this.loadingTime=0)},async getBoardList(){try{const t=await a.A.get("/board/list");200==t.code&&(this.treedata=t.data)}catch(t){console.error(t)}},handleNavClick(t){this.activeNav=t},handleNodeClick(t){this.$router.push({path:"/userhome",query:{boardId:0!=t.pid?t.id:"",pBoardId:0!=t.pid?t.pid:t.id}}),window.innerWidth<=768&&this.closeMobileSidebar()},handleNavigate(t){"home"===t?this.$router.push({path:"/userhome",query:{}}):"community"===t&&this.$message.info("Á§æÂå∫ÂπøÂú∫ÂäüËÉΩÂºÄÂèë‰∏≠...")},toggleMobileSidebar(){this.mobileSidebarOpen=!this.mobileSidebarOpen},closeMobileSidebar(){this.mobileSidebarOpen=!1},handleToggleFromLogo(){this.toggleMobileSidebar()},pl1(t){const e=localStorage.getItem("userinfo");e?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:t.commentId,replyUserId:t.userId,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error(this.$t("article.notLoggedIn"))},pl2(t,e){const s=localStorage.getItem("userinfo");s?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:e.commentId,replyUserId:t.userId,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error(this.$t("article.notLoggedIn"))},pl(){if(this.commentButtonDisabled)return void console.log("[ËØÑËÆ∫] ÊåâÈíÆËøòÂú®Á¶ÅÁî®ÊúüÂÜÖÔºåÂøΩÁï•ÁÇπÂáª");const t=localStorage.getItem("userinfo");t?(this.fromVisible=!0,this.form={articleId:this.info.id,pCommentId:0,imagePath:""},this.$nextTick((()=>{this.isMobile&&this.setupMobileKeyboardListener()}))):this.$message.error(this.$t("article.notLoggedIn"))},async zd(t){const e=localStorage.getItem("userinfo");if(e)try{const e=await a.A.post("/article/changeTop",{commentId:t});200==e.code&&(this.$message.success(e.message||this.$t("article.operationSuccess")),this.getdata())}catch(s){console.error(s)}else this.$message.error(this.$t("article.notLoggedIn"))},async commentlike(t){const e=localStorage.getItem("userinfo");if(e)try{const e=await a.A.post("/article/commentlike",{commentId:t});200==e.code&&this.getdata()}catch(s){console.error(s)}else this.$message.error(this.$t("article.notLoggedIn"))},async getlist(){try{const t=await a.A.post("/article/loadcomment",{articleId:this.info.id});200==t.code&&(this.commentlist=t.data)}catch(t){console.error("Âä†ËΩΩËØÑËÆ∫Â§±Ë¥•:",t),this.commentlist=[]}},async xiazai(t){try{await a.A.get("/article/downloadAttachment?fileId="+t.fileId);this.$message.success(this.$t("article.startDownload"))}catch(e){console.error(e)}},async like(){const t=localStorage.getItem("userinfo");if(!t)return void this.$message.error(this.$t("article.notLoggedIn"));const e=this.havelike,s=this.info.goodCount||0;this.havelike=!e,this.info.goodCount=e?s-1:s+1;try{const t=await a.A.post("/article/dolike",{id:this.info.id});200==t.code||(this.havelike=e,this.info.goodCount=s,this.$message.error(t.msg||this.$t("article.operationFailed")))}catch(i){this.havelike=e,this.info.goodCount=s,this.$message.error("ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï")}},async delComment(t){this.$confirm(this.$t("article.deleteCommentConfirm"),this.$t("common.confirm"),{confirmButtonText:this.$t("article.confirmDelete"),cancelButtonText:this.$t("common.cancel"),type:"warning",customClass:"delete-confirm"}).then((async()=>{try{const e=await a.A.post("/article/deletecomment",{commentId:t});200==e.code||1==e.code?(this.$message.success(this.$t("article.deleteSuccess")),this.getlist(),this.info&&void 0!==this.info.commentCount&&(this.info.commentCount=Math.max(0,this.info.commentCount-1))):this.$message.error(e.msg||this.$t("article.deleteFailed"))}catch(e){console.error("Âà†Èô§ËØÑËÆ∫Â§±Ë¥•:",e),this.$message.error(this.$t("article.operationRetry"))}})).catch((()=>{}))},async save(){if(this.form.content&&""!==this.form.content.trim()){this.loading=!0;try{const t=await a.A.post("/article/postcomment",{articleId:this.form.articleId,pCommentId:this.form.pCommentId,content:this.form.content,imagePath:this.form.imagePath,replyUserId:this.form.replyUserId});200==t.code&&(this.$message.success(this.$t("article.commentSuccess")),this.fromVisible=!1,this.getdata())}catch(t){console.error(t)}finally{this.loading=!1}}else this.$message.warning(this.$t("article.enterCommentContent"))},async getdata(){try{const t=await a.A.post("/article/detail",{id:this.$route.query.id});200==t.code&&(this.info=t.data.article,this.fjlist=t.data.attachments||[],this.havelike=!0===t.data.haveLike||1===t.data.haveLike,await this.getlist())}catch(t){console.error(t)}finally{setTimeout((()=>{this.loadingPage=!1,this.clearLoadingTimer()}),1e3)}},checkMobile(){const t=window.innerWidth;this.windowWidth=t,this.isMobile=t<=768,this.isMobile?this.isSidebarCollapsed=!0:this.isSidebarCollapsed=!1},handleResize(){this.checkMobile()},toggleSidebar(){this.isMobile?(this.isSidebarOpen=!this.isSidebarOpen,this.isSidebarOpen?document.body.style.overflow="hidden":document.body.style.overflow=""):this.isSidebarCollapsed=!this.isSidebarCollapsed},setupMobileKeyboardListener(){this.removeMobileKeyboardListener(),this.initialHeight=window.innerHeight,this.keyboardShowHandler=()=>{const t=window.innerHeight;t<this.initialHeight-150?(this.keyboardOpen=!0,this.addKeyboardOpenClass()):(this.keyboardOpen=!1,this.removeKeyboardOpenClass())},window.addEventListener("resize",this.keyboardShowHandler),window.visualViewport&&window.visualViewport.addEventListener("resize",this.keyboardShowHandler)},addKeyboardOpenClass(){const t=document.querySelector(".mobile-comment-dialog");t&&t.classList.add("keyboard-open")},removeKeyboardOpenClass(){const t=document.querySelector(".mobile-comment-dialog");t&&t.classList.remove("keyboard-open")},removeMobileKeyboardListener(){this.keyboardShowHandler&&(window.removeEventListener("resize",this.keyboardShowHandler),window.visualViewport&&window.visualViewport.removeEventListener("resize",this.keyboardShowHandler),this.keyboardShowHandler=null),this.removeKeyboardOpenClass()}},beforeDestroy(){this.clearLoadingTimer(),window.removeEventListener("resize",this.handleResize),this.$root.$off("toggle-mobile-sidebar",this.handleToggleFromLogo),this.removeMobileKeyboardListener()}},h=c,m=s(81656),u=(0,m.A)(h,i,o,!1,null,"351badc8",null),g=u.exports}}]);